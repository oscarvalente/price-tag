{"version":3,"file":"tracked-items.js","sources":["../tracked-items.js"],"sourcesContent":["let trackedItemsContainer;\nlet trackedItemsList;\nlet listItemsLoader;\n\nconst ITEM_STATUS = {\n    WATCHED: \"WATCHED\",\n    NOT_FOUND: \"NOT_FOUND\",\n    INCREASED: \"INCREASED\",\n    DECREASED: \"DECREASED\",\n    FIXED: \"FIXED\"\n};\n\nconst REFRESH_INTERVAL = 14000;\n\nfunction loadTemplate(elementId) {\n    const elementHTML = document.getElementById(elementId).innerHTML;\n    return Handlebars.compile(elementHTML);\n}\n\nfunction formatDate(timestamp) {\n    const date = new Date(timestamp);\n    return `${date.toLocaleDateString()} ${date.toLocaleTimeString()}`;\n}\n\nfunction onTrackedItems(rawItems) {\n    const trackedItems = rawItems.map(item => ({\n        ...item,\n        dateTime: formatDate(item.timestamp),\n        isWatched: item.statuses.includes(ITEM_STATUS.WATCHED),\n        isNotFound: item.statuses.includes(ITEM_STATUS.NOT_FOUND),\n        isHigher: item.statuses.includes(ITEM_STATUS.INCREASED),\n        isLower: item.statuses.includes(ITEM_STATUS.DECREASED),\n        diffPercBackground: item.diffPercentage && item.diffPercentage > 0 ? \"red\" : \"green\"\n    }));\n    trackedItemsContainer.innerHTML = listItemsLoader({trackedItems});\n\n    trackedItemsList = document.getElementById(\"tracked-items-list\");\n    addRemoveEvents(\".item-container .item-delete\");\n}\n\nfunction addRemoveEvents(selection) {\n    const deleteElements = document.body.querySelectorAll(selection);\n    for (let elem in deleteElements) {\n        if (deleteElements.hasOwnProperty(elem)) {\n            const element = deleteElements[elem];\n            const url = element.getAttribute(\"data-item-url\");\n            element.onclick = removeItem.bind(null, url, element.parentElement);\n        }\n    }\n}\n\nfunction removeItem(url, listItemElement) {\n    chrome.runtime.sendMessage({\n        type: \"TRACKED_ITEMS.UNFOLLOW\",\n        payload: {url}\n    }, onItemRemoved.bind(null, listItemElement));\n}\n\nfunction updateTrackedItems() {\n    chrome.runtime.sendMessage({type: \"TRACKED_ITEMS.GET\"}, onTrackedItems);\n}\n\nfunction registerHelpers() {\n    Handlebars.registerHelper(\"diffPercentage\", value => {\n        let percentage = parseInt(value, 10);\n        // default: 1 digit\n        let x = 110;\n        let fontSize = 180;\n        if (percentage >= 10 || percentage <= -10) {\n            x = 50;\n            fontSize = 175;\n        }\n        if (percentage >= 100 || percentage <= -100) {\n            x = 60;\n            fontSize = 170;\n        }\n        if (percentage > 0) {\n            percentage = `+${percentage}`;\n        }\n        return new Handlebars.SafeString(\n            `<text x=\"${x}\" y=\"310\" font-family=\"Verdana\" font-weight=\"bold\" font-size=\"${fontSize}\" fill=\"#fff1cb\" letter-spacing=\"-10\">\n                ${percentage}%\n            </text>`\n        );\n    });\n    Handlebars.registerHelper(\"targetPrice\", function registerTargetPrice(){\n        return this.price !== this.currentPrice ?\n            new Handlebars.SafeString(`<span class=\"item-label target-price\" title=\"Price the last time you marked it\">${this.price}</span>`) :\n            \"\";\n    });\n}\n\nfunction setupUpdateTrackedItems() {\n    updateTrackedItems();\n    // TEMP: uncomment to refresh\n    setInterval(updateTrackedItems, REFRESH_INTERVAL);\n}\n\nfunction bootstrap() {\n    registerHelpers();\n\n    trackedItemsContainer = document.getElementById(\"tracked-items-container\");\n    listItemsLoader = loadTemplate(\"items-list\");\n\n    setupUpdateTrackedItems();\n}\n\nfunction onItemRemoved(listItemElement, wasRemoved) {\n    if (wasRemoved) {\n        trackedItemsList.removeChild(listItemElement);\n        if (trackedItemsList.children.length === 0) {\n            updateTrackedItems();\n        }\n    }\n}\n\nbootstrap();\n"],"names":["trackedItemsContainer","trackedItemsList","listItemsLoader","ITEM_STATUS","WATCHED","NOT_FOUND","INCREASED","DECREASED","FIXED","REFRESH_INTERVAL","loadTemplate","elementId","elementHTML","document","getElementById","innerHTML","Handlebars","compile","formatDate","timestamp","date","Date","toLocaleDateString","toLocaleTimeString","onTrackedItems","rawItems","trackedItems","map","item","dateTime","isWatched","statuses","includes","isNotFound","isHigher","isLower","diffPercBackground","diffPercentage","addRemoveEvents","selection","deleteElements","body","querySelectorAll","elem","hasOwnProperty","element","url","getAttribute","onclick","removeItem","bind","parentElement","listItemElement","chrome","runtime","sendMessage","type","payload","onItemRemoved","updateTrackedItems","registerHelpers","registerHelper","value","percentage","parseInt","x","fontSize","SafeString","registerTargetPrice","price","currentPrice","setupUpdateTrackedItems","setInterval","bootstrap","wasRemoved","removeChild","children","length"],"mappings":"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"}