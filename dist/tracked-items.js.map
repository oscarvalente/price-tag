{"version":3,"file":"tracked-items.js","sources":["../tracked-items.js"],"sourcesContent":["let trackedItemsContainer;\nlet trackedItemsList;\nlet listItemsLoader;\n\nconst ITEM_STATUS = {\n    WATCHED: \"WATCHED\",\n    NOT_FOUND: \"NOT_FOUND\",\n    INCREASED: \"INCREASED\",\n    DECREASED: \"DECREASED\",\n    FIXED: \"FIXED\"\n};\n\nconst REFRESH_INTERVAL = 14000;\n\nfunction loadTemplate(elementId) {\n    const elementHTML = document.getElementById(elementId).innerHTML;\n    return Handlebars.compile(elementHTML);\n}\n\nfunction formatDate(timestamp) {\n    const date = new Date(timestamp);\n    return `${date.toLocaleDateString()} ${date.toLocaleTimeString()}`;\n}\n\nfunction onTrackedItems(rawItems) {\n    const trackedItems = rawItems.map(item => ({\n        ...item,\n        dateTime: formatDate(item.timestamp),\n        isWatched: item.statuses.includes(ITEM_STATUS.WATCHED),\n        isNotFound: item.statuses.includes(ITEM_STATUS.NOT_FOUND),\n        isHigher: item.statuses.includes(ITEM_STATUS.INCREASED),\n        isLower: item.statuses.includes(ITEM_STATUS.DECREASED),\n        diffPercBackground: item.diffPercentage && item.diffPercentage > 0 ? \"red\" : \"green\"\n    }));\n    trackedItemsContainer.innerHTML = listItemsLoader({trackedItems});\n\n    trackedItemsList = document.getElementById(\"tracked-items-list\");\n    addRemoveEvents(\".item-container .item-delete\");\n}\n\nfunction addRemoveEvents(selection) {\n    const deleteElements = document.body.querySelectorAll(selection);\n    for (let elem in deleteElements) {\n        if (deleteElements.hasOwnProperty(elem)) {\n            const element = deleteElements[elem];\n            const url = element.getAttribute(\"data-item-url\");\n            element.onclick = removeItem.bind(null, url, element.parentElement);\n        }\n    }\n}\n\nfunction removeItem(url, listItemElement) {\n    chrome.runtime.sendMessage({\n        type: \"TRACKED_ITEMS.UNFOLLOW\",\n        payload: {url}\n    }, onItemRemoved.bind(null, listItemElement));\n}\n\nfunction updateTrackedItems() {\n    chrome.runtime.sendMessage({type: \"TRACKED_ITEMS.GET\"}, onTrackedItems);\n}\n\nfunction registerHelpers() {\n    Handlebars.registerHelper(\"diffPercentage\", value => {\n        let percentage = parseInt(value, 10);\n        // default: 1 digit\n        let x = 110;\n        let fontSize = 180;\n        if (percentage >= 10 || percentage <= -10) {\n            x = 50;\n            fontSize = 175;\n        }\n        if (percentage >= 100 || percentage <= -100) {\n            x = 60;\n            fontSize = 170;\n        }\n        if (percentage > 0) {\n            percentage = `+${percentage}`;\n        }\n        return new Handlebars.SafeString(\n            `<text x=\"${x}\" y=\"310\" font-family=\"Verdana\" font-weight=\"bold\" font-size=\"${fontSize}\" fill=\"#fff1cb\" letter-spacing=\"-10\">\n                ${percentage}%\n            </text>`\n        );\n    });\n    Handlebars.registerHelper(\"targetPrice\", function registerTargetPrice(){\n        return this.price !== this.currentPrice ?\n            new Handlebars.SafeString(`<span class=\"item-label target-price\" title=\"Price the last time you marked it\">${this.price}</span>`) :\n            \"\";\n    });\n}\n\nfunction setupUpdateTrackedItems() {\n    updateTrackedItems();\n    // TEMP: uncomment to refresh\n    setInterval(updateTrackedItems, REFRESH_INTERVAL);\n}\n\nfunction bootstrap() {\n    registerHelpers();\n\n    trackedItemsContainer = document.getElementById(\"tracked-items-container\");\n    listItemsLoader = loadTemplate(\"items-list\");\n\n    setupUpdateTrackedItems();\n}\n\nfunction onItemRemoved(listItemElement, wasRemoved) {\n    if (wasRemoved) {\n        trackedItemsList.removeChild(listItemElement);\n        if (trackedItemsList.children.length === 0) {\n            updateTrackedItems();\n        }\n    }\n}\n\nbootstrap();\n"],"names":["trackedItemsContainer","trackedItemsList","listItemsLoader","ITEM_STATUS","WATCHED","NOT_FOUND","INCREASED","DECREASED","FIXED","REFRESH_INTERVAL","onTrackedItems","rawItems","trackedItems","map","item","dateTime","timestamp","date","Date","toLocaleDateString","toLocaleTimeString","formatDate","isWatched","statuses","includes","isNotFound","isHigher","isLower","diffPercBackground","diffPercentage","innerHTML","document","getElementById","selection","deleteElements","body","querySelectorAll","elem","hasOwnProperty","element","url","getAttribute","onclick","removeItem","bind","parentElement","addRemoveEvents","listItemElement","chrome","runtime","sendMessage","type","payload","wasRemoved","removeChild","children","length","updateTrackedItems","Handlebars","registerHelper","value","percentage","parseInt","x","fontSize","SafeString","this","price","currentPrice","elementId","elementHTML","compile","loadTemplate","setInterval"],"mappings":"iJAAA,IAAIA,EACAC,EACAC,EAEJ,MAAMC,EAAc,CAChBC,QAAS,UACTC,UAAW,YACXC,UAAW,YACXC,UAAW,YACXC,MAAO,SAGLC,EAAmB,KAYzB,SAASC,EAAeC,SACdC,EAAeD,EAASE,IAAIC,2UAC3BA,GACHC,SARR,SAAoBC,SACVC,EAAO,IAAIC,KAAKF,YACZC,EAAKE,wBAAwBF,EAAKG,uBAM9BC,CAAWP,EAAKE,WAC1BM,UAAWR,EAAKS,SAASC,SAASrB,EAAYC,SAC9CqB,WAAYX,EAAKS,SAASC,SAASrB,EAAYE,WAC/CqB,SAAUZ,EAAKS,SAASC,SAASrB,EAAYG,WAC7CqB,QAASb,EAAKS,SAASC,SAASrB,EAAYI,WAC5CqB,mBAAoBd,EAAKe,gBAAkBf,EAAKe,eAAiB,EAAI,MAAQ,WAEjF7B,EAAsB8B,UAAY5B,EAAgB,CAACU,aAAAA,IAEnDX,EAAmB8B,SAASC,eAAe,sBAI/C,SAAyBC,SACfC,EAAiBH,SAASI,KAAKC,iBAAiBH,OACjD,IAAII,KAAQH,KACTA,EAAeI,eAAeD,GAAO,OAC/BE,EAAUL,EAAeG,GACzBG,EAAMD,EAAQE,aAAa,iBACjCF,EAAQG,QAAUC,EAAWC,KAAK,KAAMJ,EAAKD,EAAQM,gBAT7DC,CAAgB,gCAcpB,SAASH,EAAWH,EAAKO,GACrBC,OAAOC,QAAQC,YAAY,CACvBC,KAAM,yBACNC,QAAS,CAACZ,IAAAA,IAqDlB,SAAuBO,EAAiBM,GAChCA,IACApD,EAAiBqD,YAAYP,GACY,IAArC9C,EAAiBsD,SAASC,QAC1BC,MAxDSb,KAAK,KAAMG,IAGhC,SAASU,IACLT,OAAOC,QAAQC,YAAY,CAACC,KAAM,qBAAsBzC,GAIxDgD,WAAWC,eAAe,iBAAkBC,QACpCC,EAAaC,SAASF,EAAO,IAE7BG,EAAI,IACJC,EAAW,WACXH,GAAc,IAAMA,IAAe,MACnCE,EAAI,GACJC,EAAW,MAEXH,GAAc,KAAOA,IAAe,OACpCE,EAAI,GACJC,EAAW,KAEXH,EAAa,IACbA,MAAiBA,KAEd,IAAIH,WAAWO,uBACNF,kEAAkEC,4DACxEH,6BAIdH,WAAWC,eAAe,cAAe,kBAC9BO,KAAKC,QAAUD,KAAKE,aACvB,IAAIV,WAAWO,8FAA8FC,KAAKC,gBAClH,KAaRnE,EAAwB+B,SAASC,eAAe,2BAChD9B,EAxFJ,SAAsBmE,SACZC,EAAcvC,SAASC,eAAeqC,GAAWvC,iBAChD4B,WAAWa,QAAQD,GAsFRE,CAAa,cAT/Bf,IAEAgB,YAAYhB,EAAoBhD"}