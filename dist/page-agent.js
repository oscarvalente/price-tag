!function(){"use strict";function t(){const t=function(){const t=document.getElementsByTagName("link");for(let e of t)if("icon"===e.getAttribute("rel")||"shortcut icon"===e.getAttribute("rel"))return e.getAttribute("href");return null}();return t?t.startsWith(location.protocol)||t.startsWith("//")?t:t.startsWith("/")?`${location.protocol}//${location.hostname}${t}`:`${location.href}/${t}`:null}function e(e,o){const n=document.body.querySelector(e),r=n?n.textContent:null;if(r){const n=r.match(/((?:\d+[.,])?\d+(?:[.,]\d+)?)/);if(n){const[,r]=n;o({status:1,selection:e,price:r,faviconURL:t(),name:document.title})}else o({status:-2})}else o({status:-1})}function o(){chrome.runtime.onMessage.addListener(({type:o,payload:n={}},r,c)=>{let s,l,u,i,{originalBackgroundColor:a}=n;const{selection:d,elementId:m}=n;switch(o){case"RECORD.START":return document.body.style.cursor="pointer",window.focus(),document.body.onclick=function(e){e.preventDefault(),e.stopPropagation();const{target:o,path:r}=e,{url:l}=n,{textContent:u}=o,i=function(t,e){const o=[];let n=1;for(let r of t){let{localName:t,className:c,id:s}=r;if(!(e>=n))break;{const e=c?`${t.trim()}.${c.trim().replace(/\s/g,".")}`:s?`${t.trim()}#${s}`:t.trim();o.push(e)}n++}return o.reverse().join(" ")}(r,3);let a=null;if(l){if(u){const e=u.match(/((?:\d+[.,])?\d+(?:[.,]\d+)?)/);e?([,a]=e,c({status:1,url:l,selection:i,price:a,faviconURL:t(),name:document.title})):c({status:-3})}else c({status:-2});o.style.backgroundColor=s,document.body.style.cursor="",document.body.onclick=null,document.body.onmouseover=null}else c({status:-1})},document.body.onmouseover=(({target:t})=>{t.addEventListener("mouseout",({target:t})=>{t.style.backgroundColor=s,t.removeEventListener("mouseout",t)}),s=t.style.backgroundColor,t.style.backgroundColor="#c9ecfc"}),!0;case"RECORD.CANCEL":document.body.style.cursor="",document.body.onclick=null,document.body.onmouseover=null,c({});break;case"AUTO_SAVE.CHECK_STATUS":case"PRICE_UPDATE.CHECK_STATUS":return"complete"!==document.readyState?(window.onload=(()=>{e(d,c),window.onload=null}),!0):(e(d,c),!1);case"PRICE_TAG.HIGHLIGHT.START":if(l=document.body.querySelector(d)){const t=l.style.backgroundColor;l.style.backgroundColor="#c9ecfc",c({status:1,isHighlighted:!0,originalBackgroundColor:t})}else c({status:-1});break;case"PRICE_TAG.HIGHLIGHT.STOP":a=a||"",(u=document.body.querySelector(d))?(u.style.backgroundColor=a,c({status:1,isHighlighted:!1})):c({status:-1});break;case"CONFIRMATION_DISPLAY.CREATE":return function(t,e){const o=`chrome-extension://${chrome.runtime.id}`;if(!location.ancestorOrigins.contains(o)){const o=document.createElement("iframe");return t&&o.setAttribute("id",t),o.src=chrome.runtime.getURL("views/modal.html"),o.onload=(()=>{e({status:1})}),o.style.cssText="position:fixed;top:0;right:0;display:block;width:700px;height:100%;z-index:1000;border:0;margin-top: 200px;",document.body.appendChild(o),!0}return e({status:-1}),!1}(m,c);case"CONFIRMATION_DISPLAY.REMOVE":(i=document.getElementById(m))&&i.remove()}})}o()}();
