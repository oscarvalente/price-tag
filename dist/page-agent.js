!function(){"use strict";function t(){const t=function(){const t=document.getElementsByTagName("link");for(let e of t)if("icon"===e.getAttribute("rel")||"shortcut icon"===e.getAttribute("rel"))return e.getAttribute("href");return null}();return t?t.startsWith(location.protocol)||t.startsWith("//")?t:t.startsWith("/")?`${location.protocol}//${location.hostname}${t}`:`${location.href}/${t}`:null}function e(e,o){const n=document.body.querySelector(e),c=n?n.textContent:null;if(c){const n=c.match(/((?:\d+[.,])?\d+(?:[.,]\d+)?)/);if(n){const[,c]=n;o({status:1,selection:e,price:c,faviconURL:t(),faviconAlt:document.title})}else o({status:-2})}else o({status:-1})}function o(){chrome.runtime.onMessage.addListener(({type:o,payload:n={}},c,s)=>{const{selection:r}=n;switch(o){case"RECORD.START":let c;return document.body.style.cursor="pointer",window.focus(),document.body.onclick=function(e){e.preventDefault(),e.stopPropagation();const{target:o,path:r}=e,{url:l}=n,{textContent:i}=o,u=function(t,e){const o=[];let n=1;for(let c of t){let{localName:t,className:s,id:r}=c;if(!(e>=n))break;{const e=s?`${t.trim()}.${s.trim().replace(/\s/g,".")}`:r?`${t.trim()}#${r}`:t.trim();o.push(e)}n++}return o.reverse().join(" ")}(r,3);let a=null;if(l){if(i){const e=i.match(/((?:\d+[.,])?\d+(?:[.,]\d+)?)/);e?([,a]=e,s({status:1,url:l,selection:u,price:a,faviconURL:t(),faviconAlt:document.title})):s({status:-3})}else s({status:-2});o.style.backgroundColor=c,document.body.style.cursor="",document.body.onclick=null,document.body.onmouseover=null}else s({status:-1})},document.body.onmouseover=(({target:t})=>{t.addEventListener("mouseout",({target:t})=>{t.style.backgroundColor=c,t.removeEventListener("mouseout",t)}),c=t.style.backgroundColor,t.style.backgroundColor="#c9ecfc"}),!0;case"RECORD.CANCEL":document.body.style.cursor="",document.body.onclick=null,document.body.onmouseover=null,s({});break;case"AUTO_SAVE.CHECK_STATUS":case"PRICE_UPDATE.CHECK_STATUS":return"complete"!==document.readyState?(window.onload=(()=>{e(r,s),window.onload=null}),!0):(e(r,s),!1);case"PRICE_TAG.HIGHLIGHT.START":const{selection:l}=n,i=document.body.querySelector(l);if(i){const t=i.style.backgroundColor;i.style.backgroundColor="#c9ecfc",s({status:1,isHighlighted:!0,originalBackgroundColor:t})}else s({status:-1});break;case"PRICE_TAG.HIGHLIGHT.STOP":const{selection:u}=n;let{originalBackgroundColor:a}=n;a=a||"";const d=document.body.querySelector(u);d?(d.style.backgroundColor=a,s({status:1,isHighlighted:!1})):s({status:-1});break;case"CONFIRMATION_DISPLAY.CREATE":const{elementId:m}=n;return function(t,e){const o=`chrome-extension://${chrome.runtime.id}`;if(!location.ancestorOrigins.contains(o)){const o=document.createElement("iframe");return t&&o.setAttribute("id",t),o.src=chrome.runtime.getURL("views/modal.html"),o.onload=(()=>{e({status:1})}),o.style.cssText="position:fixed;top:0;right:0;display:block;width:700px;height:100%;z-index:1000;border:0;margin-top: 200px;",document.body.appendChild(o),!0}return e({status:-1}),!1}(m,s);case"CONFIRMATION_DISPLAY.REMOVE":const{elementId:y}=n,f=document.getElementById(y);f&&f.remove()}})}o()}();
