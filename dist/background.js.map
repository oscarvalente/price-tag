{"version":3,"file":"background.js","sources":["../background.js"],"sourcesContent":["let State = {\n    recordActive: false,\n    notifications: {},\n    notificationsCounter: 0,\n    autoSaveEnabled: false,\n    isPriceUpdateEnabled: false,\n    selection: null,\n    isSimilarElementHighlighted: false,\n    originalBackgroundColor: null,\n    isCurrentPageTracked: false,\n    faviconURL: null,\n    _faviconURLMap: {},\n    currentURL: null,\n    canonicalURL: null,\n    browserURL: null,\n    domain: null\n};\n\nconst DEFAULT_ICON = \"assets/icon_48.png\";\nconst TRACKED_ITEM_ICON = \"assets/icon_active_48.png\";\nconst DEFAULT_TITLE = \"Price Tag\";\nconst TRACKED_ITEM_TITLE = \"Price Tag - This item is being tracked\";\n\nconst PRICE_CHECKING_INTERVAL = 180000;\n// const PRICE_CHECKING_INTERVAL = 10000;\nconst SYNCHING_INTERVAL = 120000;\nconst ICONS = {\n    PRICE_UPDATE: \"./assets/time-is-money.svg\",\n    PRICE_NOT_FOUND: \"./assets/time.svg\",\n    PRICE_FIX: \"./assets/coin.svg\"\n};\n\nconst MATCHES = {\n    PRICE: /((?:\\d+[.,])?\\d+(?:[.,]\\d+)?)/,\n    HOSTNAME: /https?:\\/\\/([\\w.]+)\\/*/,\n    DOMAIN: /^([\\w-]+\\.)+[\\w-]+\\w$/,\n    URL: /^https?:\\/\\/([\\w-]+\\.)+[\\w-]+\\w(\\/[\\w-=.]+)+\\/?(\\?([\\w]+=?[\\w-%!@()\\\\[\"#\\]]+&?)*)?/,\n    CAPTURE: {\n        DOMAIN_IN_URL: /https?:\\/\\/([\\w.]+)\\/*/,\n        HOSTNAME_AND_PATH: /^https?:\\/\\/((?:[\\w-]+\\.)+[\\w-]+\\w(?:\\/[\\w-=.]+)+\\/?)/,\n        PROTOCOL_HOSTNAME_AND_PATH: /^(https?:\\/\\/(?:[\\w-]+\\.)+[\\w-]+\\w(?:\\/[\\w-=.]+)+\\/?)/\n    }\n};\n\nconst ITEM_STATUS = {\n    WATCHED: \"WATCHED\",\n    NOT_FOUND: \"NOT_FOUND\",\n    INCREASED: \"INCREASED\",\n    DECREASED: \"DECREASED\",\n    ACK_DECREASE: \"ACK_DECREASE\",\n    ACK_INCREASE: \"ACK_INCREASE\",\n    FIXED: \"FIXED\"\n};\n\nconst ALL_ITEM_STATUSES = Object.values(ITEM_STATUS);\n\nfunction removeStatuses(item, statusesToRemove = []) {\n    return statusesToRemove.length > 0 && item.statuses.length > 0 ?\n        item.statuses.filter(status => !statusesToRemove.includes(status)) :\n        item.statuses;\n}\n\nfunction toUnique(array) {\n    return Array.from(new Set(array));\n}\n\nfunction updateItemCurrentPrice(item, newPrice) {\n    const previousPrice = item.currentPrice;\n\n    const newItem = {\n        ...item,\n        previousPrice,\n        currentPrice: newPrice\n    };\n\n    return updateItemDiffPercentage(newItem);\n}\n\nfunction updateItemDiffPercentage(item) {\n    const diff = Math.abs(item.currentPrice - item.price) * 100 / item.price;\n    const diffPerc = parseFloat(diff.toFixed(2));\n    let diffPercentage = null;\n    if (diffPerc) {\n        diffPercentage = item.currentPrice > item.price ?\n            +diffPerc :\n            -diffPerc;\n\n        if (diffPercentage > 0 && diffPercentage < 1) {\n            diffPercentage = Math.ceil(diffPercentage);\n        } else if (diffPercentage > -1 && diffPercentage < 0) {\n            diffPercentage = Math.floor(diffPercentage);\n        }\n    }\n\n    item.diffPercentage = diffPercentage;\n\n    return item;\n}\n\nfunction updateItemTrackStatus(item, newPrice, statusesToAdd, statusesToRemove, forceStartingPrice = false) {\n    if (!statusesToAdd) {\n        statusesToAdd = [];\n    }\n\n    if (!statusesToRemove) {\n        statusesToRemove = [];\n    }\n\n    const statuses = toUnique([...removeStatuses(item, statusesToRemove), ...statusesToAdd]);\n    const updatedItem = {\n        ...item,\n        statuses,\n        lastUpdateTimestamp: new Date().getTime()\n    };\n\n    if (forceStartingPrice) {\n        updatedItem.startingPrice = item.price;\n    }\n\n    if (newPrice) {\n        updatedItem.price = newPrice;\n    }\n\n    return updatedItem;\n}\n\nfunction isWatched(item) {\n    return item.statuses.includes(ITEM_STATUS.WATCHED);\n}\n\nfunction isNotFound(item) {\n    return item.statuses.includes(ITEM_STATUS.NOT_FOUND);\n}\n\nfunction hasAcknowledgeDecrease(item) {\n    return item.statuses.includes(ITEM_STATUS.ACK_DECREASE);\n}\n\nfunction hasAcknowledgeIncrease(item) {\n    return item.statuses.includes(ITEM_STATUS.ACK_INCREASE);\n}\n\nfunction onConfirmURLForCreateItemAttempt(tabId, domain, url, selection, price, faviconURL, faviconAlt, callback) {\n    const modalElementId = \"price-tag--url-confirmation\";\n    chrome.tabs.sendMessage(tabId, {\n        type: \"CONFIRMATION_DISPLAY.CREATE\",\n        payload: {elementId: modalElementId}\n    }, ({status}) => {\n        if (status === 1) {\n            const payload = buildURLConfirmationPayload(State.canonicalURL, State.browserURL, domain);\n            chrome.tabs.sendMessage(tabId, {\n                type: \"CONFIRMATION_DISPLAY.LOAD\",\n                payload\n            }, ({status, index}) => {\n                chrome.tabs.sendMessage(tabId, {\n                    type: \"CONFIRMATION_DISPLAY.REMOVE\",\n                    payload: {elementId: modalElementId}\n                });\n\n                if (status === 1) {\n                    switch (index) {\n                        case 0:\n                            // said Yes, can use canonical and remember this option\n                            chrome.storage.local.get([domain], result => {\n                                const domainState = result && result[domain] && JSON.parse(result[domain]) || {};\n                                domainState._canUseCanonical = true;\n                                chrome.storage.local.set({[domain]: JSON.stringify(domainState)});\n                                State = updateCurrentURL(State, State.canonicalURL);\n                                callback(true, true);\n                            });\n                            break;\n                        case 1:\n                            // said Yes, but use canonical just this time\n                            State = updateCurrentURL(State, State.canonicalURL);\n                            callback(true, true);\n                            break;\n                        case 2:\n                            // said No, use browser URL and remember this option\n                            chrome.storage.local.get([domain], result => {\n                                const domainState = result && result[domain] && JSON.parse(result[domain]) || {};\n                                domainState._canUseCanonical = false;\n                                chrome.storage.local.set({[domain]: JSON.stringify(domainState)});\n                                State = updateCurrentURL(State, State.browserURL);\n                                callback(true, false);\n                            });\n                            break;\n                        case 3:\n                            // said No, use browser URL but ask again\n                            State = updateCurrentURL(State, State.browserURL);\n                            callback(true, false);\n                            break;\n                        default:\n                            // cannot recognize this modal button click\n                            callback(false);\n                            break;\n                    }\n                }\n            });\n        }\n    });\n}\n\nfunction onRecordDone(tabId, payload) {\n    const {status, selection, price, faviconURL, faviconAlt} = payload;\n    const {currentURL, domain} = State;\n    if (status > 0) {\n        State = updateFaviconURL(State, State.faviconURL || faviconURL);\n        canDisplayURLConfirmation(State, domain, canDisplay => {\n            if (canDisplay) {\n                onConfirmURLForCreateItemAttempt(tabId, domain, currentURL, selection, price, faviconURL, faviconAlt, (canSave, useCaninocal) => {\n                    if (canSave) {\n                        const url = useCaninocal ? State.canonicalURL : State.browserURL;\n                        checkForURLSimilarity(tabId, domain, url, isToSave => {\n                            if (isToSave) {\n                                createItem(domain, url, selection, price, State.faviconURL, faviconAlt, [ITEM_STATUS.WATCHED]);\n                                updateExtensionAppearance(domain, url, true);\n                            }\n                        });\n                    }\n                });\n            } else {\n                checkForURLSimilarity(tabId, domain, currentURL, isToSave => {\n                    if (isToSave) {\n                        createItem(domain, currentURL, selection, price, State.faviconURL, faviconAlt, [ITEM_STATUS.WATCHED]);\n                        updateExtensionAppearance(domain, currentURL, true);\n                    }\n                });\n            }\n        });\n\n        State = disableRecord(State);\n    }\n}\n\nfunction onRecordCancel() {\n    State = disableRecord(State);\n}\n\nfunction onAutoSaveCheckStatus(sendResponse, {status, url, domain, selection, price, faviconURL, faviconAlt} = {}) {\n    if (status >= 0) {\n        State = updateFaviconURL(State, State.faviconURL || faviconURL);\n        State = setSelectionInfo(State, selection, price, State.faviconURL, faviconAlt);\n        sendResponse(true);\n    } else {\n        sendResponse(false);\n    }\n}\n\nfunction onPriceUpdateCheckStatus(sendResponse, trackedPrice, {status, selection, price, faviconURL, faviconAlt} = {}) {\n    if (status >= 0) {\n        State = updateFaviconURL(State, State.faviconURL || faviconURL);\n        State = setSelectionInfo(State, selection, price, State.faviconURL, faviconAlt);\n        if (toPrice(price) !== trackedPrice) {\n            sendResponse(true);\n            return;\n        }\n    }\n\n    sendResponse(false);\n}\n\nfunction onSimilarElementHighlight({status, isHighlighted: isSimilarElementHighlighted, originalBackgroundColor = null}) {\n    if (status >= 0) {\n        State = setSimilarElementHighlight(State, isSimilarElementHighlighted, originalBackgroundColor);\n    }\n}\n\nfunction createTrackedItem(selection, trackedPrice, previousPrice, faviconURL, faviconAlt, statuses) {\n    if (!previousPrice) {\n        previousPrice = null;\n    }\n\n    const price = toPrice(trackedPrice);\n\n    return {\n        selection,\n        price,\n        currentPrice: price,\n        startingPrice: price,\n        previousPrice,\n        faviconURL,\n        faviconAlt,\n        timestamp: new Date().getTime(),\n        statuses\n    };\n}\n\n// TODO: price becomes a class\nfunction createItem(domain, url, selection, price, faviconURL, faviconAlt, statuses, callback) {\n    chrome.storage.local.get([domain], result => {\n        const items = result && result[domain] ? JSON.parse(result[domain]) : {};\n        items[url] = createTrackedItem(selection, price, undefined, faviconURL, faviconAlt, statuses);\n\n        chrome.storage.local.set({[domain]: JSON.stringify(items)}, () => {\n            State = disableAutoSave(State);\n            if (callback) {\n                callback();\n            }\n            // TODO: sendResponse(\"done\"); // foi gravado ou não\n        });\n    });\n}\n\nfunction toggleRecord(state) {\n    return {\n        ...state,\n        recordActive: !state.recordActive\n    }\n}\n\nfunction disableRecord(state) {\n    return {\n        ...state,\n        recordActive: false\n    }\n}\n\nfunction disableCurrentPageTracked(state) {\n    return {\n        ...state,\n        isCurrentPageTracked: false\n    };\n}\n\nfunction enableCurrentPageTracked(state) {\n    return {\n        ...state,\n        isCurrentPageTracked: true\n    };\n}\n\nfunction updateCurrentDomain(state, domain) {\n    return {\n        ...state,\n        domain\n    };\n}\n\nfunction updateCurrentURL(state, currentURL) {\n    return {\n        ...state,\n        currentURL\n    };\n}\n\nfunction updateCanonicalURL(state, canonicalURL) {\n    return {\n        ...state,\n        canonicalURL\n    };\n}\n\nfunction updateBrowserURL(state, browserURL) {\n    return {\n        ...state,\n        browserURL\n    };\n}\n\nfunction updateFaviconURL(state, faviconURL) {\n    return {\n        ...state,\n        faviconURL\n    };\n}\n\nfunction updateFaviconURLMapItem(state, tabId, faviconURL) {\n    return {\n        ...state,\n        _faviconURLMap: {\n            ...state._faviconURLMap,\n            [tabId]: faviconURL\n        }\n    };\n}\n\nfunction incrementNotificationsCounter(state) {\n    const notificationsCounter = state.notificationsCounter + 1;\n    return {\n        ...state,\n        notificationsCounter\n    }\n}\n\nfunction deleteNotificationsItem(state, notificationId) {\n    const newState = {...state};\n    delete newState.notifications[notificationId];\n    return newState;\n}\n\nfunction updateNotificationsItem(state, notificationId, notificationState) {\n    return {\n        ...state,\n        notifications: {\n            ...state.notifications,\n            [notificationId]: notificationState\n        }\n    };\n}\n\nfunction canDisplayURLConfirmation(state, domain, callback) {\n    chrome.storage.local.get([domain], result => {\n        const domainState = result && result[domain] && JSON.parse(result[domain]) || null;\n        const isUseCanonicalPrefUnset = !domainState || domainState._canUseCanonical === undefined;\n        callback(isUseCanonicalPrefUnset && !!state.canonicalURL &&\n            state.canonicalURL !== state.browserURL);\n    });\n}\n\nfunction setDefaultAppearance() {\n    chrome.browserAction.setTitle({title: DEFAULT_TITLE});\n    chrome.browserAction.setIcon({path: DEFAULT_ICON});\n}\n\nfunction setTrackedItemAppearance() {\n    chrome.browserAction.setTitle({title: TRACKED_ITEM_TITLE});\n    chrome.browserAction.setIcon({path: TRACKED_ITEM_ICON});\n}\n\nfunction enableAutoSave(state, selection) {\n    selection = selection || state.selection;\n    return {\n        ...state,\n        autoSaveEnabled: true,\n        selection\n    };\n}\n\nfunction disableAutoSave(state) {\n    return {\n        ...state,\n        autoSaveEnabled: false\n    };\n}\n\nfunction enablePriceUpdate(state, selection) {\n    return {\n        ...state,\n        isPriceUpdateEnabled: true,\n        selection\n    };\n}\n\nfunction disablePriceUpdate(state) {\n    return {\n        ...state,\n        isPriceUpdateEnabled: false\n    };\n}\n\nfunction setSelectionInfo(state, selection, price, faviconURL, faviconAlt) {\n    return {\n        ...state,\n        selection,\n        price,\n        faviconURL,\n        faviconAlt\n    };\n}\n\nfunction setSimilarElementHighlight(state, isSimilarElementHighlighted, originalBackgroundColor) {\n    return {\n        ...state,\n        isSimilarElementHighlighted,\n        originalBackgroundColor\n    };\n}\n\nfunction checkForPriceChanges() {\n    chrome.storage.local.get(null, result => {\n        for (let domain in result) {\n            if (result.hasOwnProperty(domain) && matchesDomain(domain)) {\n                const domainItems = JSON.parse(result[domain]);\n\n                for (let url in domainItems) {\n                    if (domainItems.hasOwnProperty(url) && matchesURL(url) && isWatched(domainItems[url])) {\n                        const request = new XMLHttpRequest();\n                        const {price: targetPrice, currentPrice} = domainItems[url];\n\n                        request.onload = function () {\n                            const template = createHTMLTemplate(this.response);\n                            try {\n                                let newPrice = null;\n                                const textContent = template.querySelector(domainItems[url].selection).textContent;\n                                if (textContent) {\n                                    const textContentMatch = textContent.match(MATCHES.PRICE);\n                                    if (textContentMatch) {\n                                        [, newPrice] = textContentMatch;\n\n                                        newPrice = toPrice(newPrice);\n\n                                        if (!targetPrice) {\n                                            domainItems[url] = updateItemTrackStatus(domainItems[url], newPrice,\n                                                [ITEM_STATUS.FIXED], [ITEM_STATUS.NOT_FOUND]);\n                                            chrome.storage.local.set({[domain]: JSON.stringify(domainItems)}, () => {\n                                                const notificationId = `TRACK.PRICE_FIXED-${State.notificationsCounter}`;\n                                                createNotification(notificationId, ICONS.PRICE_FIX, \"Fixed price\",\n                                                    `Ermm.. We've just fixed a wrongly set price to ${newPrice}`, url, url, domain);\n                                            });\n                                        } else if (newPrice < currentPrice) {\n                                            const updatedItem = updateItemCurrentPrice(domainItems[url], newPrice);\n                                            domainItems[url] = updateItemTrackStatus(updatedItem, null,\n                                                [ITEM_STATUS.DECREASED],\n                                                [ITEM_STATUS.INCREASED, ITEM_STATUS.NOT_FOUND, ITEM_STATUS.ACK_DECREASE]);\n\n                                            chrome.storage.local.set({[domain]: JSON.stringify(domainItems)}, () => {\n                                                // TODO: sendResponse(\"done\"); // foi actualizado ou não\n                                                if (newPrice < targetPrice && !hasAcknowledgeDecrease(domainItems[url])) {\n                                                    const notificationId = `TRACK.PRICE_UPDATE-${State.notificationsCounter}`;\n                                                    createNotification(notificationId, ICONS.PRICE_UPDATE, \"Lower price!!\",\n                                                        `${newPrice} (previous ${targetPrice})`, url, url, domain, ITEM_STATUS.DECREASED,\n                                                        {\n                                                            buttons: [\n                                                                {\n                                                                    title: `Keep tracking but w/ new price (${newPrice})`\n                                                                },\n                                                                {\n                                                                    title: \"Stop watching\"\n                                                                }\n                                                            ]\n                                                        });\n                                                }\n                                            });\n                                        } else if (newPrice > currentPrice) {\n                                            const updatedItem = updateItemCurrentPrice(domainItems[url], newPrice); // update current price and previous\n                                            domainItems[url] = updateItemTrackStatus(updatedItem, null,\n                                                [ITEM_STATUS.INCREASED],\n                                                [ITEM_STATUS.DECREASED, ITEM_STATUS.NOT_FOUND, ITEM_STATUS.ACK_INCREASE]);\n\n                                            chrome.storage.local.set({[domain]: JSON.stringify(domainItems)}, () => {\n                                                // TODO: sendResponse(\"done\"); // foi actualizado ou não\n\n                                                if (!hasAcknowledgeIncrease(domainItems[url])) {\n                                                    const notificationId = `TRACK.PRICE_UPDATE-${State.notificationsCounter}`;\n                                                    const notificationOptions = domainItems[url].price !== domainItems[url].previousPrice ?\n                                                        {\n                                                            buttons: [\n                                                                {\n                                                                    title: `Increase interest price to the previous (${domainItems[url].previousPrice})`\n                                                                }\n                                                            ]\n                                                        } :\n                                                        {\n                                                            buttons: []\n                                                        };\n                                                    notificationOptions.buttons.push(\n                                                        {\n                                                            title: \"Stop watching\"\n                                                        }\n                                                    );\n                                                    createNotification(notificationId, ICONS.PRICE_UPDATE, \"Price increase\",\n                                                        `${newPrice} (previous ${domainItems[url].previousPrice})`, url, url, domain, ITEM_STATUS.INCREASED,\n                                                        notificationOptions);\n                                                }\n                                            });\n                                        } else if (!isNotFound(domainItems[url])) { // NOTE: Here, price is the same\n                                            domainItems[url] = updateItemTrackStatus(domainItems[url], null,\n                                                null, [ITEM_STATUS.NOT_FOUND]);\n                                            chrome.storage.local.set({[domain]: JSON.stringify(domainItems)}, () => {\n                                                // TODO: sendResponse(\"done\"); // foi actualizado ou não\n                                            });\n                                        } else {\n                                            domainItems[url] = updateItemTrackStatus(domainItems[url], null,\n                                                null, [ITEM_STATUS.NOT_FOUND]);\n                                            chrome.storage.local.set({[domain]: JSON.stringify(domainItems)});\n                                        }\n                                    }\n                                }\n\n                                if (domainItems[url].price && !newPrice) {\n                                    if (!isNotFound(domainItems[url])) {\n                                        domainItems[url] = updateItemTrackStatus(domainItems[url], null,\n                                            [ITEM_STATUS.NOT_FOUND],\n                                            [ITEM_STATUS.DECREASED, ITEM_STATUS.INCREASED, ITEM_STATUS.FIXED, ITEM_STATUS.ACK_DECREASE]);\n\n                                        chrome.storage.local.set({[domain]: JSON.stringify(domainItems)}, () => {\n                                            // TODO: sendResponse(\"done\"); // foi actualizado ou não\n                                            const notificationId = `TRACK.PRICE_NOT_FOUND-${State.notificationsCounter}`;\n                                            const previousPrice = targetPrice ? ` (previous ${targetPrice})` : \"\";\n                                            createNotification(notificationId, ICONS.PRICE_NOT_FOUND, \"Price gone\",\n                                                `Price tag no longer found${previousPrice}`, url, url, domain);\n                                        });\n                                    }\n                                }\n                            } catch (e) {\n                                if (!isNotFound(domainItems[url])) {\n                                    console.warn(`Invalid price selection element in\\n${url}:\\t\"${domainItems[url].selection}\"`);\n                                    domainItems[url] = updateItemTrackStatus(domainItems[url], null,\n                                        [ITEM_STATUS.NOT_FOUND],\n                                        [ITEM_STATUS.DECREASED, ITEM_STATUS.INCREASED, ITEM_STATUS.FIXED, ITEM_STATUS.ACK_DECREASE]);\n\n                                    chrome.storage.local.set({[domain]: JSON.stringify(domainItems)}, () => {\n                                        const notificationId = `TRACK.PRICE_NOT_FOUND-${State.notificationsCounter}`;\n                                        const previousPrice = targetPrice ? ` (previous ${targetPrice})` : \"\";\n                                        createNotification(notificationId, ICONS.PRICE_NOT_FOUND, \"Price gone\",\n                                            `Price tag no longer found${previousPrice}`, url, url, domain);\n                                    });\n                                }\n                            }\n                        };\n\n                        request.open(\"GET\", url);\n                        request.send();\n                    }\n                }\n            }\n        }\n    });\n}\n\nfunction getTrackedItems(callback) {\n    chrome.storage.local.get(null, result => {\n        let trackedItems = [];\n        Object.keys(result).forEach(key => {\n            if (matchesDomain(key)) {\n                const domainData = result[key];\n                const domainItems = JSON.parse(domainData) || null;\n                if (domainItems) {\n                    let items = [];\n                    Object.keys(domainItems).forEach(url => {\n                        if (matchesHostname(url) && isWatched(domainItems[url])) {\n                            const item = {\n                                ...domainItems[url],\n                                url: url\n                            };\n                            items.push(item);\n                        }\n                    });\n                    trackedItems = [...trackedItems, ...items];\n                }\n            }\n        });\n        trackedItems.sort(sortItemsByTime);\n        callback(trackedItems);\n    });\n}\n\nfunction removeTrackedItem(url, currentURL, callback) {\n    let found = false;\n    chrome.storage.local.get(null, result => {\n        Object.keys(result).forEach(domain => {\n            if (matchesDomain(domain)) {\n                const domainData = result[domain];\n                const domainItems = JSON.parse(domainData) || null;\n                if (domainItems[url]) {\n                    found = true;\n\n                    domainItems[url] = updateItemTrackStatus(domainItems[url], null, null, ALL_ITEM_STATUSES); // stop watching\n                    chrome.storage.local.set({[domain]: JSON.stringify(domainItems)}, () => {\n                        if (currentURL === url) {\n                            updateAutoSaveStatus(url, domain);\n                            updatePriceUpdateStatus(url, domain);\n                            updateExtensionAppearance(domain, url, false);\n                        }\n                        callback(true);\n                    });\n                }\n            }\n        });\n        if (!found) {\n            callback(false);\n        }\n    });\n}\n\nfunction clearNotification(notifId, wasClosedByUser) {\n    chrome.notifications.clear(notifId, wasClickedByUser => {\n        if (wasClickedByUser || wasClosedByUser) {\n            const {domain, url, type} = State.notifications[notifId];\n            chrome.storage.local.get([domain], result => {\n                const domainItems = result && result[domain] ? JSON.parse(result[domain]) : null;\n                switch (type) {\n                    case ITEM_STATUS.DECREASED:\n                        domainItems[url] = updateItemTrackStatus(domainItems[url], null, [ITEM_STATUS.ACK_DECREASE]);\n                        break;\n                    case ITEM_STATUS.INCREASED:\n                        domainItems[url] = updateItemTrackStatus(domainItems[url], null, [ITEM_STATUS.ACK_INCREASE]);\n                        break;\n                }\n\n                chrome.storage.local.set({[domain]: JSON.stringify(domainItems)});\n            });\n        }\n\n        State = deleteNotificationsItem(State, notifId);\n    });\n}\n\nfunction createNotification(notifId, iconUrl, title, message, contextMessage = \"\", url, domain, type, extraOptions = {}) {\n    const options = {\n        type: \"basic\",\n        title,\n        message,\n        iconUrl,\n        contextMessage,\n        requireInteraction: true,\n        ...extraOptions\n    };\n\n    chrome.notifications.create(notifId, options, id => {\n        State = updateNotificationsItem(State, id, {\n            url,\n            domain,\n            type\n        });\n    });\n\n    State = incrementNotificationsCounter(State);\n}\n\nfunction toPrice(price) {\n    const priceNumber = parseFloat(price.replace(\",\", \".\"));\n    const formattedPrice = priceNumber.toFixed(2);\n    return parseFloat(formattedPrice);\n}\n\nfunction createHTMLTemplate(html) {\n    var template = document.createElement(\"template\");\n    html = html.trim();\n    template.innerHTML = html;\n    return template.content;\n}\n\nfunction isCanonicalURLRelevant(canonical) {\n    return canonical && matchesHostnameAndPath(canonical);\n}\n\nfunction sortItemsByTime({timestamp: tsA}, {timestamp: tsB}) {\n    return tsA - tsB;\n}\n\nfunction matchesDomain(string) {\n    return MATCHES.DOMAIN.test(string);\n}\n\nfunction matchesHostname(string) {\n    return MATCHES.HOSTNAME.test(string);\n}\n\nfunction matchesHostnameAndPath(string) {\n    return MATCHES.CAPTURE.HOSTNAME_AND_PATH.test(string);\n}\n\nfunction matchesURL(string) {\n    return MATCHES.URL.test(string);\n}\n\nfunction parseDomainState(result, domain) {\n    return result && result[domain] && JSON.parse(result[domain]) || null;\n}\n\nfunction setupTrackingPolling() {\n    checkForPriceChanges();\n    // TODO: remove settimeout (for test purposes)\n    // setTimeout(checkForPriceChanges, 20000);\n    setInterval(checkForPriceChanges, PRICE_CHECKING_INTERVAL);\n}\n\nfunction updateAutoSaveStatus(url, domain) {\n    chrome.storage.local.get([domain], result => {\n        const items = result && result[domain] ? JSON.parse(result[domain]) : {};\n        const isItemNullOrUnwatched = !items[url] || !isWatched(items[url]);\n        if (items && isItemNullOrUnwatched) {\n            const urlFromDomain = Object.keys(items)[0];\n            if (items[urlFromDomain] && items[urlFromDomain].selection) {\n                State = enableAutoSave(State, items[urlFromDomain].selection);\n            }\n        } else {\n            State = disableAutoSave(State);\n        }\n    });\n}\n\nfunction updatePriceUpdateStatus(url, domain) {\n    chrome.storage.local.get([domain], result => {\n        const items = result && result[domain] ? JSON.parse(result[domain]) : {};\n        const item = items[url];\n        const hasItemPriceIncOrDec = item && item.price !== item.currentPrice;\n        if (hasItemPriceIncOrDec) {\n            State = enablePriceUpdate(State, item.selection);\n        } else {\n            State = disablePriceUpdate(State);\n        }\n    });\n}\n\nfunction updateExtensionAppearance(currentDomain, currentURL, forcePageTrackingTo) {\n    if (forcePageTrackingTo === true) {\n        setTrackedItemAppearance();\n        State = enableCurrentPageTracked(State);\n    } else if (forcePageTrackingTo === false) {\n        setDefaultAppearance();\n        State = disableCurrentPageTracked(State);\n    } else if (!forcePageTrackingTo) {\n        // TODO: Fix bug - if domain has (_isPathEnoughToTrack === true) then ALSO try to use the path only URL\n        // TODO: (cont.) However the currentURL needs to be used too because user may have chosen the path is enough\n        // TODO: not on the first item to be tracked in this domain\n        chrome.storage.local.get([currentDomain], result => {\n            const domainState = parseDomainState(result, currentDomain);\n            if (domainState) {\n                const item = domainState[currentURL];\n                if (item && isWatched(item)) {\n                    setTrackedItemAppearance();\n                    State = enableCurrentPageTracked(State);\n                } else {\n                    setDefaultAppearance();\n                    State = disableCurrentPageTracked(State);\n                }\n            } else {\n                setDefaultAppearance();\n                State = disableCurrentPageTracked(State);\n            }\n        });\n    }\n}\n\nfunction captureHostAndPathFromURL(url) {\n    const captureHostAndPath = url.match(MATCHES.CAPTURE.HOSTNAME_AND_PATH);\n    let hostAndPath = null;\n    if (captureHostAndPath) {\n        [, hostAndPath] = captureHostAndPath;\n    }\n    return hostAndPath;\n}\n\nfunction captureProtocolHostAndPathFromURL(url) {\n    const captureProtocolHostAndPath = url.match(MATCHES.CAPTURE.PROTOCOL_HOSTNAME_AND_PATH);\n    let protocolHostAndPath = null;\n    if (captureProtocolHostAndPath) {\n        [, protocolHostAndPath] = captureProtocolHostAndPath;\n    }\n    return protocolHostAndPath;\n}\n\nfunction searchForEqualPathWatchedItem(domainState, currentURL, callback) {\n    const currentHostAndPath = captureHostAndPathFromURL(currentURL);\n    let foundOne = false;\n    for (let url in domainState) {\n        if (domainState.hasOwnProperty(url) && matchesURL(url)) {\n            if (isWatched(domainState[url])) {\n                if (currentURL === url) {\n                    //    if they're exactly the same\n                    callback(null);\n                    return;\n                } else {\n                    const hostAndPath = captureHostAndPathFromURL(url);\n                    if (hostAndPath === currentHostAndPath) {\n                        foundOne = foundOne === false;\n                        callback(url);\n                        return;\n                    }\n                }\n            }\n        }\n    }\n\n    callback(null);\n}\n\nfunction buildSaveConfirmationPayload(currentURL, similarURL) {\n    return {\n        title: \"Item with similar URL to existing one\",\n        message: \"It appears that the item URL you're trying to save:<br>\" +\n            `<i><a href=\"${currentURL}\">${currentURL}</a></i><br>` +\n            \"is pretty similar to<br>\" +\n            `<i><a href=\"${similarURL}\">${similarURL}</a></i><br><br>` +\n            \"Since your choice will affect the way items are tracked in this site futurely,<br>please help us helping you by choosing carefully one of the following options:\",\n        buttons: [\n            \"It's not, save it! Remember this option for this site.\",\n            \"Don't save. Ask me again for items of this site!\",\n            \"Indeed the same item. Don't save! Remember this option for this site. (Use just URL path for accessing items)\",\n            \"For now save this item. Ask me again next time!\"\n        ]\n    };\n}\n\nfunction buildURLConfirmationPayload(canonicalURL, browserURL, domain) {\n    return {\n        title: \"This website recommends to follow this item through a different URL\",\n        message: `<u>${domain}</u> says that a more accurate URL for this item would be:<br>` +\n            `<i><a href=\"${canonicalURL}\">${canonicalURL}</a></i><br>` +\n            \"If this is correct, we recommend you to follow it.<br><br>\" +\n            \"<b>However</b> you can still opt to choose following the current browser URL:<br>\" +\n            `<i><a href=\"${browserURL}\">${browserURL}</a></i><br><br>` +\n            \"Since your choice will affect the way items are tracked in this site futurely,<br>please help us helping you by choosing carefully one of the following options:\",\n        buttons: [\n            \"Use recommended URL. Remember this option for this site\",\n            \"Use recommended URL but just this time\",\n            \"It's not correct, use the current browser URL. Remember this option\",\n            \"Don't use recommended URL. Use the current browser URL instead but just this time\"\n        ]\n    };\n}\n\nfunction checkForURLSimilarity(tabId, domain, currentURL, callback) {\n    chrome.storage.local.get([domain], result => {\n        const domainState = result && result[domain] && JSON.parse(result[domain]) || null;\n        if (domainState) {\n            if (domainState._isPathEnoughToTrack === true) {\n                // since it's true we can say that that domain items' path is enough to track items in this domain\n                searchForEqualPathWatchedItem(domainState, currentURL, similarURL => {\n                    if (similarURL) {\n                        callback(false, false);\n                    } else {\n                        callback(true);\n                    }\n                });\n            } else if (domainState._isPathEnoughToTrack === false) {\n                callback(true);\n            } else {\n                // it's the first time user is being inquired about items similarity in this domain\n                searchForEqualPathWatchedItem(domainState, currentURL, similarURL => {\n                    if (similarURL) {\n                        // found an URL whose host and path are equals to the currentURL trying to be saved\n                        // prompt user to confirm if the item is the same\n\n                        // TODO: Currently this is limited, it needs:\n                        // TODO: Option to say \"if URL differs then item is different, stop annoying me!\"\n\n                        const modalElementId = \"price-tag--save-confirmation\";\n                        chrome.tabs.sendMessage(tabId, {\n                            type: \"CONFIRMATION_DISPLAY.CREATE\",\n                            payload: {elementId: modalElementId}\n                        }, ({status}) => {\n                            if (status === 1) {\n                                const payload = buildSaveConfirmationPayload(currentURL, similarURL);\n                                chrome.tabs.sendMessage(tabId, {\n                                    type: \"CONFIRMATION_DISPLAY.LOAD\",\n                                    payload\n                                }, ({status, index}) => {\n                                    chrome.tabs.sendMessage(tabId, {\n                                        type: \"CONFIRMATION_DISPLAY.REMOVE\",\n                                        payload: {elementId: modalElementId}\n                                    });\n                                    if (status === 1) {\n                                        switch (index) {\n                                            case 0:\n                                                // said Yes: not the same item\n                                                domainState._isPathEnoughToTrack = false;\n                                                chrome.storage.local.set({[domain]: JSON.stringify(domainState)});\n                                                callback(true);\n                                                break;\n                                            case 1:\n                                                callback(false, true);\n                                                break;\n                                            case 2:\n                                                // said No: same item (path is enough for this site items)\n                                                domainState._isPathEnoughToTrack = true;\n                                                chrome.storage.local.set({[domain]: JSON.stringify(domainState)});\n                                                callback(false, false);\n                                                break;\n                                            case 3:\n                                                // said Save this but for others Ask me later\n                                                callback(true);\n                                                break;\n                                            default:\n                                                // cannot recognize this modal button click\n                                                callback(false, true);\n                                                break;\n                                        }\n                                    } else {\n                                        // something in buttons click\n                                        callback(false, true);\n                                    }\n                                });\n                            } else {\n                                // something went wrong creating the modal\n                                callback(false, true);\n                            }\n                        });\n                    }\n                    else {\n                        // no URL has host and path equals to the currentURL (can save the item)\n                        callback(true);\n                    }\n                });\n            }\n        } else {\n            // this means it's the first item being saved belonging to this domain (can save the item)\n            callback(true);\n        }\n    });\n}\n\nfunction getCanonicalPathFromSource(source) {\n    const canonicalElement = source.querySelector(\"link[rel=\\\"canonical\\\"]\");\n    return canonicalElement && canonicalElement.getAttribute(\"href\");\n}\n\nfunction onXHR(url, callback) {\n    const request = new XMLHttpRequest();\n    request.onload = function () {\n        const template = createHTMLTemplate(this.response);\n        callback(template);\n    };\n    request.open(\"GET\", url);\n    request.send();\n\n}\n\nfunction onTabContextChange(tabId, url) {\n    const captureDomain = url.match(MATCHES.CAPTURE.DOMAIN_IN_URL);\n    if (captureDomain) {\n        const [, domain] = captureDomain;\n        State = updateCurrentDomain(State, domain);\n        chrome.storage.local.get([domain], result => {\n            const domainState = result && result[domain] && JSON.parse(result[domain]) || null;\n            // check if user has already a preference to use the canonical URL if available\n            if (domainState && domainState._canUseCanonical === false) {\n                State = updateCanonicalURL(State, null);\n                State = updateCurrentURL(State, url);\n                State = updateBrowserURL(State, url);\n\n                if (domainState._isPathEnoughToTrack === true) {\n                    const protocolHostAndPathFromURL = captureProtocolHostAndPathFromURL(url);\n                    if (protocolHostAndPathFromURL) {\n                        State = updateCurrentURL(State, protocolHostAndPathFromURL);\n                        State = updateBrowserURL(State, protocolHostAndPathFromURL);\n                    }\n                }\n\n                updateAutoSaveStatus(State.currentURL, State.domain);\n                updatePriceUpdateStatus(State.currentURL, State.domain);\n                updateExtensionAppearance(State.domain, State.currentURL);\n            } else {\n                // First thing to do, check:\n                // If canonical was updated (compared to the previously) + if it's relevant\n                State = updateBrowserURL(State, url);\n\n                onXHR(url, template => {\n                    const canonicalURL = getCanonicalPathFromSource(template);\n                    const canUseCanonical = isCanonicalURLRelevant(canonicalURL);\n\n                    if (canUseCanonical) {\n                        State = updateCurrentURL(State, canonicalURL);\n                        State = updateCanonicalURL(State, canonicalURL);\n                    } else {\n                        State = updateCanonicalURL(State, null);\n                        State = updateCurrentURL(State, url);\n\n                        if (domainState && domainState._isPathEnoughToTrack === true) {\n                            const protocolHostAndPathFromURL = captureProtocolHostAndPathFromURL(url);\n                            if (protocolHostAndPathFromURL) {\n                                State = updateCurrentURL(State, protocolHostAndPathFromURL);\n                                State = updateBrowserURL(State, protocolHostAndPathFromURL);\n                            }\n                        }\n                    }\n                    updateAutoSaveStatus(State.currentURL, State.domain);\n                    updatePriceUpdateStatus(State.currentURL, State.domain);\n                    updateExtensionAppearance(State.domain, State.currentURL);\n                });\n            }\n        });\n    }\n}\n\n// TODO: break this down into smaller functions\nfunction attachEvents() {\n    chrome.runtime.onInstalled.addListener(() => {\n        console.log(\"Price tag installed.\");\n    });\n\n    chrome.tabs.onActivated.addListener(() => {\n        chrome.tabs.query({active: true, currentWindow: true}, ([{id, url}]) => {\n            if (url.startsWith(\"http\")) {\n                onTabContextChange(id, url);\n                State = updateFaviconURL(State, State._faviconURLMap[id] || null);\n            } else {\n                setDefaultAppearance();\n            }\n        });\n    });\n\n    chrome.tabs.onUpdated.addListener((tabId, {status, favIconUrl}, {active, url}) => {\n        if (url.startsWith(\"http\")) {\n            if (active) {\n                if (favIconUrl) {\n                    State = updateFaviconURLMapItem(State, tabId, favIconUrl);\n                    State = updateFaviconURL(State, favIconUrl);\n                }\n            }\n        } else {\n            setDefaultAppearance();\n        }\n    });\n\n    chrome.webNavigation.onCompleted.addListener(({frameId}) => {\n        if (frameId === 0) {\n            chrome.tabs.query({active: true, currentWindow: true}, (tabs) => {\n                if (tabs.length > 0) {\n                    const [{id, url}] = tabs;\n                    onTabContextChange(id, url);\n                }\n            });\n        }\n    });\n\n    chrome.webNavigation.onHistoryStateUpdated.addListener(() => {\n        chrome.tabs.query({active: true, currentWindow: true}, (tabs) => {\n            if (tabs.length > 0) {\n                const [{id: tabId, url}] = tabs;\n                if (url !== undefined && url !== State.browserURL) {\n                    onTabContextChange(tabId, url);\n                }\n            }\n        });\n    });\n\n    chrome.runtime.onMessage.addListener(\n        ({type, payload = {}}, sender, sendResponse) => {\n            const {id} = payload;\n            switch (type) {\n                case \"POPUP.STATUS\":\n                    const {recordActive, autoSaveEnabled, isPriceUpdateEnabled} = State;\n                    sendResponse({status: 1, state: {recordActive, autoSaveEnabled, isPriceUpdateEnabled}});\n                    break;\n                case \"RECORD.ATTEMPT\":\n                    State = toggleRecord(State);\n\n                    if (State.recordActive) {\n                        const {url} = payload;\n                        chrome.tabs.sendMessage(id, {\n                            type: \"RECORD.START\",\n                            payload: {url}\n                        }, onRecordDone.bind(null, id));\n                    } else {\n                        chrome.tabs.sendMessage(id, {type: \"RECORD.CANCEL\"}, onRecordCancel);\n                    }\n                    sendResponse({status: 1, state: {recordActive: State.recordActive}});\n                    break;\n                case \"AUTO_SAVE.STATUS\":\n                    const {currentURL: url, domain} = State;\n                    chrome.storage.local.get([domain], result => {\n                        const domainState = result && result[domain] && JSON.parse(result[domain]) || null;\n                        if (domainState) {\n                            if (domainState._isPathEnoughToTrack === true) {\n                                // since it's true we can say that that domain items' path is enough to track items in this domain\n                                searchForEqualPathWatchedItem(domainState, url, similarURL => {\n                                    if (!similarURL) {\n                                        chrome.tabs.sendMessage(id, {\n                                            type: \"AUTO_SAVE.CHECK_STATUS\",\n                                            payload: {url, selection: State.selection}\n                                        }, onAutoSaveCheckStatus.bind(null, sendResponse));\n                                    } else {\n                                        sendResponse({status: -1});\n                                    }\n                                });\n                            } else {\n                                chrome.tabs.sendMessage(id, {\n                                    type: \"AUTO_SAVE.CHECK_STATUS\",\n                                    payload: {url, selection: State.selection}\n                                }, onAutoSaveCheckStatus.bind(null, sendResponse));\n                            }\n                        } else {\n                            // domain doesn't exist\n                            chrome.tabs.sendMessage(id, {\n                                type: \"AUTO_SAVE.CHECK_STATUS\",\n                                payload: {url, selection: State.selection}\n                            }, onAutoSaveCheckStatus.bind(null, sendResponse));\n                        }\n                    });\n                    return true;\n                case \"AUTO_SAVE.ATTEMPT\":\n                    if (State.autoSaveEnabled) {\n                        const {domain, currentURL: stateUrl, selection, price, faviconURL, faviconAlt, originalBackgroundColor} = State;\n\n                        canDisplayURLConfirmation(State, domain, canDisplay => {\n                            if (canDisplay) {\n                                onConfirmURLForCreateItemAttempt(id, domain, stateUrl, selection, price, faviconURL, faviconAlt, (canSave, useCaninocal) => {\n                                    if (canSave) {\n                                        const url = useCaninocal ? State.canonicalURL : State.browserURL;\n\n                                        checkForURLSimilarity(id, domain, url, (isToSave, autoSaveStatus) => {\n                                            if (isToSave) {\n                                                createItem(domain, url, selection, price, faviconURL, faviconAlt, [ITEM_STATUS.WATCHED], () => {\n                                                    chrome.tabs.sendMessage(id, {\n                                                        type: \"PRICE_TAG.HIGHLIGHT.STOP\",\n                                                        payload: {selection, originalBackgroundColor}\n                                                    }, onSimilarElementHighlight);\n\n                                                    updateExtensionAppearance(domain, url, true);\n                                                    State = disableAutoSave(State);\n\n                                                    sendResponse(false);\n                                                });\n                                            } else {\n                                                // For Exceptions (including when there's similar item - should be caught by \"AUTO_SAVE.STATUS\")\n                                                if (!autoSaveStatus) {\n                                                    State = disableAutoSave(State);\n                                                }\n                                            }\n                                        });\n                                    }\n                                });\n                            } else {\n                                checkForURLSimilarity(id, domain, stateUrl, isToSave => {\n                                    if (isToSave) {\n                                        createItem(domain, stateUrl, selection, price, faviconURL, faviconAlt, [ITEM_STATUS.WATCHED], () => {\n                                            chrome.tabs.sendMessage(id, {\n                                                type: \"PRICE_TAG.HIGHLIGHT.STOP\",\n                                                payload: {selection, originalBackgroundColor}\n                                            }, onSimilarElementHighlight);\n\n                                            updateExtensionAppearance(domain, stateUrl, true);\n                                            State = disableAutoSave(State);\n\n                                            sendResponse(false);\n                                        });\n                                    }\n                                });\n                            }\n                        });\n\n                        return true;\n                    } else {\n                        sendResponse(false);\n                    }\n                    break;\n                case \"AUTO_SAVE.HIGHLIGHT.PRE_START\":\n                    if (State.autoSaveEnabled) {\n                        const {selection} = State;\n                        chrome.tabs.sendMessage(id, {\n                            type: \"PRICE_TAG.HIGHLIGHT.START\",\n                            payload: {selection}\n                        }, onSimilarElementHighlight);\n                    }\n                    break;\n                case \"AUTO_SAVE.HIGHLIGHT.PRE_STOP\":\n                    if (State.autoSaveEnabled) {\n                        const {selection, originalBackgroundColor} = State;\n                        chrome.tabs.sendMessage(id, {\n                            type: \"PRICE_TAG.HIGHLIGHT.STOP\",\n                            payload: {selection, originalBackgroundColor}\n                        }, onSimilarElementHighlight);\n                    }\n                    break;\n                case \"PRICE_UPDATE.STATUS\":\n                    chrome.storage.local.get([State.domain], result => {\n                        const domainItems = result && result[State.domain] ? JSON.parse(result[State.domain]) : {};\n                        const item = domainItems[State.currentURL];\n                        if (item) {\n                            chrome.tabs.sendMessage(id, {\n                                type: \"PRICE_UPDATE.CHECK_STATUS\",\n                                payload: {selection: State.selection}\n                            }, onPriceUpdateCheckStatus.bind(null, sendResponse, item.price));\n                        } else {\n                            sendResponse(false);\n                        }\n                    });\n                    return true;\n                case \"PRICE_UPDATE.ATTEMPT\":\n                    if (State.isPriceUpdateEnabled) {\n                        const {domain, currentURL: stateUrl, selection, price: updatedPrice, originalBackgroundColor} = State;\n                        const price = updatedPrice && toPrice(updatedPrice);\n                        chrome.storage.local.get([domain], result => {\n                            const domainItems = result && result[domain] ? JSON.parse(result[domain]) : {};\n\n                            domainItems[stateUrl] = updateItemTrackStatus(domainItems[stateUrl], price,\n                                null,\n                                [\n                                    ITEM_STATUS.INCREASED, ITEM_STATUS.ACK_INCREASE,\n                                    ITEM_STATUS.DECREASED, ITEM_STATUS.INCREASED,\n                                    ITEM_STATUS.DECREASED, ITEM_STATUS.ACK_DECREASE,\n                                    ITEM_STATUS.DECREASED, ITEM_STATUS.DECREASED,\n                                    ITEM_STATUS.NOT_FOUND\n                                ]);\n                            domainItems[stateUrl] = updateItemDiffPercentage(domainItems[stateUrl]);\n\n                            chrome.storage.local.set({[domain]: JSON.stringify(domainItems)});\n\n                            chrome.tabs.sendMessage(id, {\n                                type: \"PRICE_TAG.HIGHLIGHT.STOP\",\n                                payload: {selection, originalBackgroundColor}\n                            }, onSimilarElementHighlight);\n\n                            State = disablePriceUpdate(State);\n                            sendResponse(false);\n                        });\n                    }\n                    return true;\n                case \"PRICE_UPDATE.HIGHLIGHT.PRE_START\":\n                    if (State.isPriceUpdateEnabled) {\n                        const {selection} = State;\n                        chrome.tabs.sendMessage(id, {\n                            type: \"PRICE_TAG.HIGHLIGHT.START\",\n                            payload: {selection}\n                        }, onSimilarElementHighlight);\n                    }\n                    break;\n                case \"PRICE_UPDATE.HIGHLIGHT.PRE_STOP\":\n                    if (State.isPriceUpdateEnabled) {\n                        const {selection, originalBackgroundColor} = State;\n                        chrome.tabs.sendMessage(id, {\n                            type: \"PRICE_TAG.HIGHLIGHT.STOP\",\n                            payload: {selection, originalBackgroundColor}\n                        }, onSimilarElementHighlight);\n                    }\n                    break;\n                case \"TRACKED_ITEMS.GET\":\n                    getTrackedItems(sendResponse);\n                    return true;\n                case \"TRACKED_ITEMS.UNFOLLOW\":\n                    const {url: itemUrl} = payload;\n                    removeTrackedItem(itemUrl, State.currentURL, sendResponse);\n                    return true;\n            }\n        });\n\n    chrome.notifications.onClicked.addListener(notifId => {\n        chrome.tabs.create({url: State.notifications[notifId].url});\n        clearNotification(notifId);\n    });\n\n\n    // TODO: update and keep tracking\n    chrome.notifications.onButtonClicked.addListener((notifId, buttonIndex) => {\n        const {domain, url, type} = State.notifications[notifId];\n        switch (buttonIndex) {\n            case 0:\n                switch (type) {\n                    case ITEM_STATUS.DECREASED:\n                        chrome.storage.local.get([domain], result => {\n                            const domainItems = result && result[domain] ? JSON.parse(result[domain]) : {};\n                            if (domainItems[url]) {\n                                const {price: newPrice} = domainItems[url];\n                                domainItems[url] = updateItemTrackStatus(domainItems[url], newPrice, null, [ITEM_STATUS.DECREASED, ITEM_STATUS.ACK_DECREASE], true);\n                                chrome.storage.local.set({[domain]: JSON.stringify(domainItems)});\n                            }\n                        });\n                        break;\n                    case ITEM_STATUS.INCREASED:\n                        chrome.storage.local.get([domain], result => {\n                            const domainItems = result && result[domain] ? JSON.parse(result[domain]) : {};\n                            if (domainItems[url]) {\n                                const {previousPrice: priceBeforeIncreasing} = domainItems[url];\n                                domainItems[url] = updateItemTrackStatus(domainItems[url], priceBeforeIncreasing, null, [ITEM_STATUS.INCREASED, ITEM_STATUS.ACK_INCREASE], true);\n                                chrome.storage.local.set({[domain]: JSON.stringify(domainItems)});\n                            }\n                        });\n                        break;\n                }\n                break;\n            case 1:\n                switch (type) {\n                    case ITEM_STATUS.DECREASED, ITEM_STATUS.INCREASED:\n                        chrome.storage.local.get([domain], result => {\n                            const domainItems = result && result[domain] ? JSON.parse(result[domain]) : {};\n                            if (domainItems[url]) {\n                                domainItems[url] = updateItemTrackStatus(domainItems[url], null, null, ALL_ITEM_STATUSES); // stop watching\n                                chrome.storage.local.set({[domain]: JSON.stringify(domainItems)});\n                            }\n                        });\n                        break;\n                }\n                break;\n        }\n    });\n\n    chrome.notifications.onClosed.addListener(clearNotification);\n}\n\nfunction filterAllTrackedItems(result) {\n    let filteredResult = {};\n    for (let domain in result) {\n        if (result.hasOwnProperty(domain) && matchesDomain(domain) && result[domain]) {\n            const domainItems = JSON.parse(result[domain]);\n            filteredResult = {\n                ...filteredResult,\n                [domain]: domainItems\n            };\n        }\n    }\n    return filteredResult;\n}\n\nfunction toStorageStateFormat(state) {\n    return Object.keys(state).reduce((newState, domain) => {\n        return {\n            ...newState,\n            [domain]: JSON.stringify(state[domain])\n        }\n    }, {});\n}\n\nfunction syncStorageState() {\n    chrome.storage.local.get(null, localResult => {\n        const localState = filterAllTrackedItems(localResult);\n\n        chrome.storage.sync.get(null, syncResult => {\n                const syncState = filterAllTrackedItems(syncResult);\n                // TODO: replace this with a lodash cloneDeep !!\n                const freshState = JSON.parse(JSON.stringify(localState));\n\n                for (let syncDomain in syncState) {\n                    if (syncState.hasOwnProperty(syncDomain) && matchesDomain(syncDomain)) {\n                        const syncStateDomain = syncState[syncDomain];\n                        if (!freshState[syncDomain]) {\n                            // TODO: replace this with a lodash cloneDeep !!\n                            freshState[syncDomain] = JSON.parse(JSON.stringify(syncStateDomain));\n                        } else {\n                            for (let syncUrl in syncStateDomain) {\n                                if (syncStateDomain.hasOwnProperty(syncUrl)) {\n                                    const syncItem = syncStateDomain[syncUrl];\n                                    if (!freshState[syncDomain][syncUrl]) {\n                                        freshState[syncDomain][syncUrl] = Object.assign({}, syncItem);\n                                    } else if (syncItem.lastUpdateTimestamp > freshState[syncDomain][syncUrl].lastUpdateTimestamp) {\n                                        // TODO: replace this with a lodash cloneDeep !!\n                                        freshState[syncDomain][syncUrl] = JSON.parse(JSON.stringify(syncItem));\n                                    }\n                                }\n                            }\n                        }\n\n                    }\n                }\n\n                chrome.storage.local.set(toStorageStateFormat(freshState));\n                chrome.storage.sync.set(toStorageStateFormat(freshState));\n            }\n        );\n    });\n}\n\nfunction setupSyncStorageState() {\n    syncStorageState();\n    setInterval(syncStorageState, SYNCHING_INTERVAL);\n}\n\nfunction bootstrap() {\n    setupSyncStorageState();\n    setupTrackingPolling();\n    attachEvents();\n}\n\nbootstrap();\n"],"names":["State","recordActive","notifications","notificationsCounter","autoSaveEnabled","isPriceUpdateEnabled","selection","isSimilarElementHighlighted","originalBackgroundColor","isCurrentPageTracked","faviconURL","_faviconURLMap","currentURL","canonicalURL","browserURL","domain","DEFAULT_ICON","TRACKED_ITEM_ICON","DEFAULT_TITLE","TRACKED_ITEM_TITLE","PRICE_CHECKING_INTERVAL","SYNCHING_INTERVAL","ICONS","PRICE_UPDATE","PRICE_NOT_FOUND","PRICE_FIX","MATCHES","PRICE","HOSTNAME","DOMAIN","URL","CAPTURE","DOMAIN_IN_URL","HOSTNAME_AND_PATH","PROTOCOL_HOSTNAME_AND_PATH","ITEM_STATUS","WATCHED","NOT_FOUND","INCREASED","DECREASED","ACK_DECREASE","ACK_INCREASE","FIXED","ALL_ITEM_STATUSES","Object","values","removeStatuses","item","statusesToRemove","length","statuses","filter","status","includes","toUnique","array","Array","from","Set","updateItemCurrentPrice","newPrice","previousPrice","currentPrice","newItem","updateItemDiffPercentage","diff","Math","abs","price","diffPerc","parseFloat","toFixed","diffPercentage","ceil","floor","updateItemTrackStatus","statusesToAdd","forceStartingPrice","updatedItem","lastUpdateTimestamp","Date","getTime","startingPrice","isWatched","isNotFound","hasAcknowledgeDecrease","hasAcknowledgeIncrease","onConfirmURLForCreateItemAttempt","tabId","url","faviconAlt","callback","modalElementId","chrome","tabs","sendMessage","type","payload","elementId","buildURLConfirmationPayload","index","storage","local","get","result","domainState","JSON","parse","_canUseCanonical","set","stringify","updateCurrentURL","onRecordDone","updateFaviconURL","canDisplayURLConfirmation","canDisplay","canSave","useCaninocal","checkForURLSimilarity","isToSave","createItem","updateExtensionAppearance","disableRecord","onRecordCancel","onAutoSaveCheckStatus","sendResponse","setSelectionInfo","onPriceUpdateCheckStatus","trackedPrice","toPrice","onSimilarElementHighlight","isHighlighted","setSimilarElementHighlight","createTrackedItem","timestamp","items","undefined","disableAutoSave","toggleRecord","state","disableCurrentPageTracked","enableCurrentPageTracked","updateCurrentDomain","updateCanonicalURL","updateBrowserURL","updateFaviconURLMapItem","incrementNotificationsCounter","deleteNotificationsItem","notificationId","newState","updateNotificationsItem","notificationState","isUseCanonicalPrefUnset","setDefaultAppearance","browserAction","setTitle","title","setIcon","path","setTrackedItemAppearance","enableAutoSave","enablePriceUpdate","disablePriceUpdate","checkForPriceChanges","hasOwnProperty","matchesDomain","domainItems","matchesURL","request","XMLHttpRequest","targetPrice","onload","template","createHTMLTemplate","response","textContent","querySelector","textContentMatch","match","createNotification","buttons","notificationOptions","push","e","console","warn","open","send","getTrackedItems","trackedItems","keys","forEach","key","domainData","matchesHostname","sort","sortItemsByTime","removeTrackedItem","found","updateAutoSaveStatus","updatePriceUpdateStatus","clearNotification","notifId","wasClosedByUser","clear","wasClickedByUser","iconUrl","message","contextMessage","extraOptions","options","requireInteraction","create","id","priceNumber","replace","formattedPrice","html","document","createElement","trim","innerHTML","content","isCanonicalURLRelevant","canonical","matchesHostnameAndPath","tsA","tsB","string","test","parseDomainState","setupTrackingPolling","setInterval","isItemNullOrUnwatched","urlFromDomain","hasItemPriceIncOrDec","currentDomain","forcePageTrackingTo","captureHostAndPathFromURL","captureHostAndPath","hostAndPath","captureProtocolHostAndPathFromURL","captureProtocolHostAndPath","protocolHostAndPath","searchForEqualPathWatchedItem","currentHostAndPath","foundOne","buildSaveConfirmationPayload","similarURL","_isPathEnoughToTrack","getCanonicalPathFromSource","source","canonicalElement","getAttribute","onXHR","onTabContextChange","captureDomain","protocolHostAndPathFromURL","canUseCanonical","attachEvents","runtime","onInstalled","addListener","log","onActivated","query","active","currentWindow","startsWith","onUpdated","favIconUrl","webNavigation","onCompleted","frameId","onHistoryStateUpdated","onMessage","sender","bind","stateUrl","autoSaveStatus","updatedPrice","itemUrl","onClicked","onButtonClicked","buttonIndex","priceBeforeIncreasing","onClosed","filterAllTrackedItems","filteredResult","toStorageStateFormat","reduce","syncStorageState","localResult","localState","sync","syncResult","syncState","freshState","syncDomain","syncStateDomain","syncUrl","syncItem","assign","setupSyncStorageState","bootstrap"],"mappings":"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"}