{"version":3,"file":"background.js","sources":["../src/utils/sort-tracked-items.js","../src/config/sort-tracked-items.js","../background.js"],"sourcesContent":["function sortItemsByTime({timestamp: tsA}, {timestamp: tsB}) {\n    return tsA - tsB;\n}\n\nfunction sortItemsByCurrentPrice({currentPrice: cpA}, {currentPrice: cpB}) {\n    return cpA - cpB;\n}\n\nexport default {\n    TIME: sortItemsByTime,\n    CURRENT_PRICE: sortItemsByCurrentPrice\n};\n","const TIME = \"TIME\";\nconst CURRENT_PRICE = \"CURRENT_PRICE\";\n\nexport {\n    TIME,\n    CURRENT_PRICE\n};\n","import sortTrackedItemsBy from \"./src/utils/sort-tracked-items\";\nimport * as SORT_BY_TYPES from \"./src/config/sort-tracked-items\";\nimport {TIME as SORT_ITEMS_BY_TIME} from \"./src/config/sort-tracked-items\";\n\nlet State = {\n    recordActive: false,\n    notifications: {},\n    notificationsCounter: 0,\n    autoSaveEnabled: false,\n    isPriceUpdateEnabled: false,\n    selection: null,\n    isSimilarElementHighlighted: false,\n    originalBackgroundColor: null,\n    isCurrentPageTracked: false,\n    faviconURL: null,\n    _faviconURLMap: {},\n    currentURL: null,\n    canonicalURL: null,\n    browserURL: null,\n    domain: null,\n    _sortItemsBy: SORT_ITEMS_BY_TIME\n};\n\nconst DEFAULT_ICON = \"assets/icon_48.png\";\nconst TRACKED_ITEM_ICON = \"assets/icon_active_48.png\";\nconst DEFAULT_TITLE = \"Price Tag\";\nconst TRACKED_ITEM_TITLE = \"Price Tag - This item is being tracked\";\n\nconst PRICE_CHECKING_INTERVAL = 180000;\n// const PRICE_CHECKING_INTERVAL = 10000;\nconst SYNCHING_INTERVAL = 120000;\nconst ICONS = {\n    PRICE_UPDATE: \"./assets/time-is-money.svg\",\n    PRICE_NOT_FOUND: \"./assets/time.svg\",\n    PRICE_FIX: \"./assets/coin.svg\"\n};\n\nconst MATCHES = {\n    PRICE: /((?:\\d+[.,])?\\d+(?:[.,]\\d+)?)/,\n    HOSTNAME: /https?:\\/\\/([\\w.]+)\\/*/,\n    DOMAIN: /^([\\w-]+\\.)+[\\w-]+\\w$/,\n    URL: /^https?:\\/\\/([\\w-]+\\.)+[\\w-]+\\w(\\/[\\w-=.]+)+\\/?(\\?([\\w]+=?[\\w-%!@()\\\\[\"#\\]]+&?)*)?/,\n    CAPTURE: {\n        DOMAIN_IN_URL: /https?:\\/\\/([\\w.]+)\\/*/,\n        HOSTNAME_AND_PATH: /^https?:\\/\\/((?:[\\w-]+\\.)+[\\w-]+\\w(?:\\/[\\w-=.]+)+\\/?)/,\n        PROTOCOL_HOSTNAME_AND_PATH: /^(https?:\\/\\/(?:[\\w-]+\\.)+[\\w-]+\\w(?:\\/[\\w-=.]+)+\\/?)/\n    }\n};\n\nconst ITEM_STATUS = {\n    WATCHED: \"WATCHED\",\n    NOT_FOUND: \"NOT_FOUND\",\n    INCREASED: \"INCREASED\",\n    DECREASED: \"DECREASED\",\n    ACK_DECREASE: \"ACK_DECREASE\",\n    ACK_INCREASE: \"ACK_INCREASE\",\n    FIXED: \"FIXED\"\n};\n\nconst ALL_ITEM_STATUSES = Object.values(ITEM_STATUS);\n\nfunction removeStatuses(item, statusesToRemove = []) {\n    return statusesToRemove.length > 0 && item.statuses.length > 0 ?\n        item.statuses.filter(status => !statusesToRemove.includes(status)) :\n        item.statuses;\n}\n\nfunction toUnique(array) {\n    return Array.from(new Set(array));\n}\n\nfunction updateItemCurrentPrice(item, newPrice) {\n    const previousPrice = item.currentPrice;\n\n    const newItem = {\n        ...item,\n        previousPrice,\n        currentPrice: newPrice\n    };\n\n    return updateItemDiffPercentage(newItem);\n}\n\nfunction updateItemDiffPercentage(item) {\n    const diff = Math.abs(item.currentPrice - item.price) * 100 / item.price;\n    const diffPerc = parseFloat(diff.toFixed(2));\n    let diffPercentage = null;\n    if (diffPerc) {\n        diffPercentage = item.currentPrice > item.price ?\n            +diffPerc :\n            -diffPerc;\n\n        if (diffPercentage > 0 && diffPercentage < 1) {\n            diffPercentage = Math.ceil(diffPercentage);\n        } else if (diffPercentage > -1 && diffPercentage < 0) {\n            diffPercentage = Math.floor(diffPercentage);\n        }\n    }\n\n    item.diffPercentage = diffPercentage;\n\n    return item;\n}\n\nfunction updateItemTrackStatus(item, newPrice, statusesToAdd, statusesToRemove, forceStartingPrice = false) {\n    if (!statusesToAdd) {\n        statusesToAdd = [];\n    }\n\n    if (!statusesToRemove) {\n        statusesToRemove = [];\n    }\n\n    const statuses = toUnique([...removeStatuses(item, statusesToRemove), ...statusesToAdd]);\n    const updatedItem = {\n        ...item,\n        statuses,\n        lastUpdateTimestamp: new Date().getTime()\n    };\n\n    if (forceStartingPrice) {\n        updatedItem.startingPrice = item.price;\n    }\n\n    if (newPrice) {\n        updatedItem.price = newPrice;\n    }\n\n    return updatedItem;\n}\n\nfunction isWatched(item) {\n    return item.statuses.includes(ITEM_STATUS.WATCHED);\n}\n\nfunction isNotFound(item) {\n    return item.statuses.includes(ITEM_STATUS.NOT_FOUND);\n}\n\nfunction hasAcknowledgeDecrease(item) {\n    return item.statuses.includes(ITEM_STATUS.ACK_DECREASE);\n}\n\nfunction hasAcknowledgeIncrease(item) {\n    return item.statuses.includes(ITEM_STATUS.ACK_INCREASE);\n}\n\nfunction onConfirmURLForCreateItemAttempt(tabId, domain, url, selection, price, faviconURL, faviconAlt, callback) {\n    const modalElementId = \"price-tag--url-confirmation\";\n    chrome.tabs.sendMessage(tabId, {\n        type: \"CONFIRMATION_DISPLAY.CREATE\",\n        payload: {elementId: modalElementId}\n    }, ({status}) => {\n        if (status === 1) {\n            const payload = buildURLConfirmationPayload(State.canonicalURL, State.browserURL, domain);\n            chrome.tabs.sendMessage(tabId, {\n                type: \"CONFIRMATION_DISPLAY.LOAD\",\n                payload\n            }, ({status, index}) => {\n                chrome.tabs.sendMessage(tabId, {\n                    type: \"CONFIRMATION_DISPLAY.REMOVE\",\n                    payload: {elementId: modalElementId}\n                });\n\n                if (status === 1) {\n                    switch (index) {\n                        case 0:\n                            // said Yes, can use canonical and remember this option\n                            chrome.storage.local.get([domain], result => {\n                                const domainState = result && result[domain] && JSON.parse(result[domain]) || {};\n                                domainState._canUseCanonical = true;\n                                chrome.storage.local.set({[domain]: JSON.stringify(domainState)});\n                                State = updateCurrentURL(State, State.canonicalURL);\n                                callback(true, true);\n                            });\n                            break;\n                        case 1:\n                            // said Yes, but use canonical just this time\n                            State = updateCurrentURL(State, State.canonicalURL);\n                            callback(true, true);\n                            break;\n                        case 2:\n                            // said No, use browser URL and remember this option\n                            chrome.storage.local.get([domain], result => {\n                                const domainState = result && result[domain] && JSON.parse(result[domain]) || {};\n                                domainState._canUseCanonical = false;\n                                chrome.storage.local.set({[domain]: JSON.stringify(domainState)});\n                                State = updateCurrentURL(State, State.browserURL);\n                                callback(true, false);\n                            });\n                            break;\n                        case 3:\n                            // said No, use browser URL but ask again\n                            State = updateCurrentURL(State, State.browserURL);\n                            callback(true, false);\n                            break;\n                        default:\n                            // cannot recognize this modal button click\n                            callback(false);\n                            break;\n                    }\n                }\n            });\n        }\n    });\n}\n\nfunction onRecordDone(tabId, payload) {\n    const {status, selection, price, faviconURL, faviconAlt} = payload;\n    const {currentURL, domain} = State;\n    if (status > 0) {\n        State = updateFaviconURL(State, State.faviconURL || faviconURL);\n        canDisplayURLConfirmation(State, domain, canDisplay => {\n            if (canDisplay) {\n                onConfirmURLForCreateItemAttempt(tabId, domain, currentURL, selection, price, faviconURL, faviconAlt, (canSave, useCaninocal) => {\n                    if (canSave) {\n                        const url = useCaninocal ? State.canonicalURL : State.browserURL;\n                        checkForURLSimilarity(tabId, domain, url, isToSave => {\n                            if (isToSave) {\n                                createItem(domain, url, selection, price, State.faviconURL, faviconAlt, [ITEM_STATUS.WATCHED]);\n                                updateExtensionAppearance(domain, url, true);\n                            }\n                        });\n                    }\n                });\n            } else {\n                checkForURLSimilarity(tabId, domain, currentURL, isToSave => {\n                    if (isToSave) {\n                        createItem(domain, currentURL, selection, price, State.faviconURL, faviconAlt, [ITEM_STATUS.WATCHED]);\n                        updateExtensionAppearance(domain, currentURL, true);\n                    }\n                });\n            }\n        });\n\n        State = disableRecord(State);\n    }\n}\n\nfunction onRecordCancel() {\n    State = disableRecord(State);\n}\n\nfunction onAutoSaveCheckStatus(sendResponse, {status, url, domain, selection, price, faviconURL, faviconAlt} = {}) {\n    if (status >= 0) {\n        State = updateFaviconURL(State, State.faviconURL || faviconURL);\n        State = setSelectionInfo(State, selection, price, State.faviconURL, faviconAlt);\n        sendResponse(true);\n    } else {\n        sendResponse(false);\n    }\n}\n\nfunction onPriceUpdateCheckStatus(sendResponse, trackedPrice, {status, selection, price, faviconURL, faviconAlt} = {}) {\n    if (status >= 0) {\n        State = updateFaviconURL(State, State.faviconURL || faviconURL);\n        State = setSelectionInfo(State, selection, price, State.faviconURL, faviconAlt);\n        if (toPrice(price) !== trackedPrice) {\n            sendResponse(true);\n            return;\n        }\n    }\n\n    sendResponse(false);\n}\n\nfunction onSimilarElementHighlight({status, isHighlighted: isSimilarElementHighlighted, originalBackgroundColor = null}) {\n    if (status >= 0) {\n        State = setSimilarElementHighlight(State, isSimilarElementHighlighted, originalBackgroundColor);\n    }\n}\n\nfunction createTrackedItem(selection, trackedPrice, previousPrice, faviconURL, faviconAlt, statuses) {\n    if (!previousPrice) {\n        previousPrice = null;\n    }\n\n    const price = toPrice(trackedPrice);\n\n    return {\n        selection,\n        price,\n        currentPrice: price,\n        startingPrice: price,\n        previousPrice,\n        faviconURL,\n        faviconAlt,\n        timestamp: new Date().getTime(),\n        statuses\n    };\n}\n\n// TODO: price becomes a class\nfunction createItem(domain, url, selection, price, faviconURL, faviconAlt, statuses, callback) {\n    chrome.storage.local.get([domain], result => {\n        const items = result && result[domain] ? JSON.parse(result[domain]) : {};\n        items[url] = createTrackedItem(selection, price, undefined, faviconURL, faviconAlt, statuses);\n\n        chrome.storage.local.set({[domain]: JSON.stringify(items)}, () => {\n            State = disableAutoSave(State);\n            if (callback) {\n                callback();\n            }\n            // TODO: sendResponse(\"done\"); // foi gravado ou não\n        });\n    });\n}\n\nfunction toggleRecord(state) {\n    return {\n        ...state,\n        recordActive: !state.recordActive\n    }\n}\n\nfunction disableRecord(state) {\n    return {\n        ...state,\n        recordActive: false\n    }\n}\n\nfunction disableCurrentPageTracked(state) {\n    return {\n        ...state,\n        isCurrentPageTracked: false\n    };\n}\n\nfunction enableCurrentPageTracked(state) {\n    return {\n        ...state,\n        isCurrentPageTracked: true\n    };\n}\n\nfunction updateCurrentDomain(state, domain) {\n    return {\n        ...state,\n        domain\n    };\n}\n\nfunction updateCurrentURL(state, currentURL) {\n    return {\n        ...state,\n        currentURL\n    };\n}\n\nfunction updateCanonicalURL(state, canonicalURL) {\n    return {\n        ...state,\n        canonicalURL\n    };\n}\n\nfunction updateBrowserURL(state, browserURL) {\n    return {\n        ...state,\n        browserURL\n    };\n}\n\nfunction updateFaviconURL(state, faviconURL) {\n    return {\n        ...state,\n        faviconURL\n    };\n}\n\nfunction updateFaviconURLMapItem(state, tabId, faviconURL) {\n    return {\n        ...state,\n        _faviconURLMap: {\n            ...state._faviconURLMap,\n            [tabId]: faviconURL\n        }\n    };\n}\n\nfunction incrementNotificationsCounter(state) {\n    const notificationsCounter = state.notificationsCounter + 1;\n    return {\n        ...state,\n        notificationsCounter\n    }\n}\n\nfunction deleteNotificationsItem(state, notificationId) {\n    const newState = {...state};\n    delete newState.notifications[notificationId];\n    return newState;\n}\n\nfunction updateNotificationsItem(state, notificationId, notificationState) {\n    return {\n        ...state,\n        notifications: {\n            ...state.notifications,\n            [notificationId]: notificationState\n        }\n    };\n}\n\nfunction updateSortItemsBy(state, _sortItemsBy) {\n    return {\n        ...state,\n        _sortItemsBy\n    };\n}\n\nfunction canDisplayURLConfirmation(state, domain, callback) {\n    chrome.storage.local.get([domain], result => {\n        const domainState = result && result[domain] && JSON.parse(result[domain]) || null;\n        const isUseCanonicalPrefUnset = !domainState || domainState._canUseCanonical === undefined;\n        callback(isUseCanonicalPrefUnset && !!state.canonicalURL &&\n            state.canonicalURL !== state.browserURL);\n    });\n}\n\nfunction setDefaultAppearance() {\n    chrome.browserAction.setTitle({title: DEFAULT_TITLE});\n    chrome.browserAction.setIcon({path: DEFAULT_ICON});\n}\n\nfunction setTrackedItemAppearance() {\n    chrome.browserAction.setTitle({title: TRACKED_ITEM_TITLE});\n    chrome.browserAction.setIcon({path: TRACKED_ITEM_ICON});\n}\n\nfunction enableAutoSave(state, selection) {\n    selection = selection || state.selection;\n    return {\n        ...state,\n        autoSaveEnabled: true,\n        selection\n    };\n}\n\nfunction disableAutoSave(state) {\n    return {\n        ...state,\n        autoSaveEnabled: false\n    };\n}\n\nfunction enablePriceUpdate(state, selection) {\n    return {\n        ...state,\n        isPriceUpdateEnabled: true,\n        selection\n    };\n}\n\nfunction disablePriceUpdate(state) {\n    return {\n        ...state,\n        isPriceUpdateEnabled: false\n    };\n}\n\nfunction setSelectionInfo(state, selection, price, faviconURL, faviconAlt) {\n    return {\n        ...state,\n        selection,\n        price,\n        faviconURL,\n        faviconAlt\n    };\n}\n\nfunction setSimilarElementHighlight(state, isSimilarElementHighlighted, originalBackgroundColor) {\n    return {\n        ...state,\n        isSimilarElementHighlighted,\n        originalBackgroundColor\n    };\n}\n\nfunction checkForPriceChanges() {\n    chrome.storage.local.get(null, result => {\n        for (let domain in result) {\n            if (result.hasOwnProperty(domain) && matchesDomain(domain)) {\n                const domainItems = JSON.parse(result[domain]);\n\n                for (let url in domainItems) {\n                    if (domainItems.hasOwnProperty(url) && matchesURL(url) && isWatched(domainItems[url])) {\n                        const request = new XMLHttpRequest();\n                        const {price: targetPrice, currentPrice} = domainItems[url];\n\n                        request.onload = function () {\n                            const template = createHTMLTemplate(this.response);\n                            try {\n                                let newPrice = null;\n                                const textContent = template.querySelector(domainItems[url].selection).textContent;\n                                if (textContent) {\n                                    const textContentMatch = textContent.match(MATCHES.PRICE);\n                                    if (textContentMatch) {\n                                        [, newPrice] = textContentMatch;\n\n                                        newPrice = toPrice(newPrice);\n\n                                        if (!targetPrice) {\n                                            domainItems[url] = updateItemTrackStatus(domainItems[url], newPrice,\n                                                [ITEM_STATUS.FIXED], [ITEM_STATUS.NOT_FOUND]);\n                                            chrome.storage.local.set({[domain]: JSON.stringify(domainItems)}, () => {\n                                                const notificationId = `TRACK.PRICE_FIXED-${State.notificationsCounter}`;\n                                                createNotification(notificationId, ICONS.PRICE_FIX, \"Fixed price\",\n                                                    `Ermm.. We've just fixed a wrongly set price to ${newPrice}`, url, url, domain);\n                                            });\n                                        } else if (newPrice < currentPrice) {\n                                            const updatedItem = updateItemCurrentPrice(domainItems[url], newPrice);\n                                            domainItems[url] = updateItemTrackStatus(updatedItem, null,\n                                                [ITEM_STATUS.DECREASED],\n                                                [ITEM_STATUS.INCREASED, ITEM_STATUS.NOT_FOUND, ITEM_STATUS.ACK_DECREASE]);\n\n                                            chrome.storage.local.set({[domain]: JSON.stringify(domainItems)}, () => {\n                                                // TODO: sendResponse(\"done\"); // foi actualizado ou não\n                                                if (newPrice < targetPrice && !hasAcknowledgeDecrease(domainItems[url])) {\n                                                    const notificationId = `TRACK.PRICE_UPDATE-${State.notificationsCounter}`;\n                                                    createNotification(notificationId, ICONS.PRICE_UPDATE, \"Lower price!!\",\n                                                        `${newPrice} (previous ${targetPrice})`, url, url, domain, ITEM_STATUS.DECREASED,\n                                                        {\n                                                            buttons: [\n                                                                {\n                                                                    title: `Keep tracking but w/ new price (${newPrice})`\n                                                                },\n                                                                {\n                                                                    title: \"Stop watching\"\n                                                                }\n                                                            ]\n                                                        });\n                                                }\n                                            });\n                                        } else if (newPrice > currentPrice) {\n                                            const updatedItem = updateItemCurrentPrice(domainItems[url], newPrice); // update current price and previous\n                                            domainItems[url] = updateItemTrackStatus(updatedItem, null,\n                                                [ITEM_STATUS.INCREASED],\n                                                [ITEM_STATUS.DECREASED, ITEM_STATUS.NOT_FOUND, ITEM_STATUS.ACK_INCREASE]);\n\n                                            chrome.storage.local.set({[domain]: JSON.stringify(domainItems)}, () => {\n                                                // TODO: sendResponse(\"done\"); // foi actualizado ou não\n\n                                                if (!hasAcknowledgeIncrease(domainItems[url])) {\n                                                    const notificationId = `TRACK.PRICE_UPDATE-${State.notificationsCounter}`;\n                                                    const notificationOptions = domainItems[url].price !== domainItems[url].previousPrice ?\n                                                        {\n                                                            buttons: [\n                                                                {\n                                                                    title: `Increase interest price to the previous (${domainItems[url].previousPrice})`\n                                                                }\n                                                            ]\n                                                        } :\n                                                        {\n                                                            buttons: []\n                                                        };\n                                                    notificationOptions.buttons.push(\n                                                        {\n                                                            title: \"Stop watching\"\n                                                        }\n                                                    );\n                                                    createNotification(notificationId, ICONS.PRICE_UPDATE, \"Price increase\",\n                                                        `${newPrice} (previous ${domainItems[url].previousPrice})`, url, url, domain, ITEM_STATUS.INCREASED,\n                                                        notificationOptions);\n                                                }\n                                            });\n                                        } else if (!isNotFound(domainItems[url])) { // NOTE: Here, price is the same\n                                            domainItems[url] = updateItemTrackStatus(domainItems[url], null,\n                                                null, [ITEM_STATUS.NOT_FOUND]);\n                                            chrome.storage.local.set({[domain]: JSON.stringify(domainItems)}, () => {\n                                                // TODO: sendResponse(\"done\"); // foi actualizado ou não\n                                            });\n                                        } else {\n                                            domainItems[url] = updateItemTrackStatus(domainItems[url], null,\n                                                null, [ITEM_STATUS.NOT_FOUND]);\n                                            chrome.storage.local.set({[domain]: JSON.stringify(domainItems)});\n                                        }\n                                    }\n                                }\n\n                                if (domainItems[url].price && !newPrice) {\n                                    if (!isNotFound(domainItems[url])) {\n                                        domainItems[url] = updateItemTrackStatus(domainItems[url], null,\n                                            [ITEM_STATUS.NOT_FOUND],\n                                            [ITEM_STATUS.DECREASED, ITEM_STATUS.INCREASED, ITEM_STATUS.FIXED, ITEM_STATUS.ACK_DECREASE]);\n\n                                        chrome.storage.local.set({[domain]: JSON.stringify(domainItems)}, () => {\n                                            // TODO: sendResponse(\"done\"); // foi actualizado ou não\n                                            const notificationId = `TRACK.PRICE_NOT_FOUND-${State.notificationsCounter}`;\n                                            const previousPrice = targetPrice ? ` (previous ${targetPrice})` : \"\";\n                                            createNotification(notificationId, ICONS.PRICE_NOT_FOUND, \"Price gone\",\n                                                `Price tag no longer found${previousPrice}`, url, url, domain);\n                                        });\n                                    }\n                                }\n                            } catch (e) {\n                                if (!isNotFound(domainItems[url])) {\n                                    console.warn(`Invalid price selection element in\\n${url}:\\t\"${domainItems[url].selection}\"`);\n                                    domainItems[url] = updateItemTrackStatus(domainItems[url], null,\n                                        [ITEM_STATUS.NOT_FOUND],\n                                        [ITEM_STATUS.DECREASED, ITEM_STATUS.INCREASED, ITEM_STATUS.FIXED, ITEM_STATUS.ACK_DECREASE]);\n\n                                    chrome.storage.local.set({[domain]: JSON.stringify(domainItems)}, () => {\n                                        const notificationId = `TRACK.PRICE_NOT_FOUND-${State.notificationsCounter}`;\n                                        const previousPrice = targetPrice ? ` (previous ${targetPrice})` : \"\";\n                                        createNotification(notificationId, ICONS.PRICE_NOT_FOUND, \"Price gone\",\n                                            `Price tag no longer found${previousPrice}`, url, url, domain);\n                                    });\n                                }\n                            }\n                        };\n\n                        request.open(\"GET\", url);\n                        request.send();\n                    }\n                }\n            }\n        }\n    });\n}\n\nfunction getTrackedItemsSortedBy(sortType, callback) {\n    chrome.storage.local.get(null, result => {\n        let trackedItems = [];\n        Object.keys(result).forEach(key => {\n            if (matchesDomain(key)) {\n                const domainData = result[key];\n                const domainItems = JSON.parse(domainData) || null;\n                if (domainItems) {\n                    let items = [];\n                    Object.keys(domainItems).forEach(url => {\n                        if (matchesHostname(url) && isWatched(domainItems[url])) {\n                            const item = {\n                                ...domainItems[url],\n                                url: url\n                            };\n                            items.push(item);\n                        }\n                    });\n                    trackedItems = [...trackedItems, ...items];\n                }\n            }\n        });\n        const sortByFn = sortTrackedItemsBy[sortType];\n        trackedItems.sort(sortByFn);\n        callback(trackedItems);\n    });\n}\n\nfunction removeTrackedItem(url, currentURL, callback) {\n    let found = false;\n    chrome.storage.local.get(null, result => {\n        Object.keys(result).forEach(domain => {\n            if (matchesDomain(domain)) {\n                const domainData = result[domain];\n                const domainItems = JSON.parse(domainData) || null;\n                if (domainItems[url]) {\n                    found = true;\n\n                    domainItems[url] = updateItemTrackStatus(domainItems[url], null, null, ALL_ITEM_STATUSES); // stop watching\n                    chrome.storage.local.set({[domain]: JSON.stringify(domainItems)}, () => {\n                        if (currentURL === url) {\n                            updateAutoSaveStatus(url, domain);\n                            updatePriceUpdateStatus(url, domain);\n                            updateExtensionAppearance(domain, url, false);\n                        }\n                        callback(true);\n                    });\n                }\n            }\n        });\n        if (!found) {\n            callback(false);\n        }\n    });\n}\n\nfunction clearNotification(notifId, wasClosedByUser) {\n    chrome.notifications.clear(notifId, wasClickedByUser => {\n        if (wasClickedByUser || wasClosedByUser) {\n            const {domain, url, type} = State.notifications[notifId];\n            chrome.storage.local.get([domain], result => {\n                const domainItems = result && result[domain] ? JSON.parse(result[domain]) : null;\n                switch (type) {\n                    case ITEM_STATUS.DECREASED:\n                        domainItems[url] = updateItemTrackStatus(domainItems[url], null, [ITEM_STATUS.ACK_DECREASE]);\n                        break;\n                    case ITEM_STATUS.INCREASED:\n                        domainItems[url] = updateItemTrackStatus(domainItems[url], null, [ITEM_STATUS.ACK_INCREASE]);\n                        break;\n                }\n\n                chrome.storage.local.set({[domain]: JSON.stringify(domainItems)});\n            });\n        }\n\n        State = deleteNotificationsItem(State, notifId);\n    });\n}\n\nfunction createNotification(notifId, iconUrl, title, message, contextMessage = \"\", url, domain, type, extraOptions = {}) {\n    const options = {\n        type: \"basic\",\n        title,\n        message,\n        iconUrl,\n        contextMessage,\n        requireInteraction: true,\n        ...extraOptions\n    };\n\n    chrome.notifications.create(notifId, options, id => {\n        State = updateNotificationsItem(State, id, {\n            url,\n            domain,\n            type\n        });\n    });\n\n    State = incrementNotificationsCounter(State);\n}\n\nfunction toPrice(price) {\n    const priceNumber = parseFloat(price.replace(\",\", \".\"));\n    const formattedPrice = priceNumber.toFixed(2);\n    return parseFloat(formattedPrice);\n}\n\nfunction createHTMLTemplate(html) {\n    var template = document.createElement(\"template\");\n    html = html.trim();\n    template.innerHTML = html;\n    return template.content;\n}\n\nfunction isCanonicalURLRelevant(canonical) {\n    return canonical && matchesHostnameAndPath(canonical);\n}\n\nfunction matchesDomain(string) {\n    return MATCHES.DOMAIN.test(string);\n}\n\nfunction matchesHostname(string) {\n    return MATCHES.HOSTNAME.test(string);\n}\n\nfunction matchesHostnameAndPath(string) {\n    return MATCHES.CAPTURE.HOSTNAME_AND_PATH.test(string);\n}\n\nfunction matchesURL(string) {\n    return MATCHES.URL.test(string);\n}\n\nfunction parseDomainState(result, domain) {\n    return result && result[domain] && JSON.parse(result[domain]) || null;\n}\n\nfunction setupTrackingPolling() {\n    checkForPriceChanges();\n    // TODO: remove settimeout (for test purposes)\n    // setTimeout(checkForPriceChanges, 20000);\n    setInterval(checkForPriceChanges, PRICE_CHECKING_INTERVAL);\n}\n\nfunction updateAutoSaveStatus(url, domain) {\n    chrome.storage.local.get([domain], result => {\n        const items = result && result[domain] ? JSON.parse(result[domain]) : {};\n        const isItemNullOrUnwatched = !items[url] || !isWatched(items[url]);\n        if (items && isItemNullOrUnwatched) {\n            const urlFromDomain = Object.keys(items)[0];\n            if (items[urlFromDomain] && items[urlFromDomain].selection) {\n                State = enableAutoSave(State, items[urlFromDomain].selection);\n            }\n        } else {\n            State = disableAutoSave(State);\n        }\n    });\n}\n\nfunction updatePriceUpdateStatus(url, domain) {\n    chrome.storage.local.get([domain], result => {\n        const items = result && result[domain] ? JSON.parse(result[domain]) : {};\n        const item = items[url];\n        const hasItemPriceIncOrDec = item && item.price !== item.currentPrice;\n        if (hasItemPriceIncOrDec) {\n            State = enablePriceUpdate(State, item.selection);\n        } else {\n            State = disablePriceUpdate(State);\n        }\n    });\n}\n\nfunction updateExtensionAppearance(currentDomain, currentURL, forcePageTrackingTo, fullURL) {\n    if (forcePageTrackingTo === true) {\n        setTrackedItemAppearance();\n        State = enableCurrentPageTracked(State);\n    } else if (forcePageTrackingTo === false) {\n        setDefaultAppearance();\n        State = disableCurrentPageTracked(State);\n    } else if (!forcePageTrackingTo) {\n        chrome.storage.local.get([currentDomain], result => {\n            const domainState = parseDomainState(result, currentDomain);\n            if (domainState) {\n                // NOTE: Making sure that full URL is also checked because item may have been saved with full URL\n                // in the past\n                const item = domainState[currentURL] || domainState[fullURL];\n                if (item && isWatched(item)) {\n                    setTrackedItemAppearance();\n                    State = enableCurrentPageTracked(State);\n                } else {\n                    setDefaultAppearance();\n                    State = disableCurrentPageTracked(State);\n                }\n            } else {\n                setDefaultAppearance();\n                State = disableCurrentPageTracked(State);\n            }\n        });\n    }\n}\n\nfunction captureHostAndPathFromURL(url) {\n    const captureHostAndPath = url.match(MATCHES.CAPTURE.HOSTNAME_AND_PATH);\n    let hostAndPath = null;\n    if (captureHostAndPath) {\n        [, hostAndPath] = captureHostAndPath;\n    }\n    return hostAndPath;\n}\n\nfunction captureProtocolHostAndPathFromURL(url) {\n    const captureProtocolHostAndPath = url.match(MATCHES.CAPTURE.PROTOCOL_HOSTNAME_AND_PATH);\n    let protocolHostAndPath = null;\n    if (captureProtocolHostAndPath) {\n        [, protocolHostAndPath] = captureProtocolHostAndPath;\n    }\n    return protocolHostAndPath;\n}\n\nfunction searchForEqualPathWatchedItem(domainState, currentURL, callback) {\n    const currentHostAndPath = captureHostAndPathFromURL(currentURL);\n    let foundOne = false;\n    for (let url in domainState) {\n        if (domainState.hasOwnProperty(url) && matchesURL(url)) {\n            if (isWatched(domainState[url])) {\n                if (currentURL === url) {\n                    //    if they're exactly the same\n                    callback(null);\n                    return;\n                } else {\n                    const hostAndPath = captureHostAndPathFromURL(url);\n                    if (hostAndPath === currentHostAndPath) {\n                        foundOne = foundOne === false;\n                        callback(url);\n                        return;\n                    }\n                }\n            }\n        }\n    }\n\n    callback(null);\n}\n\nfunction buildSaveConfirmationPayload(currentURL, similarURL) {\n    return {\n        title: \"Item with similar URL to existing one\",\n        message: \"It appears that the item URL you're trying to save:<br>\" +\n            `<i><a href=\"${currentURL}\" target=\"_blank\">${currentURL}</a></i><br>` +\n            \"is pretty similar to<br>\" +\n            `<i><a href=\"${similarURL}\" target=\"_blank\">${similarURL}</a></i><br><br>` +\n            \"Since your choice will affect the way items are tracked in this site futurely,<br>please help us helping you by choosing carefully one of the following options:\",\n        buttons: [\n            \"It's not, save it! Remember this option for this site.\",\n            \"Don't save. Ask me again for items of this site!\",\n            \"Indeed the same item. Don't save! Remember this option for this site. (Use just URL path for accessing items)\",\n            \"For now save this item. Ask me again next time!\"\n        ]\n    };\n}\n\nfunction buildURLConfirmationPayload(canonicalURL, browserURL, domain) {\n    return {\n        title: \"This website recommends to follow this item through a different URL\",\n        message: `<u>${domain}</u> says that a more accurate URL for this item would be:<br>` +\n            `<i><a href=\"${canonicalURL}\" target=\"_blank\">${canonicalURL}</a></i><br>` +\n            \"If this is correct, we recommend you to follow it.<br><br>\" +\n            \"<b>However</b> you can still opt to choose following the current browser URL:<br>\" +\n            `<i><a href=\"${browserURL}\" target=\"_blank\">${browserURL}</a></i><br><br>` +\n            \"Since your choice will affect the way items are tracked in this site futurely,<br>please help us helping you by choosing carefully one of the following options:\",\n        buttons: [\n            \"Use recommended URL. Remember this option for this site\",\n            \"Use recommended URL but just this time\",\n            \"It's not correct, use the current browser URL. Remember this option\",\n            \"Don't use recommended URL. Use the current browser URL instead but just this time\"\n        ]\n    };\n}\n\nfunction checkForURLSimilarity(tabId, domain, currentURL, callback) {\n    chrome.storage.local.get([domain], result => {\n        const domainState = result && result[domain] && JSON.parse(result[domain]) || null;\n        if (domainState) {\n            if (domainState._isPathEnoughToTrack === true) {\n                // since it's true we can say that that domain items' path is enough to track items in this domain\n                searchForEqualPathWatchedItem(domainState, currentURL, similarURL => {\n                    if (similarURL) {\n                        callback(false, false);\n                    } else {\n                        callback(true);\n                    }\n                });\n            } else if (domainState._isPathEnoughToTrack === false) {\n                callback(true);\n            } else {\n                // it's the first time user is being inquired about items similarity in this domain\n                searchForEqualPathWatchedItem(domainState, currentURL, similarURL => {\n                    if (similarURL) {\n                        // found an URL whose host and path are equals to the currentURL trying to be saved\n                        // prompt user to confirm if the item is the same\n\n                        // TODO: Currently this is limited, it needs:\n                        // TODO: Option to say \"if URL differs then item is different, stop annoying me!\"\n\n                        const modalElementId = \"price-tag--save-confirmation\";\n                        chrome.tabs.sendMessage(tabId, {\n                            type: \"CONFIRMATION_DISPLAY.CREATE\",\n                            payload: {elementId: modalElementId}\n                        }, ({status}) => {\n                            if (status === 1) {\n                                const payload = buildSaveConfirmationPayload(currentURL, similarURL);\n                                chrome.tabs.sendMessage(tabId, {\n                                    type: \"CONFIRMATION_DISPLAY.LOAD\",\n                                    payload\n                                }, ({status, index}) => {\n                                    chrome.tabs.sendMessage(tabId, {\n                                        type: \"CONFIRMATION_DISPLAY.REMOVE\",\n                                        payload: {elementId: modalElementId}\n                                    });\n                                    if (status === 1) {\n                                        switch (index) {\n                                            case 0:\n                                                // said Yes: not the same item\n                                                domainState._isPathEnoughToTrack = false;\n                                                chrome.storage.local.set({[domain]: JSON.stringify(domainState)});\n                                                callback(true);\n                                                break;\n                                            case 1:\n                                                callback(false, true);\n                                                break;\n                                            case 2:\n                                                // said No: same item (path is enough for this site items)\n                                                domainState._isPathEnoughToTrack = true;\n                                                chrome.storage.local.set({[domain]: JSON.stringify(domainState)});\n                                                callback(false, false);\n                                                break;\n                                            case 3:\n                                                // said Save this but for others Ask me later\n                                                callback(true);\n                                                break;\n                                            default:\n                                                // cannot recognize this modal button click\n                                                callback(false, true);\n                                                break;\n                                        }\n                                    } else {\n                                        // something in buttons click\n                                        callback(false, true);\n                                    }\n                                });\n                            } else {\n                                // something went wrong creating the modal\n                                callback(false, true);\n                            }\n                        });\n                    }\n                    else {\n                        // no URL has host and path equals to the currentURL (can save the item)\n                        callback(true);\n                    }\n                });\n            }\n        } else {\n            // this means it's the first item being saved belonging to this domain (can save the item)\n            callback(true);\n        }\n    });\n}\n\nfunction getCanonicalPathFromSource(source) {\n    const canonicalElement = source.querySelector(\"link[rel=\\\"canonical\\\"]\");\n    return canonicalElement && canonicalElement.getAttribute(\"href\");\n}\n\nfunction onXHR(url, callback) {\n    const request = new XMLHttpRequest();\n    request.onload = function () {\n        const template = createHTMLTemplate(this.response);\n        callback(template);\n    };\n    request.open(\"GET\", url);\n    request.send();\n\n}\n\nfunction onTabContextChange(tabId, url) {\n    const captureDomain = url.match(MATCHES.CAPTURE.DOMAIN_IN_URL);\n    if (captureDomain) {\n        const [, domain] = captureDomain;\n        State = updateCurrentDomain(State, domain);\n        chrome.storage.local.get([domain], result => {\n            const domainState = result && result[domain] && JSON.parse(result[domain]) || null;\n            // check if user has already a preference to use the canonical URL if available\n            if (domainState && domainState._canUseCanonical === false) {\n                State = updateCanonicalURL(State, null);\n                State = updateCurrentURL(State, url);\n                State = updateBrowserURL(State, url);\n\n                if (domainState._isPathEnoughToTrack === true) {\n                    const protocolHostAndPathFromURL = captureProtocolHostAndPathFromURL(url);\n                    if (protocolHostAndPathFromURL) {\n                        State = updateCurrentURL(State, protocolHostAndPathFromURL);\n                        State = updateBrowserURL(State, protocolHostAndPathFromURL);\n                    }\n                }\n\n                updateAutoSaveStatus(State.currentURL, State.domain);\n                updatePriceUpdateStatus(State.currentURL, State.domain);\n                updateExtensionAppearance(State.domain, State.currentURL, null, url);\n            } else {\n                // First thing to do, check:\n                // If canonical was updated (compared to the previously) + if it's relevant\n                State = updateBrowserURL(State, url);\n\n                onXHR(url, template => {\n                    const canonicalURL = getCanonicalPathFromSource(template);\n                    const canUseCanonical = isCanonicalURLRelevant(canonicalURL);\n\n                    if (canUseCanonical) {\n                        State = updateCurrentURL(State, canonicalURL);\n                        State = updateCanonicalURL(State, canonicalURL);\n                    } else {\n                        State = updateCanonicalURL(State, null);\n                        State = updateCurrentURL(State, url);\n\n                        if (domainState && domainState._isPathEnoughToTrack === true) {\n                            const protocolHostAndPathFromURL = captureProtocolHostAndPathFromURL(url);\n                            if (protocolHostAndPathFromURL) {\n                                State = updateCurrentURL(State, protocolHostAndPathFromURL);\n                                State = updateBrowserURL(State, protocolHostAndPathFromURL);\n                            }\n                        }\n                    }\n\n                    updateAutoSaveStatus(State.currentURL, State.domain);\n                    updatePriceUpdateStatus(State.currentURL, State.domain);\n                    updateExtensionAppearance(State.domain, State.currentURL, null, url);\n                });\n            }\n        });\n    }\n}\n\n// TODO: break this down into smaller functions\nfunction attachEvents() {\n    chrome.runtime.onInstalled.addListener(() => {\n        console.log(\"Price tag installed.\");\n    });\n\n    chrome.tabs.onActivated.addListener(() => {\n        chrome.tabs.query({active: true, currentWindow: true}, ([{id, url}]) => {\n            if (url.startsWith(\"http\")) {\n                onTabContextChange(id, url);\n                State = updateFaviconURL(State, State._faviconURLMap[id] || null);\n            } else {\n                setDefaultAppearance();\n            }\n        });\n    });\n\n    chrome.tabs.onUpdated.addListener((tabId, {status, favIconUrl}, {active, url}) => {\n        if (url.startsWith(\"http\")) {\n            if (active) {\n                if (favIconUrl) {\n                    State = updateFaviconURLMapItem(State, tabId, favIconUrl);\n                    State = updateFaviconURL(State, favIconUrl);\n                }\n            }\n        } else {\n            setDefaultAppearance();\n        }\n    });\n\n    chrome.webNavigation.onCompleted.addListener(({frameId}) => {\n        if (frameId === 0) {\n            chrome.tabs.query({active: true, currentWindow: true}, (tabs) => {\n                if (tabs.length > 0) {\n                    const [{id, url}] = tabs;\n                    onTabContextChange(id, url);\n                }\n            });\n        }\n    });\n\n    chrome.webNavigation.onHistoryStateUpdated.addListener(() => {\n        chrome.tabs.query({active: true, currentWindow: true}, (tabs) => {\n            if (tabs.length > 0) {\n                const [{id: tabId, url}] = tabs;\n                if (url !== undefined && url !== State.browserURL) {\n                    onTabContextChange(tabId, url);\n                }\n            }\n        });\n    });\n\n    chrome.runtime.onMessage.addListener(\n        ({type, payload = {}}, sender, sendResponse) => {\n            const {id} = payload;\n            switch (type) {\n                case \"POPUP.STATUS\":\n                    const {recordActive, autoSaveEnabled, isPriceUpdateEnabled} = State;\n                    sendResponse({status: 1, state: {recordActive, autoSaveEnabled, isPriceUpdateEnabled}});\n                    break;\n                case \"RECORD.ATTEMPT\":\n                    State = toggleRecord(State);\n\n                    if (State.recordActive) {\n                        const {url} = payload;\n                        chrome.tabs.sendMessage(id, {\n                            type: \"RECORD.START\",\n                            payload: {url}\n                        }, onRecordDone.bind(null, id));\n                    } else {\n                        chrome.tabs.sendMessage(id, {type: \"RECORD.CANCEL\"}, onRecordCancel);\n                    }\n                    sendResponse({status: 1, state: {recordActive: State.recordActive}});\n                    break;\n                case \"AUTO_SAVE.STATUS\":\n                    const {currentURL: url, domain} = State;\n                    chrome.storage.local.get([domain], result => {\n                        const domainState = result && result[domain] && JSON.parse(result[domain]) || null;\n                        if (domainState) {\n                            if (domainState._isPathEnoughToTrack === true) {\n                                // since it's true we can say that that domain items' path is enough to track items in this domain\n                                searchForEqualPathWatchedItem(domainState, url, similarURL => {\n                                    if (!similarURL) {\n                                        chrome.tabs.sendMessage(id, {\n                                            type: \"AUTO_SAVE.CHECK_STATUS\",\n                                            payload: {url, selection: State.selection}\n                                        }, onAutoSaveCheckStatus.bind(null, sendResponse));\n                                    } else {\n                                        sendResponse({status: -1});\n                                    }\n                                });\n                            } else {\n                                chrome.tabs.sendMessage(id, {\n                                    type: \"AUTO_SAVE.CHECK_STATUS\",\n                                    payload: {url, selection: State.selection}\n                                }, onAutoSaveCheckStatus.bind(null, sendResponse));\n                            }\n                        } else {\n                            // domain doesn't exist\n                            chrome.tabs.sendMessage(id, {\n                                type: \"AUTO_SAVE.CHECK_STATUS\",\n                                payload: {url, selection: State.selection}\n                            }, onAutoSaveCheckStatus.bind(null, sendResponse));\n                        }\n                    });\n                    return true;\n                case \"AUTO_SAVE.ATTEMPT\":\n                    if (State.autoSaveEnabled) {\n                        const {domain, currentURL: stateUrl, selection, price, faviconURL, faviconAlt, originalBackgroundColor} = State;\n\n                        canDisplayURLConfirmation(State, domain, canDisplay => {\n                            if (canDisplay) {\n                                onConfirmURLForCreateItemAttempt(id, domain, stateUrl, selection, price, faviconURL, faviconAlt, (canSave, useCaninocal) => {\n                                    if (canSave) {\n                                        const url = useCaninocal ? State.canonicalURL : State.browserURL;\n\n                                        checkForURLSimilarity(id, domain, url, (isToSave, autoSaveStatus) => {\n                                            if (isToSave) {\n                                                createItem(domain, url, selection, price, faviconURL, faviconAlt, [ITEM_STATUS.WATCHED], () => {\n                                                    chrome.tabs.sendMessage(id, {\n                                                        type: \"PRICE_TAG.HIGHLIGHT.STOP\",\n                                                        payload: {selection, originalBackgroundColor}\n                                                    }, onSimilarElementHighlight);\n\n                                                    updateExtensionAppearance(domain, url, true);\n                                                    State = disableAutoSave(State);\n\n                                                    sendResponse(false);\n                                                });\n                                            } else {\n                                                // For Exceptions (including when there's similar item - should be caught by \"AUTO_SAVE.STATUS\")\n                                                if (!autoSaveStatus) {\n                                                    State = disableAutoSave(State);\n                                                }\n                                            }\n                                        });\n                                    }\n                                });\n                            } else {\n                                checkForURLSimilarity(id, domain, stateUrl, isToSave => {\n                                    if (isToSave) {\n                                        createItem(domain, stateUrl, selection, price, faviconURL, faviconAlt, [ITEM_STATUS.WATCHED], () => {\n                                            chrome.tabs.sendMessage(id, {\n                                                type: \"PRICE_TAG.HIGHLIGHT.STOP\",\n                                                payload: {selection, originalBackgroundColor}\n                                            }, onSimilarElementHighlight);\n\n                                            updateExtensionAppearance(domain, stateUrl, true);\n                                            State = disableAutoSave(State);\n\n                                            sendResponse(false);\n                                        });\n                                    }\n                                });\n                            }\n                        });\n\n                        return true;\n                    } else {\n                        sendResponse(false);\n                    }\n                    break;\n                case \"AUTO_SAVE.HIGHLIGHT.PRE_START\":\n                    if (State.autoSaveEnabled) {\n                        const {selection} = State;\n                        chrome.tabs.sendMessage(id, {\n                            type: \"PRICE_TAG.HIGHLIGHT.START\",\n                            payload: {selection}\n                        }, onSimilarElementHighlight);\n                    }\n                    break;\n                case \"AUTO_SAVE.HIGHLIGHT.PRE_STOP\":\n                    if (State.autoSaveEnabled) {\n                        const {selection, originalBackgroundColor} = State;\n                        chrome.tabs.sendMessage(id, {\n                            type: \"PRICE_TAG.HIGHLIGHT.STOP\",\n                            payload: {selection, originalBackgroundColor}\n                        }, onSimilarElementHighlight);\n                    }\n                    break;\n                case \"PRICE_UPDATE.STATUS\":\n                    chrome.storage.local.get([State.domain], result => {\n                        const domainItems = result && result[State.domain] ? JSON.parse(result[State.domain]) : {};\n                        const item = domainItems[State.currentURL];\n                        if (item) {\n                            chrome.tabs.sendMessage(id, {\n                                type: \"PRICE_UPDATE.CHECK_STATUS\",\n                                payload: {selection: State.selection}\n                            }, onPriceUpdateCheckStatus.bind(null, sendResponse, item.price));\n                        } else {\n                            sendResponse(false);\n                        }\n                    });\n                    return true;\n                case \"PRICE_UPDATE.ATTEMPT\":\n                    if (State.isPriceUpdateEnabled) {\n                        const {domain, currentURL: stateUrl, selection, price: updatedPrice, originalBackgroundColor} = State;\n                        const price = updatedPrice && toPrice(updatedPrice);\n                        chrome.storage.local.get([domain], result => {\n                            const domainItems = result && result[domain] ? JSON.parse(result[domain]) : {};\n\n                            domainItems[stateUrl] = updateItemTrackStatus(domainItems[stateUrl], price,\n                                null,\n                                [\n                                    ITEM_STATUS.INCREASED, ITEM_STATUS.ACK_INCREASE,\n                                    ITEM_STATUS.DECREASED, ITEM_STATUS.INCREASED,\n                                    ITEM_STATUS.DECREASED, ITEM_STATUS.ACK_DECREASE,\n                                    ITEM_STATUS.DECREASED, ITEM_STATUS.DECREASED,\n                                    ITEM_STATUS.NOT_FOUND\n                                ]);\n                            domainItems[stateUrl] = updateItemDiffPercentage(domainItems[stateUrl]);\n\n                            chrome.storage.local.set({[domain]: JSON.stringify(domainItems)});\n\n                            chrome.tabs.sendMessage(id, {\n                                type: \"PRICE_TAG.HIGHLIGHT.STOP\",\n                                payload: {selection, originalBackgroundColor}\n                            }, onSimilarElementHighlight);\n\n                            State = disablePriceUpdate(State);\n                            sendResponse(false);\n                        });\n                    }\n                    return true;\n                case \"PRICE_UPDATE.HIGHLIGHT.PRE_START\":\n                    if (State.isPriceUpdateEnabled) {\n                        const {selection} = State;\n                        chrome.tabs.sendMessage(id, {\n                            type: \"PRICE_TAG.HIGHLIGHT.START\",\n                            payload: {selection}\n                        }, onSimilarElementHighlight);\n                    }\n                    break;\n                case \"PRICE_UPDATE.HIGHLIGHT.PRE_STOP\":\n                    if (State.isPriceUpdateEnabled) {\n                        const {selection, originalBackgroundColor} = State;\n                        chrome.tabs.sendMessage(id, {\n                            type: \"PRICE_TAG.HIGHLIGHT.STOP\",\n                            payload: {selection, originalBackgroundColor}\n                        }, onSimilarElementHighlight);\n                    }\n                    break;\n                case \"TRACKED_ITEMS.OPEN\":\n                    State = updateSortItemsBy(State, SORT_ITEMS_BY_TIME);\n                    break;\n                case \"TRACKED_ITEMS.GET\":\n                    getTrackedItemsSortedBy(State._sortItemsBy, sendResponse);\n                    return true;\n                case \"TRACKED_ITEMS.UNFOLLOW\":\n                    const {url: itemUrl} = payload;\n                    removeTrackedItem(itemUrl, State.currentURL, sendResponse);\n                    return true;\n                case \"TRACKED_ITEMS.CHANGE_SORT\":\n                    const {sortByType} = payload;\n                    State = updateSortItemsBy(State, SORT_BY_TYPES[sortByType]);\n                    break;\n            }\n        });\n\n    chrome.notifications.onClicked.addListener(notifId => {\n        chrome.tabs.create({url: State.notifications[notifId].url});\n        clearNotification(notifId);\n    });\n\n\n    // TODO: update and keep tracking\n    chrome.notifications.onButtonClicked.addListener((notifId, buttonIndex) => {\n        const {domain, url, type} = State.notifications[notifId];\n        switch (buttonIndex) {\n            case 0:\n                switch (type) {\n                    case ITEM_STATUS.DECREASED:\n                        chrome.storage.local.get([domain], result => {\n                            const domainItems = result && result[domain] ? JSON.parse(result[domain]) : {};\n                            if (domainItems[url]) {\n                                const {price: newPrice} = domainItems[url];\n                                domainItems[url] = updateItemTrackStatus(domainItems[url], newPrice, null, [ITEM_STATUS.DECREASED, ITEM_STATUS.ACK_DECREASE], true);\n                                chrome.storage.local.set({[domain]: JSON.stringify(domainItems)});\n                            }\n                        });\n                        break;\n                    case ITEM_STATUS.INCREASED:\n                        chrome.storage.local.get([domain], result => {\n                            const domainItems = result && result[domain] ? JSON.parse(result[domain]) : {};\n                            if (domainItems[url]) {\n                                const {previousPrice: priceBeforeIncreasing} = domainItems[url];\n                                domainItems[url] = updateItemTrackStatus(domainItems[url], priceBeforeIncreasing, null, [ITEM_STATUS.INCREASED, ITEM_STATUS.ACK_INCREASE], true);\n                                chrome.storage.local.set({[domain]: JSON.stringify(domainItems)});\n                            }\n                        });\n                        break;\n                }\n                break;\n            case 1:\n                switch (type) {\n                    case ITEM_STATUS.DECREASED, ITEM_STATUS.INCREASED:\n                        chrome.storage.local.get([domain], result => {\n                            const domainItems = result && result[domain] ? JSON.parse(result[domain]) : {};\n                            if (domainItems[url]) {\n                                domainItems[url] = updateItemTrackStatus(domainItems[url], null, null, ALL_ITEM_STATUSES); // stop watching\n                                chrome.storage.local.set({[domain]: JSON.stringify(domainItems)});\n                            }\n                        });\n                        break;\n                }\n                break;\n        }\n    });\n\n    chrome.notifications.onClosed.addListener(clearNotification);\n}\n\nfunction filterAllTrackedItems(result) {\n    let filteredResult = {};\n    for (let domain in result) {\n        if (result.hasOwnProperty(domain) && matchesDomain(domain) && result[domain]) {\n            const domainItems = JSON.parse(result[domain]);\n            filteredResult = {\n                ...filteredResult,\n                [domain]: domainItems\n            };\n        }\n    }\n    return filteredResult;\n}\n\nfunction toStorageStateFormat(state) {\n    return Object.keys(state).reduce((newState, domain) => {\n        return {\n            ...newState,\n            [domain]: JSON.stringify(state[domain])\n        }\n    }, {});\n}\n\nfunction syncStorageState() {\n    chrome.storage.local.get(null, localResult => {\n        const localState = filterAllTrackedItems(localResult);\n\n        chrome.storage.sync.get(null, syncResult => {\n                const syncState = filterAllTrackedItems(syncResult);\n                // TODO: replace this with a lodash cloneDeep !!\n                const freshState = JSON.parse(JSON.stringify(localState));\n\n                for (let syncDomain in syncState) {\n                    if (syncState.hasOwnProperty(syncDomain) && matchesDomain(syncDomain)) {\n                        const syncStateDomain = syncState[syncDomain];\n                        if (!freshState[syncDomain]) {\n                            // TODO: replace this with a lodash cloneDeep !!\n                            freshState[syncDomain] = JSON.parse(JSON.stringify(syncStateDomain));\n                        } else {\n                            for (let syncUrl in syncStateDomain) {\n                                if (syncStateDomain.hasOwnProperty(syncUrl)) {\n                                    const syncItem = syncStateDomain[syncUrl];\n                                    if (!freshState[syncDomain][syncUrl]) {\n                                        freshState[syncDomain][syncUrl] = Object.assign({}, syncItem);\n                                    } else if (syncItem.lastUpdateTimestamp > freshState[syncDomain][syncUrl].lastUpdateTimestamp) {\n                                        // TODO: replace this with a lodash cloneDeep !!\n                                        freshState[syncDomain][syncUrl] = JSON.parse(JSON.stringify(syncItem));\n                                    }\n                                }\n                            }\n                        }\n\n                    }\n                }\n\n                chrome.storage.local.set(toStorageStateFormat(freshState));\n                chrome.storage.sync.set(toStorageStateFormat(freshState));\n            }\n        );\n    });\n}\n\nfunction setupSyncStorageState() {\n    syncStorageState();\n    setInterval(syncStorageState, SYNCHING_INTERVAL);\n}\n\nfunction bootstrap() {\n    setupSyncStorageState();\n    setupTrackingPolling();\n    attachEvents();\n}\n\nbootstrap();\n"],"names":["sortItemsByTime","timestamp","tsA","tsB","sortItemsByCurrentPrice","currentPrice","cpA","cpB","TIME","CURRENT_PRICE","State","recordActive","notifications","notificationsCounter","autoSaveEnabled","isPriceUpdateEnabled","selection","isSimilarElementHighlighted","originalBackgroundColor","isCurrentPageTracked","faviconURL","_faviconURLMap","currentURL","canonicalURL","browserURL","domain","_sortItemsBy","SORT_ITEMS_BY_TIME","DEFAULT_ICON","TRACKED_ITEM_ICON","DEFAULT_TITLE","TRACKED_ITEM_TITLE","PRICE_CHECKING_INTERVAL","SYNCHING_INTERVAL","ICONS","PRICE_UPDATE","PRICE_NOT_FOUND","PRICE_FIX","MATCHES","PRICE","HOSTNAME","DOMAIN","URL","CAPTURE","DOMAIN_IN_URL","HOSTNAME_AND_PATH","PROTOCOL_HOSTNAME_AND_PATH","ITEM_STATUS","WATCHED","NOT_FOUND","INCREASED","DECREASED","ACK_DECREASE","ACK_INCREASE","FIXED","ALL_ITEM_STATUSES","Object","values","removeStatuses","item","statusesToRemove","length","statuses","filter","status","includes","toUnique","array","Array","from","Set","updateItemCurrentPrice","newPrice","previousPrice","newItem","updateItemDiffPercentage","diff","Math","abs","price","diffPerc","parseFloat","toFixed","diffPercentage","ceil","floor","updateItemTrackStatus","statusesToAdd","forceStartingPrice","updatedItem","lastUpdateTimestamp","Date","getTime","startingPrice","isWatched","isNotFound","hasAcknowledgeDecrease","hasAcknowledgeIncrease","onConfirmURLForCreateItemAttempt","tabId","url","faviconAlt","callback","modalElementId","chrome","tabs","sendMessage","type","payload","elementId","buildURLConfirmationPayload","index","storage","local","get","result","domainState","JSON","parse","_canUseCanonical","set","stringify","updateCurrentURL","onRecordDone","updateFaviconURL","canDisplayURLConfirmation","canDisplay","canSave","useCaninocal","checkForURLSimilarity","isToSave","createItem","updateExtensionAppearance","disableRecord","onRecordCancel","onAutoSaveCheckStatus","sendResponse","setSelectionInfo","onPriceUpdateCheckStatus","trackedPrice","toPrice","onSimilarElementHighlight","isHighlighted","setSimilarElementHighlight","createTrackedItem","items","undefined","disableAutoSave","toggleRecord","state","disableCurrentPageTracked","enableCurrentPageTracked","updateCurrentDomain","updateCanonicalURL","updateBrowserURL","updateFaviconURLMapItem","incrementNotificationsCounter","deleteNotificationsItem","notificationId","newState","updateNotificationsItem","notificationState","updateSortItemsBy","isUseCanonicalPrefUnset","setDefaultAppearance","browserAction","setTitle","title","setIcon","path","setTrackedItemAppearance","enableAutoSave","enablePriceUpdate","disablePriceUpdate","checkForPriceChanges","hasOwnProperty","matchesDomain","domainItems","matchesURL","request","XMLHttpRequest","targetPrice","onload","template","createHTMLTemplate","response","textContent","querySelector","textContentMatch","match","createNotification","buttons","notificationOptions","push","e","console","warn","open","send","getTrackedItemsSortedBy","sortType","trackedItems","keys","forEach","key","domainData","matchesHostname","sortByFn","sortTrackedItemsBy","sort","removeTrackedItem","found","updateAutoSaveStatus","updatePriceUpdateStatus","clearNotification","notifId","wasClosedByUser","clear","wasClickedByUser","iconUrl","message","contextMessage","extraOptions","options","requireInteraction","create","id","priceNumber","replace","formattedPrice","html","document","createElement","trim","innerHTML","content","isCanonicalURLRelevant","canonical","matchesHostnameAndPath","string","test","parseDomainState","setupTrackingPolling","setInterval","isItemNullOrUnwatched","urlFromDomain","hasItemPriceIncOrDec","currentDomain","forcePageTrackingTo","fullURL","captureHostAndPathFromURL","captureHostAndPath","hostAndPath","captureProtocolHostAndPathFromURL","captureProtocolHostAndPath","protocolHostAndPath","searchForEqualPathWatchedItem","currentHostAndPath","foundOne","buildSaveConfirmationPayload","similarURL","_isPathEnoughToTrack","getCanonicalPathFromSource","source","canonicalElement","getAttribute","onXHR","onTabContextChange","captureDomain","protocolHostAndPathFromURL","canUseCanonical","attachEvents","runtime","onInstalled","addListener","log","onActivated","query","active","currentWindow","startsWith","onUpdated","favIconUrl","webNavigation","onCompleted","frameId","onHistoryStateUpdated","onMessage","sender","bind","stateUrl","autoSaveStatus","updatedPrice","itemUrl","sortByType","SORT_BY_TYPES","onClicked","onButtonClicked","buttonIndex","priceBeforeIncreasing","onClosed","filterAllTrackedItems","filteredResult","toStorageStateFormat","reduce","syncStorageState","localResult","localState","sync","syncResult","syncState","freshState","syncDomain","syncStateDomain","syncUrl","syncItem","assign","setupSyncStorageState","bootstrap"],"mappings":"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"}