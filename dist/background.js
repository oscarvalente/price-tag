!function(){"use strict";function t(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function e(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),o.forEach(function(r){t(e,r,n[r])})}return e}const r="TIME";var n=Object.freeze({TIME:r,CURRENT_PRICE:"CURRENT_PRICE"});const o=2e4,i=12e4,c=10,s=12e4,a="Price Tag",u="Price Tag - This item is being tracked",l={WATCHED:"WATCHED",NOT_FOUND:"NOT_FOUND",INCREASED:"INCREASED",DECREASED:"DECREASED",ACK_DECREASE:"ACK_DECREASE",ACK_INCREASE:"ACK_INCREASE",FIXED:"FIXED"},f=Object.values(l);var p={WATCHED:l.WATCHED,NOT_FOUND:l.NOT_FOUND,INCREASED:l.INCREASED,DECREASED:l.DECREASED,ACK_DECREASE:l.ACK_DECREASE,ACK_INCREASE:l.ACK_INCREASE,FIXED:l.FIXED,ALL_STATUSES:f};const h="assets/icon_48.png",d="assets/icon_active_48.png",b="./assets/time-is-money.svg",v="./assets/time.svg",m="./assets/coin.svg";var y={PRICE:/((?:\d+[.,])?\d+(?:[.,]\d+)?)/,HOSTNAME:/https?:\/\/([\w.]+)\/*/,DOMAIN:/^([\w-]+\.)+[\w-]+\w$/,URL:/^https?:\/\/([\w-]+\.)+[\w-]+\w(\/[\w-=.]+)+\/?(\?([\w]+=?[\w-%!@()\\["#\]]+&?)*)?/,CAPTURE:{DOMAIN_IN_URL:/https?:\/\/([\w.]+)\/*/,HOSTNAME_AND_PATH:/^https?:\/\/((?:[\w-]+\.)+[\w-]+\w(?:\/[\w-=.]+)+\/?)/,PROTOCOL_HOSTNAME_AND_PATH:/^(https?:\/\/(?:[\w-]+\.)+[\w-]+\w(?:\/[\w-=.]+)+\/?)/}};function g(){chrome.browserAction.setTitle({title:a}),chrome.browserAction.setIcon({path:h})}function _(){chrome.browserAction.setTitle({title:u}),chrome.browserAction.setIcon({path:d})}function S(t){const e=parseFloat(t.replace(",",".")).toFixed(2);return parseFloat(e)}function E(t){return t&&(e=t,y.CAPTURE.HOSTNAME_AND_PATH.test(e));var e}function R(t){return y.DOMAIN.test(t)}function T(t){return y.URL.test(t)}function A(t){const e=t.match(y.CAPTURE.HOSTNAME_AND_PATH);let r=null;return e&&([,r]=e),r}function I(t){const e=t.match(y.CAPTURE.PROTOCOL_HOSTNAME_AND_PATH);let r=null;return e&&([,r]=e),r}var O=function(t,e,r){var n;return r(t,function(t,r,o){if(e(t,r,o))return n=r,!1}),n};var C=function(t){return function(e,r,n){for(var o=-1,i=Object(e),c=n(e),s=c.length;s--;){var a=c[t?s:++o];if(!1===r(i[a],a,i))break}return e}}();var w=function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n},U="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function P(t,e){return t(e={exports:{}},e.exports),e.exports}var N="object"==typeof U&&U&&U.Object===Object&&U,j="object"==typeof self&&self&&self.Object===Object&&self,D=N||j||Function("return this")(),L=D.Symbol,k=Object.prototype,x=k.hasOwnProperty,F=k.toString,H=L?L.toStringTag:void 0;var M=function(t){var e=x.call(t,H),r=t[H];try{t[H]=void 0}catch(t){}var n=F.call(t);return e?t[H]=r:delete t[H],n},J=Object.prototype.toString;var $=function(t){return J.call(t)},K="[object Null]",B="[object Undefined]",G=L?L.toStringTag:void 0;var z=function(t){return null==t?void 0===t?B:K:G&&G in Object(t)?M(t):$(t)};var W=function(t){return null!=t&&"object"==typeof t},V="[object Arguments]";var Y=function(t){return W(t)&&z(t)==V},X=Object.prototype,q=X.hasOwnProperty,Q=X.propertyIsEnumerable,Z=Y(function(){return arguments}())?Y:function(t){return W(t)&&q.call(t,"callee")&&!Q.call(t,"callee")},tt=Array.isArray;var et=function(){return!1},rt=P(function(t,e){var r=e&&!e.nodeType&&e,n=r&&t&&!t.nodeType&&t,o=n&&n.exports===r?D.Buffer:void 0,i=(o?o.isBuffer:void 0)||et;t.exports=i}),nt=9007199254740991,ot=/^(?:0|[1-9]\d*)$/;var it=function(t,e){var r=typeof t;return!!(e=null==e?nt:e)&&("number"==r||"symbol"!=r&&ot.test(t))&&t>-1&&t%1==0&&t<e},ct=9007199254740991;var st=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=ct},at={};at["[object Float32Array]"]=at["[object Float64Array]"]=at["[object Int8Array]"]=at["[object Int16Array]"]=at["[object Int32Array]"]=at["[object Uint8Array]"]=at["[object Uint8ClampedArray]"]=at["[object Uint16Array]"]=at["[object Uint32Array]"]=!0,at["[object Arguments]"]=at["[object Array]"]=at["[object ArrayBuffer]"]=at["[object Boolean]"]=at["[object DataView]"]=at["[object Date]"]=at["[object Error]"]=at["[object Function]"]=at["[object Map]"]=at["[object Number]"]=at["[object Object]"]=at["[object RegExp]"]=at["[object Set]"]=at["[object String]"]=at["[object WeakMap]"]=!1;var ut=function(t){return W(t)&&st(t.length)&&!!at[z(t)]};var lt=function(t){return function(e){return t(e)}},ft=P(function(t,e){var r=e&&!e.nodeType&&e,n=r&&t&&!t.nodeType&&t,o=n&&n.exports===r&&N.process,i=function(){try{var t=n&&n.require&&n.require("util").types;return t||o&&o.binding&&o.binding("util")}catch(t){}}();t.exports=i}),pt=ft&&ft.isTypedArray,ht=pt?lt(pt):ut,dt=Object.prototype.hasOwnProperty;var bt=function(t,e){var r=tt(t),n=!r&&Z(t),o=!r&&!n&&rt(t),i=!r&&!n&&!o&&ht(t),c=r||n||o||i,s=c?w(t.length,String):[],a=s.length;for(var u in t)!e&&!dt.call(t,u)||c&&("length"==u||o&&("offset"==u||"parent"==u)||i&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||it(u,a))||s.push(u);return s},vt=Object.prototype;var mt=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||vt)};var yt=function(t,e){return function(r){return t(e(r))}}(Object.keys,Object),gt=Object.prototype.hasOwnProperty;var _t=function(t){if(!mt(t))return yt(t);var e=[];for(var r in Object(t))gt.call(t,r)&&"constructor"!=r&&e.push(r);return e};var St=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)},Et="[object AsyncFunction]",Rt="[object Function]",Tt="[object GeneratorFunction]",At="[object Proxy]";var It=function(t){if(!St(t))return!1;var e=z(t);return e==Rt||e==Tt||e==Et||e==At};var Ot=function(t){return null!=t&&st(t.length)&&!It(t)};var Ct=function(t){return Ot(t)?bt(t):_t(t)};var wt=function(t,e){return t&&C(t,e,Ct)};var Ut=function(){this.__data__=[],this.size=0};var Pt=function(t,e){return t===e||t!=t&&e!=e};var Nt=function(t,e){for(var r=t.length;r--;)if(Pt(t[r][0],e))return r;return-1},jt=Array.prototype.splice;var Dt=function(t){var e=this.__data__,r=Nt(e,t);return!(r<0||(r==e.length-1?e.pop():jt.call(e,r,1),--this.size,0))};var Lt=function(t){var e=this.__data__,r=Nt(e,t);return r<0?void 0:e[r][1]};var kt=function(t){return Nt(this.__data__,t)>-1};var xt=function(t,e){var r=this.__data__,n=Nt(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this};function Ft(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Ft.prototype.clear=Ut,Ft.prototype.delete=Dt,Ft.prototype.get=Lt,Ft.prototype.has=kt,Ft.prototype.set=xt;var Ht=Ft;var Mt=function(){this.__data__=new Ht,this.size=0};var Jt=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r};var $t=function(t){return this.__data__.get(t)};var Kt,Bt=function(t){return this.__data__.has(t)},Gt=D["__core-js_shared__"],zt=(Kt=/[^.]+$/.exec(Gt&&Gt.keys&&Gt.keys.IE_PROTO||""))?"Symbol(src)_1."+Kt:"";var Wt=function(t){return!!zt&&zt in t},Vt=Function.prototype.toString;var Yt=function(t){if(null!=t){try{return Vt.call(t)}catch(t){}try{return t+""}catch(t){}}return""},Xt=/^\[object .+?Constructor\]$/,qt=Function.prototype,Qt=Object.prototype,Zt=qt.toString,te=Qt.hasOwnProperty,ee=RegExp("^"+Zt.call(te).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var re=function(t){return!(!St(t)||Wt(t))&&(It(t)?ee:Xt).test(Yt(t))};var ne=function(t,e){return null==t?void 0:t[e]};var oe=function(t,e){var r=ne(t,e);return re(r)?r:void 0},ie=oe(D,"Map"),ce=oe(Object,"create");var se=function(){this.__data__=ce?ce(null):{},this.size=0};var ae=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},ue="__lodash_hash_undefined__",le=Object.prototype.hasOwnProperty;var fe=function(t){var e=this.__data__;if(ce){var r=e[t];return r===ue?void 0:r}return le.call(e,t)?e[t]:void 0},pe=Object.prototype.hasOwnProperty;var he=function(t){var e=this.__data__;return ce?void 0!==e[t]:pe.call(e,t)},de="__lodash_hash_undefined__";var be=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=ce&&void 0===e?de:e,this};function ve(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}ve.prototype.clear=se,ve.prototype.delete=ae,ve.prototype.get=fe,ve.prototype.has=he,ve.prototype.set=be;var me=ve;var ye=function(){this.size=0,this.__data__={hash:new me,map:new(ie||Ht),string:new me}};var ge=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t};var _e=function(t,e){var r=t.__data__;return ge(e)?r["string"==typeof e?"string":"hash"]:r.map};var Se=function(t){var e=_e(this,t).delete(t);return this.size-=e?1:0,e};var Ee=function(t){return _e(this,t).get(t)};var Re=function(t){return _e(this,t).has(t)};var Te=function(t,e){var r=_e(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this};function Ae(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Ae.prototype.clear=ye,Ae.prototype.delete=Se,Ae.prototype.get=Ee,Ae.prototype.has=Re,Ae.prototype.set=Te;var Ie=Ae,Oe=200;var Ce=function(t,e){var r=this.__data__;if(r instanceof Ht){var n=r.__data__;if(!ie||n.length<Oe-1)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new Ie(n)}return r.set(t,e),this.size=r.size,this};function we(t){var e=this.__data__=new Ht(t);this.size=e.size}we.prototype.clear=Mt,we.prototype.delete=Jt,we.prototype.get=$t,we.prototype.has=Bt,we.prototype.set=Ce;var Ue=we,Pe="__lodash_hash_undefined__";var Ne=function(t){return this.__data__.set(t,Pe),this};var je=function(t){return this.__data__.has(t)};function De(t){var e=-1,r=null==t?0:t.length;for(this.__data__=new Ie;++e<r;)this.add(t[e])}De.prototype.add=De.prototype.push=Ne,De.prototype.has=je;var Le=De;var ke=function(t,e){for(var r=-1,n=null==t?0:t.length;++r<n;)if(e(t[r],r,t))return!0;return!1};var xe=function(t,e){return t.has(e)},Fe=1,He=2;var Me=function(t,e,r,n,o,i){var c=r&Fe,s=t.length,a=e.length;if(s!=a&&!(c&&a>s))return!1;var u=i.get(t);if(u&&i.get(e))return u==e;var l=-1,f=!0,p=r&He?new Le:void 0;for(i.set(t,e),i.set(e,t);++l<s;){var h=t[l],d=e[l];if(n)var b=c?n(d,h,l,e,t,i):n(h,d,l,t,e,i);if(void 0!==b){if(b)continue;f=!1;break}if(p){if(!ke(e,function(t,e){if(!xe(p,e)&&(h===t||o(h,t,r,n,i)))return p.push(e)})){f=!1;break}}else if(h!==d&&!o(h,d,r,n,i)){f=!1;break}}return i.delete(t),i.delete(e),f},Je=D.Uint8Array;var $e=function(t){var e=-1,r=Array(t.size);return t.forEach(function(t,n){r[++e]=[n,t]}),r};var Ke=function(t){var e=-1,r=Array(t.size);return t.forEach(function(t){r[++e]=t}),r},Be=1,Ge=2,ze="[object Boolean]",We="[object Date]",Ve="[object Error]",Ye="[object Map]",Xe="[object Number]",qe="[object RegExp]",Qe="[object Set]",Ze="[object String]",tr="[object Symbol]",er="[object ArrayBuffer]",rr="[object DataView]",nr=L?L.prototype:void 0,or=nr?nr.valueOf:void 0;var ir=function(t,e,r,n,o,i,c){switch(r){case rr:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case er:return!(t.byteLength!=e.byteLength||!i(new Je(t),new Je(e)));case ze:case We:case Xe:return Pt(+t,+e);case Ve:return t.name==e.name&&t.message==e.message;case qe:case Ze:return t==e+"";case Ye:var s=$e;case Qe:var a=n&Be;if(s||(s=Ke),t.size!=e.size&&!a)return!1;var u=c.get(t);if(u)return u==e;n|=Ge,c.set(t,e);var l=Me(s(t),s(e),n,o,i,c);return c.delete(t),l;case tr:if(or)return or.call(t)==or.call(e)}return!1};var cr=function(t,e){for(var r=-1,n=e.length,o=t.length;++r<n;)t[o+r]=e[r];return t};var sr=function(t,e,r){var n=e(t);return tt(t)?n:cr(n,r(t))};var ar=function(t,e){for(var r=-1,n=null==t?0:t.length,o=0,i=[];++r<n;){var c=t[r];e(c,r,t)&&(i[o++]=c)}return i};var ur=function(){return[]},lr=Object.prototype.propertyIsEnumerable,fr=Object.getOwnPropertySymbols,pr=fr?function(t){return null==t?[]:(t=Object(t),ar(fr(t),function(e){return lr.call(t,e)}))}:ur;var hr=function(t){return sr(t,Ct,pr)},dr=1,br=Object.prototype.hasOwnProperty;var vr=function(t,e,r,n,o,i){var c=r&dr,s=hr(t),a=s.length;if(a!=hr(e).length&&!c)return!1;for(var u=a;u--;){var l=s[u];if(!(c?l in e:br.call(e,l)))return!1}var f=i.get(t);if(f&&i.get(e))return f==e;var p=!0;i.set(t,e),i.set(e,t);for(var h=c;++u<a;){var d=t[l=s[u]],b=e[l];if(n)var v=c?n(b,d,l,e,t,i):n(d,b,l,t,e,i);if(!(void 0===v?d===b||o(d,b,r,n,i):v)){p=!1;break}h||(h="constructor"==l)}if(p&&!h){var m=t.constructor,y=e.constructor;m!=y&&"constructor"in t&&"constructor"in e&&!("function"==typeof m&&m instanceof m&&"function"==typeof y&&y instanceof y)&&(p=!1)}return i.delete(t),i.delete(e),p},mr=oe(D,"DataView"),yr=oe(D,"Promise"),gr=oe(D,"Set"),_r=oe(D,"WeakMap"),Sr=Yt(mr),Er=Yt(ie),Rr=Yt(yr),Tr=Yt(gr),Ar=Yt(_r),Ir=z;(mr&&"[object DataView]"!=Ir(new mr(new ArrayBuffer(1)))||ie&&"[object Map]"!=Ir(new ie)||yr&&"[object Promise]"!=Ir(yr.resolve())||gr&&"[object Set]"!=Ir(new gr)||_r&&"[object WeakMap]"!=Ir(new _r))&&(Ir=function(t){var e=z(t),r="[object Object]"==e?t.constructor:void 0,n=r?Yt(r):"";if(n)switch(n){case Sr:return"[object DataView]";case Er:return"[object Map]";case Rr:return"[object Promise]";case Tr:return"[object Set]";case Ar:return"[object WeakMap]"}return e});var Or=Ir,Cr=1,wr="[object Arguments]",Ur="[object Array]",Pr="[object Object]",Nr=Object.prototype.hasOwnProperty;var jr=function(t,e,r,n,o,i){var c=tt(t),s=tt(e),a=c?Ur:Or(t),u=s?Ur:Or(e),l=(a=a==wr?Pr:a)==Pr,f=(u=u==wr?Pr:u)==Pr,p=a==u;if(p&&rt(t)){if(!rt(e))return!1;c=!0,l=!1}if(p&&!l)return i||(i=new Ue),c||ht(t)?Me(t,e,r,n,o,i):ir(t,e,a,r,n,o,i);if(!(r&Cr)){var h=l&&Nr.call(t,"__wrapped__"),d=f&&Nr.call(e,"__wrapped__");if(h||d){var b=h?t.value():t,v=d?e.value():e;return i||(i=new Ue),o(b,v,r,n,i)}}return!!p&&(i||(i=new Ue),vr(t,e,r,n,o,i))};var Dr=function t(e,r,n,o,i){return e===r||(null==e||null==r||!W(e)&&!W(r)?e!=e&&r!=r:jr(e,r,n,o,t,i))},Lr=1,kr=2;var xr=function(t,e,r,n){var o=r.length,i=o,c=!n;if(null==t)return!i;for(t=Object(t);o--;){var s=r[o];if(c&&s[2]?s[1]!==t[s[0]]:!(s[0]in t))return!1}for(;++o<i;){var a=(s=r[o])[0],u=t[a],l=s[1];if(c&&s[2]){if(void 0===u&&!(a in t))return!1}else{var f=new Ue;if(n)var p=n(u,l,a,t,e,f);if(!(void 0===p?Dr(l,u,Lr|kr,n,f):p))return!1}}return!0};var Fr=function(t){return t==t&&!St(t)};var Hr=function(t){for(var e=Ct(t),r=e.length;r--;){var n=e[r],o=t[n];e[r]=[n,o,Fr(o)]}return e};var Mr=function(t,e){return function(r){return null!=r&&r[t]===e&&(void 0!==e||t in Object(r))}};var Jr=function(t){var e=Hr(t);return 1==e.length&&e[0][2]?Mr(e[0][0],e[0][1]):function(r){return r===t||xr(r,t,e)}},$r="[object Symbol]";var Kr=function(t){return"symbol"==typeof t||W(t)&&z(t)==$r},Br=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Gr=/^\w*$/;var zr=function(t,e){if(tt(t))return!1;var r=typeof t;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=t&&!Kr(t))||Gr.test(t)||!Br.test(t)||null!=e&&t in Object(e)},Wr="Expected a function";function Vr(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError(Wr);var r=function(){var n=arguments,o=e?e.apply(this,n):n[0],i=r.cache;if(i.has(o))return i.get(o);var c=t.apply(this,n);return r.cache=i.set(o,c)||i,c};return r.cache=new(Vr.Cache||Ie),r}Vr.Cache=Ie;var Yr=Vr,Xr=500;var qr=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Qr=/\\(\\)?/g,Zr=function(t){var e=Yr(t,function(t){return r.size===Xr&&r.clear(),t}),r=e.cache;return e}(function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(qr,function(t,r,n,o){e.push(n?o.replace(Qr,"$1"):r||t)}),e});var tn=function(t,e){for(var r=-1,n=null==t?0:t.length,o=Array(n);++r<n;)o[r]=e(t[r],r,t);return o},en=1/0,rn=L?L.prototype:void 0,nn=rn?rn.toString:void 0;var on=function t(e){if("string"==typeof e)return e;if(tt(e))return tn(e,t)+"";if(Kr(e))return nn?nn.call(e):"";var r=e+"";return"0"==r&&1/e==-en?"-0":r};var cn=function(t){return null==t?"":on(t)};var sn=function(t,e){return tt(t)?t:zr(t,e)?[t]:Zr(cn(t))},an=1/0;var un=function(t){if("string"==typeof t||Kr(t))return t;var e=t+"";return"0"==e&&1/t==-an?"-0":e};var ln=function(t,e){for(var r=0,n=(e=sn(e,t)).length;null!=t&&r<n;)t=t[un(e[r++])];return r&&r==n?t:void 0};var fn=function(t,e,r){var n=null==t?void 0:ln(t,e);return void 0===n?r:n};var pn=function(t,e){return null!=t&&e in Object(t)};var hn=function(t,e,r){for(var n=-1,o=(e=sn(e,t)).length,i=!1;++n<o;){var c=un(e[n]);if(!(i=null!=t&&r(t,c)))break;t=t[c]}return i||++n!=o?i:!!(o=null==t?0:t.length)&&st(o)&&it(c,o)&&(tt(t)||Z(t))};var dn=function(t,e){return null!=t&&hn(t,e,pn)},bn=1,vn=2;var mn=function(t,e){return zr(t)&&Fr(e)?Mr(un(t),e):function(r){var n=fn(r,t);return void 0===n&&n===e?dn(r,t):Dr(e,n,bn|vn)}};var yn=function(t){return t};var gn=function(t){return function(e){return null==e?void 0:e[t]}};var _n=function(t){return function(e){return ln(e,t)}};var Sn=function(t){return zr(t)?gn(un(t)):_n(t)};var En=function(t){return"function"==typeof t?t:null==t?yn:"object"==typeof t?tt(t)?mn(t[0],t[1]):Jr(t):Sn(t)};var Rn=function(t,e){return O(t,En(e,3),wt)};function Tn(t){let r={};for(let n in t)if(t.hasOwnProperty(n)&&R(n)&&t[n]){r=e({},r,{[n]:JSON.parse(t[n])})}return r}class An{static createState(t){return{recordActive:!1,notifications:{},notificationsCounter:0,autoSaveEnabled:!1,isPriceUpdateEnabled:!1,selection:null,isSimilarElementHighlighted:!1,originalBackgroundColor:null,isCurrentPageTracked:!1,faviconURL:null,_faviconURLMap:{},currentURL:null,canonicalURL:null,browserURL:null,domain:null,_sortItemsBy:t,_undoRemovedItems:[],_undoRemovedItemsResetTask:null}}static toggleRecord(t){return e({},t,{recordActive:!t.recordActive})}static disableRecord(t){return e({},t,{recordActive:!1})}static updateCurrentDomain(t,r){return e({},t,{domain:r})}static updateCurrentURL(t,r){return e({},t,{currentURL:r})}static updateCanonicalURL(t,r){return e({},t,{canonicalURL:r})}static updateBrowserURL(t,r){return e({},t,{browserURL:r})}static enableCurrentPageTracked(t){return e({},t,{isCurrentPageTracked:!0})}static disableCurrentPageTracked(t){return e({},t,{isCurrentPageTracked:!1})}static updateFaviconURL(t,r){return e({},t,{faviconURL:r})}static updateFaviconURLMapItem(t,r,n){return e({},t,{_faviconURLMap:e({},t._faviconURLMap,{[r]:n})})}static enableAutoSave(t,r){return e({},t,{autoSaveEnabled:!0,selection:r=r||t.selection})}static disableAutoSave(t){return e({},t,{autoSaveEnabled:!1})}static enablePriceUpdate(t,r){return e({},t,{isPriceUpdateEnabled:!0,selection:r})}static disablePriceUpdate(t){return e({},t,{isPriceUpdateEnabled:!1})}static setSelectionInfo(t,r,n,o,i){return e({},t,{selection:r,price:n,faviconURL:o,faviconAlt:i})}static setSimilarElementHighlight(t,r,n){return e({},t,{isSimilarElementHighlighted:r,originalBackgroundColor:n})}static incrementNotificationsCounter(t){return e({},t,{notificationsCounter:t.notificationsCounter+1})}static deleteNotificationsItem(t,r){const n=e({},t);return delete n.notifications[r],n}static updateNotificationsItem(t,r,n){return e({},t,{notifications:e({},t.notifications,{[r]:n})})}static updateSortItemsBy(t,r){return e({},t,{_sortItemsBy:r})}static addUndoRemovedItem(t,r,{timestamp:n},o){const i={url:r,timestamp:n},c=[...t._undoRemovedItems];return c.unshift(i),e({},t,{_undoRemovedItems:c.slice(0,o)})}static getUndoRemovedItemsHead(t){return t._undoRemovedItems[0]}static removeUndoRemovedItem(t){const r=[...t._undoRemovedItems];return r.shift(),e({},t,{_undoRemovedItems:r})}static resetUndoRemovedItems(t){return e({},t,{_undoRemovedItems:[]})}static setUndoRemovedItemsResetTask(t,r){return e({},t,{_undoRemovedItemsResetTask:r})}static toStorageStateFormat(t){return Object.keys(t).reduce((r,n)=>e({},r,{[n]:JSON.stringify(t[n])}),{})}}function In(){chrome.storage.local.get(null,t=>{const e=Tn(t);chrome.storage.sync.get(null,t=>{const r=Tn(t),n=JSON.parse(JSON.stringify(e));for(let t in r)if(r.hasOwnProperty(t)&&R(t)){const e=r[t];if(n[t]){for(let r in e)if(e.hasOwnProperty(r)){const o=e[r];n[t][r]?o.lastUpdateTimestamp>n[t][r].lastUpdateTimestamp&&(n[t][r]=JSON.parse(JSON.stringify(o))):n[t][r]=Object.assign({},o)}}else n[t]=JSON.parse(JSON.stringify(e))}chrome.storage.local.set(An.toStorageStateFormat(n)),chrome.storage.sync.set(An.toStorageStateFormat(n))})})}var On=function(t,e){return(On=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function Cn(t,e){function r(){this.constructor=t}On(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}function wn(t){return"function"==typeof t}var Un=!1,Pn={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){t&&(new Error).stack;Un=t},get useDeprecatedSynchronousErrorHandling(){return Un}};function Nn(t){setTimeout(function(){throw t})}var jn={closed:!0,next:function(t){},error:function(t){if(Pn.useDeprecatedSynchronousErrorHandling)throw t;Nn(t)},complete:function(){}},Dn=Array.isArray||function(t){return t&&"number"==typeof t.length};function Ln(t){return null!=t&&"object"==typeof t}var kn,xn={e:{}};function Fn(){try{return kn.apply(this,arguments)}catch(t){return xn.e=t,xn}}function Hn(t){return kn=t,Fn}function Mn(t){return Error.call(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map(function(t,e){return e+1+") "+t.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t,this}Mn.prototype=Object.create(Error.prototype);var Jn=Mn,$n=function(){function t(t){this.closed=!1,this._parent=null,this._parents=null,this._subscriptions=null,t&&(this._unsubscribe=t)}var e;return t.prototype.unsubscribe=function(){var t,e=!1;if(!this.closed){var r=this._parent,n=this._parents,o=this._unsubscribe,i=this._subscriptions;this.closed=!0,this._parent=null,this._parents=null,this._subscriptions=null;for(var c=-1,s=n?n.length:0;r;)r.remove(this),r=++c<s&&n[c]||null;if(wn(o))Hn(o).call(this)===xn&&(e=!0,t=t||(xn.e instanceof Jn?Kn(xn.e.errors):[xn.e]));if(Dn(i))for(c=-1,s=i.length;++c<s;){var a=i[c];if(Ln(a))if(Hn(a.unsubscribe).call(a)===xn){e=!0,t=t||[];var u=xn.e;u instanceof Jn?t=t.concat(Kn(u.errors)):t.push(u)}}if(e)throw new Jn(t)}},t.prototype.add=function(e){if(!e||e===t.EMPTY)return t.EMPTY;if(e===this)return this;var r=e;switch(typeof e){case"function":r=new t(e);case"object":if(r.closed||"function"!=typeof r.unsubscribe)return r;if(this.closed)return r.unsubscribe(),r;if("function"!=typeof r._addParent){var n=r;(r=new t)._subscriptions=[n]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}return(this._subscriptions||(this._subscriptions=[])).push(r),r._addParent(this),r},t.prototype.remove=function(t){var e=this._subscriptions;if(e){var r=e.indexOf(t);-1!==r&&e.splice(r,1)}},t.prototype._addParent=function(t){var e=this._parent,r=this._parents;e&&e!==t?r?-1===r.indexOf(t)&&r.push(t):this._parents=[t]:this._parent=t},t.EMPTY=((e=new t).closed=!0,e),t}();function Kn(t){return t.reduce(function(t,e){return t.concat(e instanceof Jn?e.errors:e)},[])}var Bn="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),Gn=function(t){function e(r,n,o){var i=t.call(this)||this;switch(i.syncErrorValue=null,i.syncErrorThrown=!1,i.syncErrorThrowable=!1,i.isStopped=!1,i._parentSubscription=null,arguments.length){case 0:i.destination=jn;break;case 1:if(!r){i.destination=jn;break}if("object"==typeof r){r instanceof e?(i.syncErrorThrowable=r.syncErrorThrowable,i.destination=r,r.add(i)):(i.syncErrorThrowable=!0,i.destination=new zn(i,r));break}default:i.syncErrorThrowable=!0,i.destination=new zn(i,r,n,o)}return i}return Cn(e,t),e.prototype[Bn]=function(){return this},e.create=function(t,r,n){var o=new e(t,r,n);return o.syncErrorThrowable=!1,o},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this))},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){this.destination.error(t),this.unsubscribe()},e.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},e.prototype._unsubscribeAndRecycle=function(){var t=this._parent,e=this._parents;return this._parent=null,this._parents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parent=t,this._parents=e,this._parentSubscription=null,this},e}($n),zn=function(t){function e(e,r,n,o){var i,c=t.call(this)||this;c._parentSubscriber=e;var s=c;return wn(r)?i=r:r&&(i=r.next,n=r.error,o=r.complete,r!==jn&&(wn((s=Object.create(r)).unsubscribe)&&c.add(s.unsubscribe.bind(s)),s.unsubscribe=c.unsubscribe.bind(c))),c._context=s,c._next=i,c._error=n,c._complete=o,c}return Cn(e,t),e.prototype.next=function(t){if(!this.isStopped&&this._next){var e=this._parentSubscriber;Pn.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?this.__tryOrSetError(e,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}},e.prototype.error=function(t){if(!this.isStopped){var e=this._parentSubscriber,r=Pn.useDeprecatedSynchronousErrorHandling;if(this._error)r&&e.syncErrorThrowable?(this.__tryOrSetError(e,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else if(e.syncErrorThrowable)r?(e.syncErrorValue=t,e.syncErrorThrown=!0):Nn(t),this.unsubscribe();else{if(this.unsubscribe(),r)throw t;Nn(t)}}},e.prototype.complete=function(){var t=this;if(!this.isStopped){var e=this._parentSubscriber;if(this._complete){var r=function(){return t._complete.call(t._context)};Pn.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?(this.__tryOrSetError(e,r),this.unsubscribe()):(this.__tryOrUnsub(r),this.unsubscribe())}else this.unsubscribe()}},e.prototype.__tryOrUnsub=function(t,e){try{t.call(this._context,e)}catch(t){if(this.unsubscribe(),Pn.useDeprecatedSynchronousErrorHandling)throw t;Nn(t)}},e.prototype.__tryOrSetError=function(t,e,r){if(!Pn.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{e.call(this._context,r)}catch(e){return Pn.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=e,t.syncErrorThrown=!0,!0):(Nn(e),!0)}return!1},e.prototype._unsubscribe=function(){var t=this._parentSubscriber;this._context=null,this._parentSubscriber=null,t.unsubscribe()},e}(Gn);var Wn="function"==typeof Symbol&&Symbol.observable||"@@observable";function Vn(){}var Yn=function(){function t(t){this._isScalar=!1,t&&(this._subscribe=t)}return t.prototype.lift=function(e){var r=new t;return r.source=this,r.operator=e,r},t.prototype.subscribe=function(t,e,r){var n=this.operator,o=function(t,e,r){if(t){if(t instanceof Gn)return t;if(t[Bn])return t[Bn]()}return t||e||r?new Gn(t,e,r):new Gn(jn)}(t,e,r);if(n?n.call(o,this.source):o.add(this.source||Pn.useDeprecatedSynchronousErrorHandling&&!o.syncErrorThrowable?this._subscribe(o):this._trySubscribe(o)),Pn.useDeprecatedSynchronousErrorHandling&&o.syncErrorThrowable&&(o.syncErrorThrowable=!1,o.syncErrorThrown))throw o.syncErrorValue;return o},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){Pn.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=e),!function(t){for(;t;){var e=t,r=e.closed,n=e.destination,o=e.isStopped;if(r||o)return!1;t=n&&n instanceof Gn?n:null}return!0}(t)?console.warn(e):t.error(e)}},t.prototype.forEach=function(t,e){var r=this;return new(e=Xn(e))(function(e,n){var o;o=r.subscribe(function(e){try{t(e)}catch(t){n(t),o&&o.unsubscribe()}},n,e)})},t.prototype._subscribe=function(t){var e=this.source;return e&&e.subscribe(t)},t.prototype[Wn]=function(){return this},t.prototype.pipe=function(){for(var t,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return 0===e.length?this:((t=e)?1===t.length?t[0]:function(e){return t.reduce(function(t,e){return e(t)},e)}:Vn)(this)},t.prototype.toPromise=function(t){var e=this;return new(t=Xn(t))(function(t,r){var n;e.subscribe(function(t){return n=t},function(t){return r(t)},function(){return t(n)})})},t.create=function(e){return new t(e)},t}();function Xn(t){if(t||(t=Pn.Promise||Promise),!t)throw new Error("no Promise impl found");return t}function qn(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}qn.prototype=Object.create(Error.prototype);var Qn=function(t){function e(e){var r=t.call(this,e)||this;return r.destination=e,r}return Cn(e,t),e}(Gn);var Zn=function(){function t(t){this.connectable=t}return t.prototype.call=function(t,e){var r=this.connectable;r._refCount++;var n=new to(t,r),o=e.subscribe(n);return n.closed||(n.connection=r.connect()),o},t}(),to=function(t){function e(e,r){var n=t.call(this,e)||this;return n.connectable=r,n}return Cn(e,t),e.prototype._unsubscribe=function(){var t=this.connectable;if(t){this.connectable=null;var e=t._refCount;if(e<=0)this.connection=null;else if(t._refCount=e-1,e>1)this.connection=null;else{var r=this.connection,n=t._connection;this.connection=null,!n||r&&n!==r||n.unsubscribe()}}else this.connection=null},e}(Gn),eo=function(t){function e(e,r){var n=t.call(this)||this;return n.source=e,n.subjectFactory=r,n._refCount=0,n._isComplete=!1,n}return Cn(e,t),e.prototype._subscribe=function(t){return this.getSubject().subscribe(t)},e.prototype.getSubject=function(){var t=this._subject;return t&&!t.isStopped||(this._subject=this.subjectFactory()),this._subject},e.prototype.connect=function(){var t=this._connection;return t||(this._isComplete=!1,(t=this._connection=new $n).add(this.source.subscribe(new ro(this.getSubject(),this))),t.closed?(this._connection=null,t=$n.EMPTY):this._connection=t),t},e.prototype.refCount=function(){return(t=this).lift(new Zn(t));var t},e}(Yn).prototype,ro=(eo._subscribe,eo._isComplete,eo.getSubject,eo.connect,eo.refCount,function(t){function e(e,r){var n=t.call(this,e)||this;return n.connectable=r,n}return Cn(e,t),e.prototype._error=function(e){this._unsubscribe(),t.prototype._error.call(this,e)},e.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),t.prototype._complete.call(this)},e.prototype._unsubscribe=function(){var t=this.connectable;if(t){this.connectable=null;var e=t._connection;t._refCount=0,t._subject=null,t._connection=null,e&&e.unsubscribe()}},e}(Qn)),no=new Yn(function(t){return t.complete()});function oo(t){return t?function(t){return new Yn(function(e){return t.schedule(function(){return e.complete()})})}(t):no}function io(t){return t&&"function"==typeof t.schedule}var co=function(t){return function(e){for(var r=0,n=t.length;r<n&&!e.closed;r++)e.next(t[r]);e.closed||e.complete()}};function so(t,e){return new Yn(e?function(r){var n=new $n,o=0;return n.add(e.schedule(function(){o!==t.length?(r.next(t[o++]),r.closed||n.add(this.schedule())):r.complete()})),n}:co(t))}function ao(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r,n,o=t[t.length-1];switch(io(o)?t.pop():o=void 0,t.length){case 0:return oo(o);case 1:return o?so(t,o):(r=t[0],(n=new Yn(function(t){t.next(r),t.complete()}))._isScalar=!0,n.value=r,n);default:return so(t,o)}}function uo(t){return t}function lo(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}lo.prototype=Object.create(Error.prototype);var fo=lo;function po(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}po.prototype=Object.create(Error.prototype);function ho(t,e){return function(r){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return r.lift(new bo(t,e))}}var bo=function(){function t(t,e){this.project=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new vo(t,this.project,this.thisArg))},t}(),vo=function(t){function e(e,r,n){var o=t.call(this,e)||this;return o.project=r,o.count=0,o.thisArg=n||o,o}return Cn(e,t),e.prototype._next=function(t){var e;try{e=this.project.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}this.destination.next(e)},e}(Gn),mo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Cn(e,t),e.prototype.notifyNext=function(t,e,r,n,o){this.destination.next(e)},e.prototype.notifyError=function(t,e){this.destination.error(t)},e.prototype.notifyComplete=function(t){this.destination.complete()},e}(Gn),yo=function(t){function e(e,r,n){var o=t.call(this)||this;return o.parent=e,o.outerValue=r,o.outerIndex=n,o.index=0,o}return Cn(e,t),e.prototype._next=function(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this.index++,this)},e.prototype._error=function(t){this.parent.notifyError(t,this),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},e}(Gn),go=function(t){return function(e){return t.then(function(t){e.closed||(e.next(t),e.complete())},function(t){return e.error(t)}).then(null,Nn),e}};function _o(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}var So=_o(),Eo=function(t){return function(e){for(var r=t[So]();;){var n=r.next();if(n.done){e.complete();break}if(e.next(n.value),e.closed)break}return"function"==typeof r.return&&e.add(function(){r.return&&r.return()}),e}},Ro=function(t){return function(e){var r=t[Wn]();if("function"!=typeof r.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return r.subscribe(e)}},To=function(t){return t&&"number"==typeof t.length&&"function"!=typeof t};function Ao(t){return t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}var Io=function(t){if(t instanceof Yn)return function(e){return t._isScalar?(e.next(t.value),void e.complete()):t.subscribe(e)};if(t&&"function"==typeof t[Wn])return Ro(t);if(To(t))return co(t);if(Ao(t))return go(t);if(t&&"function"==typeof t[So])return Eo(t);var e=Ln(t)?"an invalid object":"'"+t+"'";throw new TypeError("You provided "+e+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")};function Oo(t,e,r,n,o){if(void 0===o&&(o=new yo(t,r,n)),!o.closed)return Io(e)(o)}function Co(t,e){if(!e)return t instanceof Yn?t:new Yn(Io(t));if(null!=t){if(function(t){return t&&"function"==typeof t[Wn]}(t))return function(t,e){return new Yn(e?function(r){var n=new $n;return n.add(e.schedule(function(){var o=t[Wn]();n.add(o.subscribe({next:function(t){n.add(e.schedule(function(){return r.next(t)}))},error:function(t){n.add(e.schedule(function(){return r.error(t)}))},complete:function(){n.add(e.schedule(function(){return r.complete()}))}}))})),n}:Ro(t))}(t,e);if(Ao(t))return function(t,e){return new Yn(e?function(r){var n=new $n;return n.add(e.schedule(function(){return t.then(function(t){n.add(e.schedule(function(){r.next(t),n.add(e.schedule(function(){return r.complete()}))}))},function(t){n.add(e.schedule(function(){return r.error(t)}))})})),n}:go(t))}(t,e);if(To(t))return so(t,e);if(function(t){return t&&"function"==typeof t[So]}(t)||"string"==typeof t)return function(t,e){if(!t)throw new Error("Iterable cannot be null");return new Yn(e?function(r){var n,o=new $n;return o.add(function(){n&&"function"==typeof n.return&&n.return()}),o.add(e.schedule(function(){n=t[So](),o.add(e.schedule(function(){if(!r.closed){var t,e;try{var o=n.next();t=o.value,e=o.done}catch(t){return void r.error(t)}e?r.complete():(r.next(t),this.schedule())}}))})),o}:Eo(t))}(t,e)}throw new TypeError((null!==t&&typeof t||t)+" is not observable")}var wo=function(){function t(t,e){void 0===e&&(e=Number.POSITIVE_INFINITY),this.project=t,this.concurrent=e}return t.prototype.call=function(t,e){return e.subscribe(new Uo(t,this.project,this.concurrent))},t}(),Uo=function(t){function e(e,r,n){void 0===n&&(n=Number.POSITIVE_INFINITY);var o=t.call(this,e)||this;return o.project=r,o.concurrent=n,o.hasCompleted=!1,o.buffer=[],o.active=0,o.index=0,o}return Cn(e,t),e.prototype._next=function(t){this.active<this.concurrent?this._tryNext(t):this.buffer.push(t)},e.prototype._tryNext=function(t){var e,r=this.index++;try{e=this.project(t,r)}catch(t){return void this.destination.error(t)}this.active++,this._innerSub(e,t,r)},e.prototype._innerSub=function(t,e,r){var n=new yo(this,void 0,void 0);this.destination.add(n),Oo(this,t,e,r,n)},e.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()},e.prototype.notifyNext=function(t,e,r,n,o){this.destination.next(e)},e.prototype.notifyComplete=function(t){var e=this.buffer;this.remove(t),this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},e}(mo);function Po(t){return void 0===t&&(t=Number.POSITIVE_INFINITY),function t(e,r,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),"function"==typeof r?function(o){return o.pipe(t(function(t,n){return Co(e(t,n)).pipe(ho(function(e,o){return r(t,e,n,o)}))},n))}:("number"==typeof r&&(n=r),function(t){return t.lift(new wo(e,n))})}(uo,t)}function No(t,e,r){return r?No(t,e).pipe(ho(function(t){return Dn(t)?r.apply(void 0,t):r(t)})):new Yn(function(r){var n,o=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return r.next(1===t.length?t[0]:t)};try{n=t(o)}catch(t){return void r.error(t)}if(wn(e))return function(){return e(o,n)}})}let jo=null;class Do{static getState(){return jo}static getState$(){return ao(jo)}static initState(t){return jo=An.createState(t)}static toggleRecord(){return jo=An.toggleRecord(jo)}static disableRecord(){return jo=An.disableRecord(jo)}static updateCurrentDomain(t){return jo=An.updateCurrentDomain(jo,t)}static updateCurrentURL(t){return jo=An.updateCurrentURL(jo,t)}static updateCanonicalURL(t){return jo=An.updateCanonicalURL(jo,t)}static updateBrowserURL(t){return jo=An.updateBrowserURL(jo,t)}static enableCurrentPageTracked(){return jo=An.enableCurrentPageTracked(jo)}static disableCurrentPageTracked(){return jo=An.disableCurrentPageTracked(jo)}static updateFaviconURL(t){return jo=An.updateFaviconURL(jo,t)}static updateFaviconURLMapItem(t,e){return jo=An.updateFaviconURLMapItem(jo,t,e)}static enableAutoSave(t){return t=t||jo.selection,jo=An.enableAutoSave(jo,t)}static disableAutoSave(){return jo=An.disableAutoSave(jo)}static enablePriceUpdate(t){return jo=An.enablePriceUpdate(jo,t)}static disablePriceUpdate(){return jo=An.disablePriceUpdate(jo)}static setSelectionInfo(t,e,r,n){return jo=An.setSelectionInfo(jo,t,e,r,n)}static setSimilarElementHighlight(t,e){return jo=An.setSimilarElementHighlight(jo,t,e)}static incrementNotificationsCounter(){return jo=An.incrementNotificationsCounter(jo)}static deleteNotificationsItem(t){return jo=An.deleteNotificationsItem(jo,t)}static updateNotificationsItem(t,e){return jo=An.updateNotificationsItem(jo,t,e)}static updateSortItemsBy(t){return jo=An.updateSortItemsBy(jo,t)}static addUndoRemovedItem(t,e,r){return jo=An.addUndoRemovedItem(jo,t,e,r)}static getUndoRemovedItemsHead(){return An.getUndoRemovedItemsHead(jo)}static removeUndoRemovedItem(){return jo=An.removeUndoRemovedItem(jo)}static resetUndoRemovedItems(){return jo=An.resetUndoRemovedItems(jo)}static setUndoRemovedItemsResetTask(t){return jo=An.setUndoRemovedItemsResetTask(jo,t)}static toStorageStateFormat(){return jo=An.toStorageStateFormat(jo)}}var Lo=function(t,e,r,n){for(var o=t.length,i=r+(n?1:-1);n?i--:++i<o;)if(e(t[i],i,t))return i;return-1};var ko=function(t){return t!=t};var xo=function(t,e,r){for(var n=r-1,o=t.length;++n<o;)if(t[n]===e)return n;return-1};var Fo=function(t,e,r){return e==e?xo(t,e,r):Lo(t,ko,r)};var Ho=function(t,e){return!(null==t||!t.length)&&Fo(t,e,0)>-1};var Mo=function(t,e,r){for(var n=-1,o=null==t?0:t.length;++n<o;)if(r(e,t[n]))return!0;return!1};var Jo=function(){},$o=gr&&1/Ke(new gr([,-0]))[1]==1/0?function(t){return new gr(t)}:Jo,Ko=200;var Bo=function(t,e,r){var n=-1,o=Ho,i=t.length,c=!0,s=[],a=s;if(r)c=!1,o=Mo;else if(i>=Ko){var u=e?null:$o(t);if(u)return Ke(u);c=!1,o=xe,a=new Le}else a=e?[]:s;t:for(;++n<i;){var l=t[n],f=e?e(l):l;if(l=r||0!==l?l:0,c&&f==f){for(var p=a.length;p--;)if(a[p]===f)continue t;e&&a.push(f),s.push(l)}else o(a,f,r)||(a!==s&&a.push(f),s.push(l))}return s};var Go=function(t){return t&&t.length?Bo(t):[]};class zo{constructor(t,e,r,n,o,i,c=null,s=e,a,u){this.selection=t,this.price=e,this.currentPrice=s,this.startingPrice=e,this.previousPrice=r||null,this.faviconURL=n,this.faviconAlt=o,this.timestamp=a||(new Date).getTime(),this.lastUpdateTimestamp=u||(new Date).getTime(),this.statuses=i,this.diffPercentage=c}updateCurrentPrice(t){return this.previousPrice=this.currentPrice,this.currentPrice=t,this.updateDiffPercentage()}updateDiffPercentage(){const t=100*Math.abs(this.currentPrice-this.price)/this.price,e=parseFloat(t.toFixed(2));let r=null;e&&((r=this.currentPrice>this.price?+e:-e)>0&&r<1?r=Math.ceil(r):r>-1&&r<0&&(r=Math.floor(r))),this.diffPercentage=r}updateTrackStatus(t,e,r,n=!1){e||(e=[]),r||(r=[]),this.statuses=Go([...this.removeStatuses(r),...e]),this.lastUpdateTimestamp=(new Date).getTime(),n&&(this.startingPrice=this.price),t&&(this.price=t)}removeStatuses(t=[]){return t.length>0&&this.statuses.length>0?this.statuses.filter(e=>!t.includes(e)):this.statuses}isWatched(){return this.statuses.includes(p.WATCHED)}isNotFound(){return this.statuses.includes(p.NOT_FOUND)}hasAcknowledgeDecrease(){return this.statuses.includes(p.ACK_DECREASE)}hasAcknowledgeIncrease(){return this.statuses.includes(p.ACK_INCREASE)}}class Wo{static createItem(t,e,r,n,o,i,c){return new zo(t,e,r,n,o,i,c)}static createItemFromObject({selection:t,price:e,previousPrice:r,faviconURL:n,faviconAlt:o,statuses:i,diffPercentage:c,currentPrice:s,timestamp:a,lastUpdateTimestamp:u}){return new zo(t,e,r,n,o,i,c,s,a,u)}}var Vo={TIME:function({timestamp:t},{timestamp:e}){return t-e},CURRENT_PRICE:function({currentPrice:t},{currentPrice:e}){return t-e}};function Yo(t,e){const r=new XMLHttpRequest;r.onload=function(){const t=function(t){const e=document.createElement("template");return e.innerHTML=t.trim(),e.content}(this.response);e(t)},r.open("GET",t),r.send()}function Xo(t,e){return function(r){return r.lift(new qo(t,e))}}var qo=function(){function t(t,e){this.predicate=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new Qo(t,this.predicate,this.thisArg))},t}(),Qo=function(t){function e(e,r,n){var o=t.call(this,e)||this;return o.predicate=r,o.thisArg=n,o.count=0,o}return Cn(e,t),e.prototype._next=function(t){var e;try{e=this.predicate.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}e&&this.destination.next(t)},e}(Gn);function Zo(t,e,r){return function(n){return n.lift(new ti(t,e,r))}}var ti=function(){function t(t,e,r){this.nextOrObserver=t,this.error=e,this.complete=r}return t.prototype.call=function(t,e){return e.subscribe(new ei(t,this.nextOrObserver,this.error,this.complete))},t}(),ei=function(t){function e(e,r,n,o){var i=t.call(this,e)||this;return i._tapNext=Vn,i._tapError=Vn,i._tapComplete=Vn,i._tapError=n||Vn,i._tapComplete=o||Vn,wn(r)?(i._context=i,i._tapNext=r):r&&(i._context=r,i._tapNext=r.next||Vn,i._tapError=r.error||Vn,i._tapComplete=r.complete||Vn),i}return Cn(e,t),e.prototype._next=function(t){try{this._tapNext.call(this._context,t)}catch(t){return void this.destination.error(t)}this.destination.next(t)},e.prototype._error=function(t){try{this._tapError.call(this._context,t)}catch(t){return void this.destination.error(t)}this.destination.error(t)},e.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(t){return void this.destination.error(t)}return this.destination.complete()},e}(Gn);function ri(t){return function(e){return 0===t?oo():e.lift(new ni(t))}}var ni=function(){function t(t){if(this.total=t,this.total<0)throw new fo}return t.prototype.call=function(t,e){return e.subscribe(new oi(t,this.total))},t}(),oi=function(t){function e(e,r){var n=t.call(this,e)||this;return n.total=r,n.count=0,n}return Cn(e,t),e.prototype._next=function(t){var e=this.total,r=++this.count;r<=e&&(this.destination.next(t),r===e&&(this.destination.complete(),this.unsubscribe()))},e}(Gn);function ii(t,e){return"function"==typeof e?function(r){return r.pipe(ii(function(r,n){return Co(t(r,n)).pipe(ho(function(t,o){return e(r,t,n,o)}))}))}:function(e){return e.lift(new ci(t))}}var ci=function(){function t(t){this.project=t}return t.prototype.call=function(t,e){return e.subscribe(new si(t,this.project))},t}(),si=function(t){function e(e,r){var n=t.call(this,e)||this;return n.project=r,n.index=0,n}return Cn(e,t),e.prototype._next=function(t){var e,r=this.index++;try{e=this.project(t,r)}catch(t){return void this.destination.error(t)}this._innerSub(e,t,r)},e.prototype._innerSub=function(t,e,r){var n=this.innerSubscription;n&&n.unsubscribe();var o=new yo(this,void 0,void 0);this.destination.add(o),this.innerSubscription=Oo(this,t,e,r,o)},e.prototype._complete=function(){var e=this.innerSubscription;e&&!e.closed||t.prototype._complete.call(this),this.unsubscribe()},e.prototype._unsubscribe=function(){this.innerSubscription=null},e.prototype.notifyComplete=function(e){this.destination.remove(e),this.innerSubscription=null,this.isStopped&&t.prototype._complete.call(this)},e.prototype.notifyNext=function(t,e,r,n,o){this.destination.next(e)},e}(mo);function ai(t){chrome.runtime.onInstalled.addListener(t)}function ui(t){chrome.tabs.onUpdated.addListener(t)}function li(t){chrome.tabs.query({active:!0,currentWindow:!0},t)}function fi(){return No(li).pipe(ri(1))}function pi(t){chrome.tabs.onActivated.addListener(t)}function hi(){return No(pi).pipe(ii(()=>fi()),ho(([{id:t,url:e}])=>({id:t,url:e})))}function di(t){chrome.webNavigation.onCompleted.addListener(t)}function bi(t){chrome.webNavigation.onHistoryStateUpdated.addListener(t)}function vi(){const t=fi().pipe(Xo(t=>t.length>0));return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=Number.POSITIVE_INFINITY,n=null,o=t[t.length-1];return io(o)?(n=t.pop(),t.length>1&&"number"==typeof t[t.length-1]&&(r=t.pop())):"number"==typeof o&&(r=t.pop()),null===n&&1===t.length&&t[0]instanceof Yn?t[0]:Po(r)(so(t,n))}(No(di).pipe(ho(({frameId:t})=>t)).pipe(Xo(t=>0===t),ii(()=>t),ho(([{id:t,url:e}])=>({id:t,url:e}))),No(bi).pipe(ii(()=>t),ho(([{id:t,url:e}])=>({id:t,url:e})),ii(t=>(function(t,e){const{url:r}=e;return t().pipe(ho(({browserURL:t})=>t),Xo(t=>void 0!==r&&r!==t),ho(()=>e))})(Do.getState$,t))))}function mi(t){chrome.notifications.onButtonClicked.addListener(t)}const yi=[{[p.DECREASED]:function(t){return t.updateTrackStatus(t.price,null,[p.DECREASED,p.ACK_DECREASE],!0),t},[p.INCREASED]:function(t){return t.updateTrackStatus(t.previousPrice,null,[p.INCREASED,p.ACK_INCREASE],!0),t}},{[p.DECREASED]:gi,[p.INCREASED]:gi}];function gi(t){return t.updateTrackStatus(null,null,p.ALL_STATUSES),t}function _i(){return No(mi).pipe(Zo(t=>console.log("button clicked",t)),ho(([t,e])=>({notificationId:t,buttonIndex:e})),Zo(t=>console.log("button clicked",t))).pipe(ii(({notificationId:t,buttonIndex:e})=>(function(t,e){return t().pipe(ho(t=>t.notifications[e]))})(Do.getState$,t).pipe(ho(t=>({notification:t,buttonIndex:e})))),ii(({notification:t,buttonIndex:e})=>{const{domain:r,url:n,type:o}=t;return function(t){return No(e=>{chrome.storage.local.get([t],e)}).pipe(ri(1),ho(e=>e&&e[t]?JSON.parse(e[t]):{}))}(r).pipe(Xo(t=>t[n]),ho(t=>({domainState:t,domain:r,url:n,type:o,buttonIndex:e})))}),ii(({domainState:t,domain:e,url:r,type:n,buttonIndex:o})=>{const i=Wo.createItemFromObject(t[r]),c=fn(yi,[o,n]);return It(c)?(t[r]=c(i),function(t,e){return No(r=>{chrome.storage.local.set({[t]:JSON.stringify(e)},r)}).pipe(ri(1))}(e,t)):ao()}))}function Si(t,e,r,n,o,i,c,s){chrome.tabs.sendMessage(t,{type:"CONFIRMATION_DISPLAY.CREATE",payload:{elementId:"price-tag--url-confirmation"}},({status:r})=>{if(1===r){const{canonicalURL:r,browserURL:n}=Do.getState(),o=function(t,e,r){return{title:"This website recommends to follow this item through a different URL",message:`<u>${r}</u> says that a more accurate URL for this item would be:<br>`+`<i><a href="${t}" target="_blank"  rel="noopener noreferrer">${t}</a></i><br>`+"If this is correct, we recommend you to follow it.<br><br><b>However</b> you can still opt to choose following the current browser URL:<br>"+`<i><a href="${e}" target="_blank" rel="noopener noreferrer">${e}</a></i><br><br>`+"Since your choice will affect the way items are tracked in this site futurely,<br>please help us helping you by choosing carefully one of the following options:",buttons:["Use recommended URL. Remember this option for this site","Use recommended URL but just this time","It's not correct, use the current browser URL. Remember this option","Don't use recommended URL. Use the current browser URL instead but just this time"]}}(r,n,e);chrome.tabs.sendMessage(t,{type:"CONFIRMATION_DISPLAY.LOAD",payload:o},({status:r,index:n})=>{chrome.tabs.sendMessage(t,{type:"CONFIRMATION_DISPLAY.REMOVE",payload:{elementId:"price-tag--url-confirmation"}});const{canonicalURL:o,browserURL:i}=Do.getState();switch(r){case 1:switch(n){case 0:chrome.storage.local.get([e],t=>{const r=t&&t[e]&&JSON.parse(t[e])||{};r._canUseCanonical=!0,chrome.storage.local.set({[e]:JSON.stringify(r)});const{canonicalURL:n}=Do.getState();Do.updateCurrentURL(n),s(!0,!0)});break;case 1:Do.updateCurrentURL(o),s(!0,!0);break;case 2:chrome.storage.local.get([e],t=>{const r=t&&t[e]&&JSON.parse(t[e])||{};r._canUseCanonical=!1,chrome.storage.local.set({[e]:JSON.stringify(r)});const{browserURL:n}=Do.getState();Do.updateCurrentURL(n),s(!0,!1)});break;case 3:Do.updateCurrentURL(i),s(!0,!1);break;default:s(!1)}break;case 2:default:s(!1)}})}})}function Ei(){Do.disableRecord()}function Ri(t,{status:e,selection:r,price:n,faviconURL:o,faviconAlt:i}={}){if(e>=0){const e=Do.getState();Do.updateFaviconURL(e.faviconURL||o),Do.setSelectionInfo(r,n,e.faviconURL,i),t(!0)}else t(!1)}function Ti({status:t,isHighlighted:e,originalBackgroundColor:r=null}){t>=0&&Do.setSimilarElementHighlight(e,r)}function Ai(t,e,r,n,o,i,c,s){chrome.storage.local.get([t],a=>{const u=a&&a[t]?JSON.parse(a[t]):{};u[e]=Wo.createItem(r,S(n),null,o,i,c),chrome.storage.local.set({[t]:JSON.stringify(u)},()=>{Do.disableAutoSave(),s&&s()})})}function Ii(t,e,r){chrome.storage.local.get([e],n=>{const o=n&&n[e]&&JSON.parse(n[e])||null,i=!o||void 0===o._canUseCanonical;r(i&&!!t.canonicalURL&&t.canonicalURL!==t.browserURL)})}function Oi(){chrome.storage.local.get(null,t=>{for(let e in t)if(t.hasOwnProperty(e)&&R(e)){const r=JSON.parse(t[e]);for(let t in r)if(r.hasOwnProperty(t)&&T(t)){const n=Wo.createItemFromObject(r[t]);if(n.isWatched()){const{price:o,currentPrice:i}=n;Yo(t,c=>{try{let s=null;const{textContent:a}=c.querySelector(r[t].selection);if(a){const c=a.match(y.PRICE);c&&([,s]=c,s=S(s),o?s<i?(n.updateCurrentPrice(s),n.updateTrackStatus(null,[p.DECREASED],[p.INCREASED,p.NOT_FOUND,p.ACK_DECREASE]),r[t]=n,chrome.storage.local.set({[e]:JSON.stringify(r)},()=>{if(s<o&&!n.hasAcknowledgeDecrease()){const{notificationsCounter:r}=Do.getState();Ui(`TRACK.PRICE_UPDATE-${r}`,b,"Lower price!!",`${s} (previous ${o})`,t,t,e,p.DECREASED,{buttons:[{title:`Keep tracking but w/ new price (${s})`},{title:"Stop watching"}]})}})):s>i?(n.updateCurrentPrice(s),n.updateTrackStatus(null,[p.INCREASED],[p.DECREASED,p.NOT_FOUND,p.ACK_INCREASE]),r[t]=n,chrome.storage.local.set({[e]:JSON.stringify(r)},()=>{if(!n.hasAcknowledgeIncrease()){const{notificationsCounter:n}=Do.getState(),o=`TRACK.PRICE_UPDATE-${n}`,i=r[t].price!==r[t].previousPrice?{buttons:[{title:`Increase interest price to the previous (${r[t].previousPrice})`}]}:{buttons:[]};i.buttons.push({title:"Stop watching"}),Ui(o,b,"Price increase",`${s} (previous ${r[t].previousPrice})`,t,t,e,p.INCREASED,i)}})):n.isNotFound()?(n.updateTrackStatus(null,null,[p.NOT_FOUND]),r[t]=n,chrome.storage.local.set({[e]:JSON.stringify(r)})):(n.updateTrackStatus(null,null,[p.NOT_FOUND]),r[t]=n,chrome.storage.local.set({[e]:JSON.stringify(r)},()=>{})):(n.updateTrackStatus(s,[p.FIXED],[p.NOT_FOUND]),r[t]=n,chrome.storage.local.set({[e]:JSON.stringify(r)},()=>{const{notificationsCounter:r}=Do.getState();Ui(`TRACK.PRICE_FIXED-${r}`,m,"Fixed price",`Ermm.. We've just fixed a wrongly set price to ${s}`,t,t,e)})))}n.price&&!s&&(n.isNotFound()||(n.updateTrackStatus(null,[p.NOT_FOUND],[p.DECREASED,p.INCREASED,p.FIXED,p.ACK_DECREASE]),r[t]=n,chrome.storage.local.set({[e]:JSON.stringify(r)},()=>{const{notificationsCounter:r}=Do.getState();Ui(`TRACK.PRICE_NOT_FOUND-${r}`,v,"Price gone",`Price tag no longer found${o?` (previous ${o})`:""}`,t,t,e)})))}catch(i){n.isNotFound()||(console.warn(`Invalid price selection element in\n${t}:\t"${r[t].selection}"`),n.updateTrackStatus(null,[p.NOT_FOUND],[p.DECREASED,p.INCREASED,p.FIXED,p.ACK_DECREASE]),r[t]=n,chrome.storage.local.set({[e]:JSON.stringify(r)},()=>{const{notificationsCounter:r}=Do.getState();Ui(`TRACK.PRICE_NOT_FOUND-${r}`,v,"Price gone",`Price tag no longer found${o?` (previous ${o})`:""}`,t,t,e)}))}})}}}})}function Ci(t,r){chrome.storage.local.get(null,n=>{let o=[];Object.keys(n).forEach(t=>{if(R(t)){const r=n[t],i=JSON.parse(r)||null;if(i){let t=[];Object.keys(i).forEach(r=>{if(function(t){return y.HOSTNAME.test(t)}(r)){const n=Wo.createItemFromObject(i[r]);n.isWatched()&&t.push(e({},n,{url:r}))}}),o=[...o,...t]}}});const i=Vo[t];o.sort(i),r(o)})}function wi(t,e){chrome.notifications.clear(t,r=>{if(r||e){const{notifications:e}=Do.getState(),{domain:r,url:n,type:o}=e[t];chrome.storage.local.get([r],t=>{const e=t&&t[r]?JSON.parse(t[r]):null,i=Wo.createItemFromObject(e[n]);switch(o){case p.DECREASED:i.updateTrackStatus(null,[p.ACK_DECREASE]);break;case p.INCREASED:i.updateTrackStatus(null,[p.ACK_INCREASE])}e[n]=i,chrome.storage.local.set({[r]:JSON.stringify(e)})})}Do.deleteNotificationsItem(t)})}function Ui(t,r,n,o,i="",c,s,a,u={}){const l=e({type:"basic",title:n,message:o,iconUrl:r,contextMessage:i,requireInteraction:!0},u);chrome.notifications.create(t,l,t=>{Do.updateNotificationsItem(t,{url:c,domain:s,type:a})}),Do.incrementNotificationsCounter()}function Pi(t,e,r){chrome.storage.local.get([e],n=>{const o=n&&n[e]?JSON.parse(n[e]):{},i=o[t]&&Wo.createItemFromObject(o[t]),c=o[r]&&Wo.createItemFromObject(o[r]),s=i&&i.isWatched()||c&&c.isWatched();if(o&&!s){const t=function(t){return Rn(t,(t,e)=>T(e))}(o),e=o[t]&&Wo.createItemFromObject(o[t]);e&&e.selection&&Do.enableAutoSave(e.selection)}else Do.disableAutoSave()})}function Ni(t,e,r){chrome.storage.local.get([e],n=>{const o=n&&n[e]?JSON.parse(n[e]):{},i=o[t]&&Wo.createItemFromObject(o[t])||o[r]&&Wo.createItemFromObject(o[r]);i&&i.price!==i.currentPrice?Do.enablePriceUpdate(i.selection):Do.disablePriceUpdate()})}function ji(t,e,r,n){!0===r?(_(),Do.enableCurrentPageTracked()):!1===r?(g(),Do.disableCurrentPageTracked()):r||chrome.storage.local.get([t],r=>{const o=function(t,e){return t&&t[e]&&JSON.parse(t[e])||null}(r,t);if(o){const t=o[e]||o[n],r=t&&Wo.createItemFromObject(t);r&&r.isWatched()?(_(),Do.enableCurrentPageTracked()):(g(),Do.disableCurrentPageTracked())}else g(),Do.disableCurrentPageTracked()})}function Di(t,e,r){const n=A(e);for(let o in t)if(t.hasOwnProperty(o)&&T(o)){if(Wo.createItemFromObject(t[o]).isWatched()){if(e===o)return void r(null);if(A(o)===n)return void r(o)}}r(null)}function Li(t,e,r,n){chrome.storage.local.get([e],o=>{const i=o&&o[e]&&JSON.parse(o[e])||null;i?!0===i._isPathEnoughToTrack?Di(i,r,t=>{t?n(!1,!1):n(!0)}):!1===i._isPathEnoughToTrack?n(!0):Di(i,r,o=>{if(o){const c="price-tag--save-confirmation";chrome.tabs.sendMessage(t,{type:"CONFIRMATION_DISPLAY.CREATE",payload:{elementId:c}},({status:s})=>{if(1===s){const s=function(t,e){return{title:"Item with similar URL to existing one",message:"It appears that the item URL you're trying to save:<br>"+`<i><a href="${t}" target="_blank" rel="noopener noreferrer">${t}</a></i><br>`+"is pretty similar to<br>"+`<i><a href="${e}" target="_blank" rel="noopener noreferrer">${e}</a></i><br><br>`+"Since your choice will affect the way items are tracked in this site futurely,<br>please help us helping you by choosing carefully one of the following options:",buttons:["It's not, save it! Remember this option for this site.","Don't save. Ask me again for items of this site!","Indeed the same item. Don't save! Remember this option for this site. (Use just URL path for accessing items)","For now save this item. Ask me again next time!"]}}(r,o);chrome.tabs.sendMessage(t,{type:"CONFIRMATION_DISPLAY.LOAD",payload:s},({status:r,index:o})=>{switch(chrome.tabs.sendMessage(t,{type:"CONFIRMATION_DISPLAY.REMOVE",payload:{elementId:c}}),r){case 1:switch(o){case 0:i._isPathEnoughToTrack=!1,chrome.storage.local.set({[e]:JSON.stringify(i)}),n(!0);break;case 1:n(!1,!0);break;case 2:i._isPathEnoughToTrack=!0,chrome.storage.local.set({[e]:JSON.stringify(i)}),n(!1,!1);break;case 3:n(!0);break;default:n(!1,!0)}break;case 2:default:n(!1,!0)}})}else n(!1,!0)})}else n(!0)}):n(!0)})}function ki(t,e){const r=e.match(y.CAPTURE.DOMAIN_IN_URL);if(r){const[,t]=r;Do.updateCurrentDomain(t),chrome.storage.local.get([t],r=>{const n=r&&r[t]&&JSON.parse(r[t])||null;if(n&&!1===n._canUseCanonical){if(Do.updateCanonicalURL(null),Do.updateCurrentURL(e),Do.updateBrowserURL(e),!0===n._isPathEnoughToTrack){const t=I(e);t&&(Do.updateCurrentURL(t),Do.updateBrowserURL(t))}const t=Do.getState();Pi(t.currentURL,t.domain,e),Ni(t.currentURL,t.domain,e),ji(t.domain,t.currentURL,null,e)}else Do.updateBrowserURL(e),Yo(e,t=>{const r=function(t){const e=t.querySelector('link[rel="canonical"]');return e&&e.getAttribute("href")}(t);if(E(r))Do.updateCurrentURL(r),Do.updateCanonicalURL(r);else if(Do.updateCanonicalURL(null),Do.updateCurrentURL(e),n&&!0===n._isPathEnoughToTrack){const t=I(e);t&&(Do.updateCurrentURL(t),Do.updateBrowserURL(t))}const o=Do.getState();Pi(o.currentURL,o.domain,e),Ni(o.currentURL,o.domain,e),ji(o.domain,o.currentURL,null,e)})})}}function xi(){No(ai).pipe(ri(1)).subscribe(()=>{console.log("Price tag installed.")}),hi().subscribe(({id:t,url:e})=>{if(e.startsWith("http")){ki(0,e);const r=Do.getState();Do.updateFaviconURL(r._faviconURLMap[t]||null)}else g()}),No(ui).pipe(ho(([t,{favIconUrl:e},{active:r,url:n}])=>({tabId:t,favIconUrl:e,active:r,url:n}))).subscribe(({tabId:t,favIconUrl:e,active:r,url:n})=>{n.startsWith("http")?r&&e&&(Do.updateFaviconURLMapItem(t,e),Do.updateFaviconURL(e)):g()}),vi().subscribe(({id:t,url:e})=>{ki(0,e)}),chrome.runtime.onMessage.addListener(({type:t,payload:o={}},i,a)=>{let u;const{id:l,url:f,sortByType:h}=o,{recordActive:d,autoSaveEnabled:b,isPriceUpdateEnabled:v,currentURL:m,domain:y,_sortItemsBy:g,_undoRemovedItems:_}=Do.getState();switch(t){case"POPUP.STATUS":a({status:1,state:{recordActive:d,autoSaveEnabled:b,isPriceUpdateEnabled:v}});break;case"RECORD.ATTEMPT":const{recordActive:i}=Do.toggleRecord();if(i){const{url:t}=o;chrome.tabs.sendMessage(l,{type:"RECORD.START",payload:{url:t}},function(t,e){const{status:r,selection:n,price:o,faviconURL:i,faviconAlt:c}=e,{currentURL:s,domain:a}=Do.getState();if(r>0){const e=Do.getState();Do.updateFaviconURL(e,e.faviconURL||i),Ii(e,a,e=>{e?Si(t,a,0,0,0,0,0,(e,r)=>{if(e){const e=Do.getState(),i=r?e.canonicalURL:e.browserURL;Li(t,a,i,t=>{if(t){const t=Do.getState();Ai(a,i,n,o,t.faviconURL,c,[p.WATCHED]),ji(a,i,!0)}})}}):Li(t,a,s,t=>{if(t){const t=Do.getState();Ai(a,s,n,o,t.faviconURL,c,[p.WATCHED]),ji(a,s,!0)}})}),Do.disableRecord()}}.bind(null,l))}else chrome.tabs.sendMessage(l,{type:"RECORD.CANCEL"},Ei);a({status:1,state:{recordActive:i}});break;case"AUTO_SAVE.STATUS":return chrome.storage.local.get([y],t=>{const e=t&&t[y]&&JSON.parse(t[y])||null;if(e)if(!0===e._isPathEnoughToTrack)Di(e,m,t=>{if(t)a({status:-1});else{const{selection:t}=Do.getState();chrome.tabs.sendMessage(l,{type:"AUTO_SAVE.CHECK_STATUS",payload:{url:m,selection:t}},Ri.bind(null,a))}});else{const{selection:t}=Do.getState();chrome.tabs.sendMessage(l,{type:"AUTO_SAVE.CHECK_STATUS",payload:{url:m,selection:t}},Ri.bind(null,a))}else{const{selection:t}=Do.getState();chrome.tabs.sendMessage(l,{type:"AUTO_SAVE.CHECK_STATUS",payload:{url:m,selection:t}},Ri.bind(null,a))}}),!0;case"AUTO_SAVE.ATTEMPT":if(b){const{domain:t,currentURL:e,selection:r,price:n,faviconURL:o,faviconAlt:i,originalBackgroundColor:c}=Do.getState();return Ii(Do.getState(),t,s=>{s?Si(l,t,0,0,0,0,0,(e,s)=>{if(e){const{canonicalURL:e,browserURL:u}=Do.getState(),f=s?e:u;Li(l,t,f,(e,s)=>{e?Ai(t,f,r,n,o,i,[p.WATCHED],()=>{chrome.tabs.sendMessage(l,{type:"PRICE_TAG.HIGHLIGHT.STOP",payload:{selection:r,originalBackgroundColor:c}},Ti),ji(t,f,!0),Do.disableAutoSave(),a(!1)}):s||Do.disableAutoSave()})}}):Li(l,t,e,s=>{s&&Ai(t,e,r,n,o,i,[p.WATCHED],()=>{chrome.tabs.sendMessage(l,{type:"PRICE_TAG.HIGHLIGHT.STOP",payload:{selection:r,originalBackgroundColor:c}},Ti),ji(t,e,!0),Do.disableAutoSave(),a(!1)})})}),!0}a(!1);break;case"AUTO_SAVE.HIGHLIGHT.PRE_START":if(b){const{selection:t}=Do.getState();chrome.tabs.sendMessage(l,{type:"PRICE_TAG.HIGHLIGHT.START",payload:{selection:t}},Ti)}break;case"AUTO_SAVE.HIGHLIGHT.PRE_STOP":if(b){const{selection:t,originalBackgroundColor:e}=Do.getState();chrome.tabs.sendMessage(l,{type:"PRICE_TAG.HIGHLIGHT.STOP",payload:{selection:t,originalBackgroundColor:e}},Ti)}break;case"PRICE_UPDATE.STATUS":return chrome.storage.local.get([y],t=>{const{domain:e,currentURL:r,browserURL:n,selection:o}=Do.getState(),i=t&&t[e]?JSON.parse(t[e]):{},c=i[r]&&Wo.createItemFromObject(i[r])||i[n]&&Wo.createItemFromObject(i[n]);c?chrome.tabs.sendMessage(l,{type:"PRICE_UPDATE.CHECK_STATUS",payload:{selection:o}},function(t,e,{status:r,selection:n,price:o,faviconURL:i,faviconAlt:c}={}){if(r>=0){const r=Do.getState();if(Do.updateFaviconURL(r.faviconURL||i),Do.setSelectionInfo(n,o,r.faviconURL,c),S(o)!==e)return void t(!0)}t(!1)}.bind(null,a,c.price)):a(!1)}),!0;case"PRICE_UPDATE.ATTEMPT":if(v){const{selection:t,price:e,originalBackgroundColor:r}=Do.getState(),n=e&&S(e);chrome.storage.local.get([y],e=>{const o=e&&e[y]?JSON.parse(e[y]):{},i=Wo.createItemFromObject(o[m]);i.updateTrackStatus(n,null,[p.INCREASED,p.ACK_INCREASE,p.DECREASED,p.INCREASED,p.DECREASED,p.ACK_DECREASE,p.DECREASED,p.DECREASED,p.NOT_FOUND]),i.updateDiffPercentage(),o[m]=i,chrome.storage.local.set({[y]:JSON.stringify(o)}),chrome.tabs.sendMessage(l,{type:"PRICE_TAG.HIGHLIGHT.STOP",payload:{selection:t,originalBackgroundColor:r}},Ti),Do.disablePriceUpdate(),a(!1)})}return!0;case"PRICE_UPDATE.HIGHLIGHT.PRE_START":if(v){const{selection:t}=Do.getState();chrome.tabs.sendMessage(l,{type:"PRICE_TAG.HIGHLIGHT.START",payload:{selection:t}},Ti)}break;case"PRICE_UPDATE.HIGHLIGHT.PRE_STOP":if(v){const{selection:t,originalBackgroundColor:e}=Do.getState();chrome.tabs.sendMessage(l,{type:"PRICE_TAG.HIGHLIGHT.STOP",payload:{selection:t,originalBackgroundColor:e}},Ti)}break;case"TRACKED_ITEMS.OPEN":const E=Do.updateSortItemsBy(r);u=E._undoRemovedItems.length>0,a({isUndoStatusActive:u});break;case"TRACKED_ITEMS.GET":return Ci(g,a),!0;case"TRACKED_ITEMS.UNFOLLOW":return function(t,r,n){let o=!1;chrome.storage.local.get(null,i=>{Object.keys(i).forEach(a=>{if(R(a)){const u=i[a],l=JSON.parse(u)||null,f=l[t]&&Wo.createItemFromObject(l[t]);if(f){o=!0;const{_undoRemovedItemsResetTask:i}=Do.getState();i&&(clearTimeout(i),Do.setUndoRemovedItemsResetTask(null));const u=e({},f);Do.addUndoRemovedItem(t,u,c),chrome.runtime.sendMessage({type:"TRACKED_ITEMS.UNDO_STATUS",payload:{isUndoStatusActive:!0}});const h=setTimeout(()=>{Do.resetUndoRemovedItems(),chrome.runtime.sendMessage({type:"TRACKED_ITEMS.UNDO_STATUS",payload:{isUndoStatusActive:!1}})},s);Do.setUndoRemovedItemsResetTask(h),f.updateTrackStatus(null,null,[p.WATCHED]),l[t]=f,chrome.storage.local.set({[a]:JSON.stringify(l)},()=>{r===t&&(Pi(t,a),Ni(t,a),ji(a,t,!1)),n(!0)})}}}),o||n(!1)})}(f,m,a),!0;case"TRACKED_ITEMS.CHANGE_SORT":Do.updateSortItemsBy(n[h]);break;case"TRACKED_ITEMS.UNDO_ATTEMPT":if(_.length>0){return function(t,e,r){let n=!1;chrome.storage.local.get(null,o=>{Object.keys(o).forEach(i=>{if(R(i)){const c=o[i],s=JSON.parse(c)||null,a=s[t]&&Wo.createItemFromObject(s[t]);a&&(n=!0,a.updateTrackStatus(null,[p.WATCHED],null),s[t]=a,chrome.storage.local.set({[i]:JSON.stringify(s)},()=>{e===t&&(Pi(t,i),Ni(t,i),ji(i,t,!0)),r(!0)}))}}),n||r(!0)})}(Do.getUndoRemovedItemsHead().url,E.currentURL,t=>{if(t){const{_undoRemovedItems:t}=Do.removeUndoRemovedItem(E);0===t.length?a({isUndoStatusActive:!1}):a({isUndoStatusActive:!0})}}),!0}a({isUndoStatusActive:!1})}}),chrome.notifications.onClicked.addListener(t=>{const{notifications:e}=Do.getState();chrome.tabs.create({url:e[t].url}),wi(t)}),_i().subscribe(),chrome.notifications.onClosed.addListener(wi)}Do.initState(r),In(),setInterval(In,i),Oi(),setInterval(Oi,o),xi()}();
