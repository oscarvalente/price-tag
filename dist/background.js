!function(){"use strict";function e(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function t(t){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{},r=Object.keys(o);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(o).filter(function(e){return Object.getOwnPropertyDescriptor(o,e).enumerable}))),r.forEach(function(n){e(t,n,o[n])})}return t}const n="TIME";var o=Object.freeze({TIME:n,CURRENT_PRICE:"CURRENT_PRICE"}),r={MAX_UNDO_REMOVED_ITEMS:10,UNDO_REMOVED_ITEMS_TIMEOUT:12e4};var s={TIME:function({timestamp:e},{timestamp:t}){return e-t},CURRENT_PRICE:function({currentPrice:e},{currentPrice:t}){return e-t}};function i(e,n){return t({},e,{_undoRemovedItemsResetTask:n})}let c={recordActive:!1,notifications:{},notificationsCounter:0,autoSaveEnabled:!1,isPriceUpdateEnabled:!1,selection:null,isSimilarElementHighlighted:!1,originalBackgroundColor:null,isCurrentPageTracked:!1,faviconURL:null,_faviconURLMap:{},currentURL:null,canonicalURL:null,browserURL:null,domain:null,_sortItemsBy:n,_undoRemovedItems:[],_undoRemovedItemsResetTask:null};const a="assets/icon_48.png",l="assets/icon_active_48.png",u="Price Tag",E="Price Tag - This item is being tracked",f=18e4,d=12e4,m={PRICE_UPDATE:"./assets/time-is-money.svg",PRICE_NOT_FOUND:"./assets/time.svg",PRICE_FIX:"./assets/coin.svg"},R={PRICE:/((?:\d+[.,])?\d+(?:[.,]\d+)?)/,HOSTNAME:/https?:\/\/([\w.]+)\/*/,DOMAIN:/^([\w-]+\.)+[\w-]+\w$/,URL:/^https?:\/\/([\w-]+\.)+[\w-]+\w(\/[\w-=.]+)+\/?(\?([\w]+=?[\w-%!@()\\["#\]]+&?)*)?/,CAPTURE:{DOMAIN_IN_URL:/https?:\/\/([\w.]+)\/*/,HOSTNAME_AND_PATH:/^https?:\/\/((?:[\w-]+\.)+[\w-]+\w(?:\/[\w-=.]+)+\/?)/,PROTOCOL_HOSTNAME_AND_PATH:/^(https?:\/\/(?:[\w-]+\.)+[\w-]+\w(?:\/[\w-=.]+)+\/?)/}},g={WATCHED:"WATCHED",NOT_FOUND:"NOT_FOUND",INCREASED:"INCREASED",DECREASED:"DECREASED",ACK_DECREASE:"ACK_DECREASE",ACK_INCREASE:"ACK_INCREASE",FIXED:"FIXED"},h=Object.values(g);function T(e,n){return A(t({},e,{previousPrice:e.currentPrice,currentPrice:n}))}function A(e){const t=100*Math.abs(e.currentPrice-e.price)/e.price,n=parseFloat(t.toFixed(2));let o=null;return n&&((o=e.currentPrice>e.price?+n:-n)>0&&o<1?o=Math.ceil(o):o>-1&&o<0&&(o=Math.floor(o))),e.diffPercentage=o,e}function p(e,n,o,r,s=!1){o||(o=[]),r||(r=[]);const i=(c=[...function(e,t=[]){return t.length>0&&e.statuses.length>0?e.statuses.filter(e=>!t.includes(e)):e.statuses}(e,r),...o],Array.from(new Set(c)));var c;const a=t({},e,{statuses:i,lastUpdateTimestamp:(new Date).getTime()});return s&&(a.startingPrice=e.price),n&&(a.price=n),a}function S(e){return e.statuses.includes(g.WATCHED)}function C(e){return e.statuses.includes(g.NOT_FOUND)}function O(e){return e.statuses.includes(g.ACK_DECREASE)}function I(e){return e.statuses.includes(g.ACK_INCREASE)}function _(e,t,n,o,r,s,i,a){chrome.tabs.sendMessage(e,{type:"CONFIRMATION_DISPLAY.CREATE",payload:{elementId:"price-tag--url-confirmation"}},({status:n})=>{if(1===n){const n=function(e,t,n){return{title:"This website recommends to follow this item through a different URL",message:`<u>${n}</u> says that a more accurate URL for this item would be:<br>`+`<i><a href="${e}" target="_blank"  rel="noopener noreferrer">${e}</a></i><br>`+"If this is correct, we recommend you to follow it.<br><br><b>However</b> you can still opt to choose following the current browser URL:<br>"+`<i><a href="${t}" target="_blank" rel="noopener noreferrer">${t}</a></i><br><br>`+"Since your choice will affect the way items are tracked in this site futurely,<br>please help us helping you by choosing carefully one of the following options:",buttons:["Use recommended URL. Remember this option for this site","Use recommended URL but just this time","It's not correct, use the current browser URL. Remember this option","Don't use recommended URL. Use the current browser URL instead but just this time"]}}(c.canonicalURL,c.browserURL,t);chrome.tabs.sendMessage(e,{type:"CONFIRMATION_DISPLAY.LOAD",payload:n},({status:n,index:o})=>{switch(chrome.tabs.sendMessage(e,{type:"CONFIRMATION_DISPLAY.REMOVE",payload:{elementId:"price-tag--url-confirmation"}}),n){case 1:switch(o){case 0:chrome.storage.local.get([t],e=>{const n=e&&e[t]&&JSON.parse(e[t])||{};n._canUseCanonical=!0,chrome.storage.local.set({[t]:JSON.stringify(n)}),c=L(c,c.canonicalURL),a(!0,!0)});break;case 1:c=L(c,c.canonicalURL),a(!0,!0);break;case 2:chrome.storage.local.get([t],e=>{const n=e&&e[t]&&JSON.parse(e[t])||{};n._canUseCanonical=!1,chrome.storage.local.set({[t]:JSON.stringify(n)}),c=L(c,c.browserURL),a(!0,!1)});break;case 3:c=L(c,c.browserURL),a(!0,!1);break;default:a(!1)}break;case 2:default:a(!1)}})}})}function U(){c=P(c)}function b(e,{status:t,selection:n,price:o,faviconURL:r,faviconAlt:s}={}){t>=0?(c=j(c=k(c,c.faviconURL||r),n,o,c.faviconURL,s),e(!0)):e(!1)}function N({status:e,isHighlighted:n,originalBackgroundColor:o=null}){e>=0&&(c=function(e,n,o){return t({},e,{isSimilarElementHighlighted:n,originalBackgroundColor:o})}(c,n,o))}function D(e,t,n,o,r,s,i,a){chrome.storage.local.get([e],l=>{const u=l&&l[e]?JSON.parse(l[e]):{};u[t]=function(e,t,n,o,r,s){n||(n=null);const i=q(t);return{selection:e,price:i,currentPrice:i,startingPrice:i,previousPrice:n,faviconURL:o,faviconAlt:r,timestamp:(new Date).getTime(),statuses:s}}(n,o,void 0,r,s,i),chrome.storage.local.set({[e]:JSON.stringify(u)},()=>{c=K(c),a&&a()})})}function P(e){return t({},e,{recordActive:!1})}function y(e){return t({},e,{isCurrentPageTracked:!1})}function v(e){return t({},e,{isCurrentPageTracked:!0})}function L(e,n){return t({},e,{currentURL:n})}function w(e,n){return t({},e,{canonicalURL:n})}function M(e,n){return t({},e,{browserURL:n})}function k(e,n){return t({},e,{faviconURL:n})}function H(e,n){return t({},e,{_sortItemsBy:n})}function J(e,t,n){chrome.storage.local.get([t],o=>{const r=o&&o[t]&&JSON.parse(o[t])||null,s=!r||void 0===r._canUseCanonical;n(s&&!!e.canonicalURL&&e.canonicalURL!==e.browserURL)})}function F(){chrome.browserAction.setTitle({title:u}),chrome.browserAction.setIcon({path:a})}function G(){chrome.browserAction.setTitle({title:E}),chrome.browserAction.setIcon({path:l})}function K(e){return t({},e,{autoSaveEnabled:!1})}function $(e){return t({},e,{isPriceUpdateEnabled:!1})}function j(e,n,o,r,s){return t({},e,{selection:n,price:o,faviconURL:r,faviconAlt:s})}function B(){chrome.storage.local.get(null,e=>{for(let t in e)if(e.hasOwnProperty(t)&&Q(t)){const n=JSON.parse(e[t]);for(let e in n)if(n.hasOwnProperty(e)&&Z(e)&&S(n[e])){const o=new XMLHttpRequest,{price:r,currentPrice:s}=n[e];o.onload=function(){const o=Y(this.response);try{let i=null;const{textContent:a}=o.querySelector(n[e].selection);if(a){const o=a.match(R.PRICE);if(o)if([,i]=o,i=q(i),r)if(i<s){const o=T(n[e],i);n[e]=p(o,null,[g.DECREASED],[g.INCREASED,g.NOT_FOUND,g.ACK_DECREASE]),chrome.storage.local.set({[t]:JSON.stringify(n)},()=>{if(i<r&&!O(n[e])){x(`TRACK.PRICE_UPDATE-${c.notificationsCounter}`,m.PRICE_UPDATE,"Lower price!!",`${i} (previous ${r})`,e,e,t,g.DECREASED,{buttons:[{title:`Keep tracking but w/ new price (${i})`},{title:"Stop watching"}]})}})}else if(i>s){const o=T(n[e],i);n[e]=p(o,null,[g.INCREASED],[g.DECREASED,g.NOT_FOUND,g.ACK_INCREASE]),chrome.storage.local.set({[t]:JSON.stringify(n)},()=>{if(!I(n[e])){const o=`TRACK.PRICE_UPDATE-${c.notificationsCounter}`,r=n[e].price!==n[e].previousPrice?{buttons:[{title:`Increase interest price to the previous (${n[e].previousPrice})`}]}:{buttons:[]};r.buttons.push({title:"Stop watching"}),x(o,m.PRICE_UPDATE,"Price increase",`${i} (previous ${n[e].previousPrice})`,e,e,t,g.INCREASED,r)}})}else C(n[e])?(n[e]=p(n[e],null,null,[g.NOT_FOUND]),chrome.storage.local.set({[t]:JSON.stringify(n)})):(n[e]=p(n[e],null,null,[g.NOT_FOUND]),chrome.storage.local.set({[t]:JSON.stringify(n)},()=>{}));else n[e]=p(n[e],i,[g.FIXED],[g.NOT_FOUND]),chrome.storage.local.set({[t]:JSON.stringify(n)},()=>{x(`TRACK.PRICE_FIXED-${c.notificationsCounter}`,m.PRICE_FIX,"Fixed price",`Ermm.. We've just fixed a wrongly set price to ${i}`,e,e,t)})}n[e].price&&!i&&(C(n[e])||(n[e]=p(n[e],null,[g.NOT_FOUND],[g.DECREASED,g.INCREASED,g.FIXED,g.ACK_DECREASE]),chrome.storage.local.set({[t]:JSON.stringify(n)},()=>{const n=`TRACK.PRICE_NOT_FOUND-${c.notificationsCounter}`,o=r?` (previous ${r})`:"";x(n,m.PRICE_NOT_FOUND,"Price gone",`Price tag no longer found${o}`,e,e,t)})))}catch(o){C(n[e])||(console.warn(`Invalid price selection element in\n${e}:\t"${n[e].selection}"`),n[e]=p(n[e],null,[g.NOT_FOUND],[g.DECREASED,g.INCREASED,g.FIXED,g.ACK_DECREASE]),chrome.storage.local.set({[t]:JSON.stringify(n)},()=>{const n=`TRACK.PRICE_NOT_FOUND-${c.notificationsCounter}`,o=r?` (previous ${r})`:"";x(n,m.PRICE_NOT_FOUND,"Price gone",`Price tag no longer found${o}`,e,e,t)}))}},o.open("GET",e),o.send()}}})}function W(e,n){chrome.storage.local.get(null,o=>{let r=[];Object.keys(o).forEach(e=>{if(Q(e)){const n=o[e],s=JSON.parse(n)||null;if(s){let e=[];Object.keys(s).forEach(n=>{if(function(e){return R.HOSTNAME.test(e)}(n)&&S(s[n])){const o=t({},s[n],{url:n});e.push(o)}}),r=[...r,...e]}}});const i=s[e];r.sort(i),n(r)})}function V(e,n,o){let s=!1;chrome.storage.local.get(null,a=>{Object.keys(a).forEach(l=>{if(Q(l)){const u=a[l],E=JSON.parse(u)||null;if(E[e]){s=!0,c._undoRemovedItemsResetTask&&(clearTimeout(c._undoRemovedItemsResetTask),c=i(c,null));const a=t({},E[e]);c=function(e,n,{timestamp:o},r){const s={url:n,timestamp:o},i=[...e._undoRemovedItems];return i.unshift(s),t({},e,{_undoRemovedItems:i.slice(0,r)})}(c,e,a,r.MAX_UNDO_REMOVED_ITEMS),chrome.runtime.sendMessage({type:"TRACKED_ITEMS.UNDO_STATUS",payload:{isUndoStatusActive:!0}});const u=setTimeout(()=>{c=function(e){return t({},e,{_undoRemovedItems:[]})}(c),chrome.runtime.sendMessage({type:"TRACKED_ITEMS.UNDO_STATUS",payload:{isUndoStatusActive:!1}})},r.UNDO_REMOVED_ITEMS_TIMEOUT);c=i(c,u),E[e]=p(E[e],null,null,[g.WATCHED]),chrome.storage.local.set({[l]:JSON.stringify(E)},()=>{n===e&&(ee(e,l),te(e,l),ne(l,e,!1)),o(!0)})}}}),s||o(!1)})}function X(e,n){chrome.notifications.clear(e,o=>{if(o||n){const{domain:t,url:n,type:o}=c.notifications[e];chrome.storage.local.get([t],e=>{const r=e&&e[t]?JSON.parse(e[t]):null;switch(o){case g.DECREASED:r[n]=p(r[n],null,[g.ACK_DECREASE]);break;case g.INCREASED:r[n]=p(r[n],null,[g.ACK_INCREASE])}chrome.storage.local.set({[t]:JSON.stringify(r)})})}c=function(e,n){const o=t({},e);return delete o.notifications[n],o}(c,e)})}function x(e,n,o,r,s="",i,a,l,u={}){const E=t({type:"basic",title:o,message:r,iconUrl:n,contextMessage:s,requireInteraction:!0},u);var f;chrome.notifications.create(e,E,e=>{c=function(e,n,o){return t({},e,{notifications:t({},e.notifications,{[n]:o})})}(c,e,{url:i,domain:a,type:l})}),c=t({},f=c,{notificationsCounter:f.notificationsCounter+1})}function q(e){const t=parseFloat(e.replace(",",".")).toFixed(2);return parseFloat(t)}function Y(e){var t=document.createElement("template");return e=e.trim(),t.innerHTML=e,t.content}function z(e){return e&&(t=e,R.CAPTURE.HOSTNAME_AND_PATH.test(t));var t}function Q(e){return R.DOMAIN.test(e)}function Z(e){return R.URL.test(e)}function ee(e,n,o){chrome.storage.local.get([n],r=>{const s=r&&r[n]?JSON.parse(r[n]):{},i=s[e]&&S(s[e])||s[o]&&S(s[o]);if(s&&!i){const e=Object.keys(s)[0];s[e]&&s[e].selection&&(c=function(e,n){return t({},e,{autoSaveEnabled:!0,selection:n=n||e.selection})}(c,s[e].selection))}else c=K(c)})}function te(e,n){chrome.storage.local.get([n],o=>{const r=(o&&o[n]?JSON.parse(o[n]):{})[e],s=r&&r.price!==r.currentPrice;c=s?function(e,n){return t({},e,{isPriceUpdateEnabled:!0,selection:n})}(c,r.selection):$(c)})}function ne(e,t,n,o){!0===n?(G(),c=v(c)):!1===n?(F(),c=y(c)):n||chrome.storage.local.get([e],n=>{const r=function(e,t){return e&&e[t]&&JSON.parse(e[t])||null}(n,e);if(r){const e=r[t]||r[o];e&&S(e)?(G(),c=v(c)):(F(),c=y(c))}else F(),c=y(c)})}function oe(e){const t=e.match(R.CAPTURE.HOSTNAME_AND_PATH);let n=null;return t&&([,n]=t),n}function re(e){const t=e.match(R.CAPTURE.PROTOCOL_HOSTNAME_AND_PATH);let n=null;return t&&([,n]=t),n}function se(e,t,n){const o=oe(t);for(let r in e)if(e.hasOwnProperty(r)&&Z(r)&&S(e[r])){if(t===r)return void n(null);if(oe(r)===o)return void n(r)}n(null)}function ie(e,t,n,o){chrome.storage.local.get([t],r=>{const s=r&&r[t]&&JSON.parse(r[t])||null;s?!0===s._isPathEnoughToTrack?se(s,n,e=>{e?o(!1,!1):o(!0)}):!1===s._isPathEnoughToTrack?o(!0):se(s,n,r=>{if(r){const i="price-tag--save-confirmation";chrome.tabs.sendMessage(e,{type:"CONFIRMATION_DISPLAY.CREATE",payload:{elementId:i}},({status:c})=>{if(1===c){const c=function(e,t){return{title:"Item with similar URL to existing one",message:"It appears that the item URL you're trying to save:<br>"+`<i><a href="${e}" target="_blank" rel="noopener noreferrer">${e}</a></i><br>`+"is pretty similar to<br>"+`<i><a href="${t}" target="_blank" rel="noopener noreferrer">${t}</a></i><br><br>`+"Since your choice will affect the way items are tracked in this site futurely,<br>please help us helping you by choosing carefully one of the following options:",buttons:["It's not, save it! Remember this option for this site.","Don't save. Ask me again for items of this site!","Indeed the same item. Don't save! Remember this option for this site. (Use just URL path for accessing items)","For now save this item. Ask me again next time!"]}}(n,r);chrome.tabs.sendMessage(e,{type:"CONFIRMATION_DISPLAY.LOAD",payload:c},({status:n,index:r})=>{switch(chrome.tabs.sendMessage(e,{type:"CONFIRMATION_DISPLAY.REMOVE",payload:{elementId:i}}),n){case 1:switch(r){case 0:s._isPathEnoughToTrack=!1,chrome.storage.local.set({[t]:JSON.stringify(s)}),o(!0);break;case 1:o(!1,!0);break;case 2:s._isPathEnoughToTrack=!0,chrome.storage.local.set({[t]:JSON.stringify(s)}),o(!1,!1);break;case 3:o(!0);break;default:o(!1,!0)}break;case 2:default:o(!1,!0)}})}else o(!1,!0)})}else o(!0)}):o(!0)})}function ce(e,n){const o=n.match(R.CAPTURE.DOMAIN_IN_URL);if(o){const[,e]=o;c=function(e,n){return t({},e,{domain:n})}(c,e),chrome.storage.local.get([e],t=>{const o=t&&t[e]&&JSON.parse(t[e])||null;if(o&&!1===o._canUseCanonical){if(c=M(c=L(c=w(c,null),n),n),!0===o._isPathEnoughToTrack){const e=re(n);e&&(c=M(c=L(c,e),e))}ee(c.currentURL,c.domain,n),te(c.currentURL,c.domain),ne(c.domain,c.currentURL,null,n)}else c=M(c,n),function(e,t){const n=new XMLHttpRequest;n.onload=function(){const e=Y(this.response);t(e)},n.open("GET",e),n.send()}(n,e=>{const t=function(e){const t=e.querySelector('link[rel="canonical"]');return t&&t.getAttribute("href")}(e);if(z(t))c=w(c=L(c,t),t);else if(c=L(c=w(c,null),n),o&&!0===o._isPathEnoughToTrack){const e=re(n);e&&(c=M(c=L(c,e),e))}ee(c.currentURL,c.domain,n),te(c.currentURL,c.domain),ne(c.domain,c.currentURL,null,n)})})}}function ae(){chrome.runtime.onInstalled.addListener(()=>{console.log("Price tag installed.")}),chrome.tabs.onActivated.addListener(()=>{chrome.tabs.query({active:!0,currentWindow:!0},([{id:e,url:t}])=>{t.startsWith("http")?(ce(0,t),c=k(c,c._faviconURLMap[e]||null)):F()})}),chrome.tabs.onUpdated.addListener((e,{favIconUrl:n},{active:o,url:r})=>{r.startsWith("http")?o&&n&&(c=k(c=function(e,n,o){return t({},e,{_faviconURLMap:t({},e._faviconURLMap,{[n]:o})})}(c,e,n),n)):F()}),chrome.webNavigation.onCompleted.addListener(({frameId:e})=>{0===e&&chrome.tabs.query({active:!0,currentWindow:!0},e=>{if(e.length>0){const[{id:t,url:n}]=e;ce(0,n)}})}),chrome.webNavigation.onHistoryStateUpdated.addListener(()=>{chrome.tabs.query({active:!0,currentWindow:!0},e=>{if(e.length>0){const[{id:t,url:n}]=e;void 0!==n&&n!==c.browserURL&&ce(0,n)}})}),chrome.runtime.onMessage.addListener(({type:e,payload:r={}},s,i)=>{let a;const{id:l,url:u,sortByType:E}=r,{recordActive:f,autoSaveEnabled:d,isPriceUpdateEnabled:m,currentURL:R,domain:h}=c;switch(e){case"POPUP.STATUS":i({status:1,state:{recordActive:f,autoSaveEnabled:d,isPriceUpdateEnabled:m}});break;case"RECORD.ATTEMPT":if((c=function(e){return t({},e,{recordActive:!e.recordActive})}(c)).recordActive){const{url:e}=r;chrome.tabs.sendMessage(l,{type:"RECORD.START",payload:{url:e}},function(e,t){const{status:n,selection:o,price:r,faviconURL:s,faviconAlt:i}=t,{currentURL:a,domain:l}=c;n>0&&(J(c=k(c,c.faviconURL||s),l,t=>{t?_(e,l,0,0,0,0,0,(t,n)=>{if(t){const t=n?c.canonicalURL:c.browserURL;ie(e,l,t,e=>{e&&(D(l,t,o,r,c.faviconURL,i,[g.WATCHED]),ne(l,t,!0))})}}):ie(e,l,a,e=>{e&&(D(l,a,o,r,c.faviconURL,i,[g.WATCHED]),ne(l,a,!0))})}),c=P(c))}.bind(null,l))}else chrome.tabs.sendMessage(l,{type:"RECORD.CANCEL"},U);i({status:1,state:{recordActive:c.recordActive}});break;case"AUTO_SAVE.STATUS":return chrome.storage.local.get([h],e=>{const t=e&&e[h]&&JSON.parse(e[h])||null;t&&!0===t._isPathEnoughToTrack?se(t,R,e=>{e?i({status:-1}):chrome.tabs.sendMessage(l,{type:"AUTO_SAVE.CHECK_STATUS",payload:{url:R,selection:c.selection}},b.bind(null,i))}):chrome.tabs.sendMessage(l,{type:"AUTO_SAVE.CHECK_STATUS",payload:{url:R,selection:c.selection}},b.bind(null,i))}),!0;case"AUTO_SAVE.ATTEMPT":if(c.autoSaveEnabled){const{domain:e,currentURL:t,selection:n,price:o,faviconURL:r,faviconAlt:s,originalBackgroundColor:a}=c;return J(c,e,u=>{u?_(l,e,0,0,0,0,0,(t,u)=>{if(t){const t=u?c.canonicalURL:c.browserURL;ie(l,e,t,(u,E)=>{u?D(e,t,n,o,r,s,[g.WATCHED],()=>{chrome.tabs.sendMessage(l,{type:"PRICE_TAG.HIGHLIGHT.STOP",payload:{selection:n,originalBackgroundColor:a}},N),ne(e,t,!0),c=K(c),i(!1)}):E||(c=K(c))})}}):ie(l,e,t,u=>{u&&D(e,t,n,o,r,s,[g.WATCHED],()=>{chrome.tabs.sendMessage(l,{type:"PRICE_TAG.HIGHLIGHT.STOP",payload:{selection:n,originalBackgroundColor:a}},N),ne(e,t,!0),c=K(c),i(!1)})})}),!0}i(!1);break;case"AUTO_SAVE.HIGHLIGHT.PRE_START":if(c.autoSaveEnabled){const{selection:e}=c;chrome.tabs.sendMessage(l,{type:"PRICE_TAG.HIGHLIGHT.START",payload:{selection:e}},N)}break;case"AUTO_SAVE.HIGHLIGHT.PRE_STOP":if(c.autoSaveEnabled){const{selection:e,originalBackgroundColor:t}=c;chrome.tabs.sendMessage(l,{type:"PRICE_TAG.HIGHLIGHT.STOP",payload:{selection:e,originalBackgroundColor:t}},N)}break;case"PRICE_UPDATE.STATUS":return chrome.storage.local.get([c.domain],e=>{const t=(e&&e[c.domain]?JSON.parse(e[c.domain]):{})[c.currentURL];t?chrome.tabs.sendMessage(l,{type:"PRICE_UPDATE.CHECK_STATUS",payload:{selection:c.selection}},function(e,t,{status:n,selection:o,price:r,faviconURL:s,faviconAlt:i}={}){n>=0&&(c=j(c=k(c,c.faviconURL||s),o,r,c.faviconURL,i),q(r)!==t)?e(!0):e(!1)}.bind(null,i,t.price)):i(!1)}),!0;case"PRICE_UPDATE.ATTEMPT":if(c.isPriceUpdateEnabled){const{domain:e,currentURL:t,selection:n,price:o,originalBackgroundColor:r}=c,s=o&&q(o);chrome.storage.local.get([e],o=>{const a=o&&o[e]?JSON.parse(o[e]):{};a[t]=p(a[t],s,null,[g.INCREASED,g.ACK_INCREASE,g.DECREASED,g.INCREASED,g.DECREASED,g.ACK_DECREASE,g.DECREASED,g.DECREASED,g.NOT_FOUND]),a[t]=A(a[t]),chrome.storage.local.set({[e]:JSON.stringify(a)}),chrome.tabs.sendMessage(l,{type:"PRICE_TAG.HIGHLIGHT.STOP",payload:{selection:n,originalBackgroundColor:r}},N),c=$(c),i(!1)})}return!0;case"PRICE_UPDATE.HIGHLIGHT.PRE_START":if(c.isPriceUpdateEnabled){const{selection:e}=c;chrome.tabs.sendMessage(l,{type:"PRICE_TAG.HIGHLIGHT.START",payload:{selection:e}},N)}break;case"PRICE_UPDATE.HIGHLIGHT.PRE_STOP":if(c.isPriceUpdateEnabled){const{selection:e,originalBackgroundColor:t}=c;chrome.tabs.sendMessage(l,{type:"PRICE_TAG.HIGHLIGHT.STOP",payload:{selection:e,originalBackgroundColor:t}},N)}break;case"TRACKED_ITEMS.OPEN":a=(c=H(c,n))._undoRemovedItems.length>0,i({isUndoStatusActive:a});break;case"TRACKED_ITEMS.GET":return W(c._sortItemsBy,i),!0;case"TRACKED_ITEMS.UNFOLLOW":return V(u,c.currentURL,i),!0;case"TRACKED_ITEMS.CHANGE_SORT":c=H(c,o[E]);break;case"TRACKED_ITEMS.UNDO_ATTEMPT":if(c._undoRemovedItems.length>0){return function(e,t,n){let o=!1;chrome.storage.local.get(null,r=>{Object.keys(r).forEach(s=>{if(Q(s)){const i=r[s],c=JSON.parse(i)||null;c[e]&&(o=!0,c[e]=p(c[e],null,[g.WATCHED],null),chrome.storage.local.set({[s]:JSON.stringify(c)},()=>{t===e&&(ee(e,s),te(e,s),ne(s,e,!0)),n(!0)}))}}),o||n(!0)})}(function(e){return e._undoRemovedItems[0]}(c).url,c.currentURL,e=>{e&&(0===(c=function(e){const n=[...e._undoRemovedItems];return n.shift(),t({},e,{_undoRemovedItems:n})}(c))._undoRemovedItems.length?i({isUndoStatusActive:!1}):i({isUndoStatusActive:!0}))}),!0}i({isUndoStatusActive:!1})}}),chrome.notifications.onClicked.addListener(e=>{chrome.tabs.create({url:c.notifications[e].url}),X(e)}),chrome.notifications.onButtonClicked.addListener((e,t)=>{const{domain:n,url:o,type:r}=c.notifications[e];switch(t){case 0:switch(r){case g.DECREASED:chrome.storage.local.get([n],e=>{const t=e&&e[n]?JSON.parse(e[n]):{};if(t[o]){const{price:e}=t[o];t[o]=p(t[o],e,null,[g.DECREASED,g.ACK_DECREASE],!0),chrome.storage.local.set({[n]:JSON.stringify(t)})}});break;case g.INCREASED:chrome.storage.local.get([n],e=>{const t=e&&e[n]?JSON.parse(e[n]):{};if(t[o]){const{previousPrice:e}=t[o];t[o]=p(t[o],e,null,[g.INCREASED,g.ACK_INCREASE],!0),chrome.storage.local.set({[n]:JSON.stringify(t)})}})}break;case 1:switch(r){case g.INCREASED:chrome.storage.local.get([n],e=>{const t=e&&e[n]?JSON.parse(e[n]):{};t[o]&&(t[o]=p(t[o],null,null,h),chrome.storage.local.set({[n]:JSON.stringify(t)}))})}}}),chrome.notifications.onClosed.addListener(X)}function le(e){let n={};for(let o in e)if(e.hasOwnProperty(o)&&Q(o)&&e[o]){n=t({},n,{[o]:JSON.parse(e[o])})}return n}function ue(e){return Object.keys(e).reduce((n,o)=>t({},n,{[o]:JSON.stringify(e[o])}),{})}function Ee(){chrome.storage.local.get(null,e=>{const t=le(e);chrome.storage.sync.get(null,e=>{const n=le(e),o=JSON.parse(JSON.stringify(t));for(let e in n)if(n.hasOwnProperty(e)&&Q(e)){const t=n[e];if(o[e]){for(let n in t)if(t.hasOwnProperty(n)){const r=t[n];o[e][n]?r.lastUpdateTimestamp>o[e][n].lastUpdateTimestamp&&(o[e][n]=JSON.parse(JSON.stringify(r))):o[e][n]=Object.assign({},r)}}else o[e]=JSON.parse(JSON.stringify(t))}chrome.storage.local.set(ue(o)),chrome.storage.sync.set(ue(o))})})}Ee(),setInterval(Ee,d),B(),setInterval(B,f),ae()}();
