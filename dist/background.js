!function(){"use strict";function e(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function t(t){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(r){e(t,r,n[r])})}return t}var r="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function n(e,t){return e(t={exports:{}},t.exports),t.exports}var o="object"==typeof r&&r&&r.Object===Object&&r,a="object"==typeof self&&self&&self.Object===Object&&self,i=o||a||Function("return this")(),c=i.Symbol,s=Object.prototype,u=s.hasOwnProperty,l=s.toString,f=c?c.toStringTag:void 0;var d=function(e){var t=u.call(e,f),r=e[f];try{e[f]=void 0}catch(e){}var n=l.call(e);return t?e[f]=r:delete e[f],n},p=Object.prototype.toString;var h=function(e){return p.call(e)},v="[object Null]",m="[object Undefined]",g=c?c.toStringTag:void 0;var b=function(e){return null==e?void 0===e?m:v:g&&g in Object(e)?d(e):h(e)};var E=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)},_="[object AsyncFunction]",R="[object Function]",y="[object GeneratorFunction]",A="[object Proxy]";var S,T=function(e){if(!E(e))return!1;var t=b(e);return t==R||t==y||t==_||t==A},O=i["__core-js_shared__"],C=(S=/[^.]+$/.exec(O&&O.keys&&O.keys.IE_PROTO||""))?"Symbol(src)_1."+S:"";var U=function(e){return!!C&&C in e},I=Function.prototype.toString;var P=function(e){if(null!=e){try{return I.call(e)}catch(e){}try{return e+""}catch(e){}}return""},N=/^\[object .+?Constructor\]$/,D=Function.prototype,w=Object.prototype,L=D.toString,j=w.hasOwnProperty,k=RegExp("^"+L.call(j).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var M=function(e){return!(!E(e)||U(e))&&(T(e)?k:N).test(P(e))};var F=function(e,t){return null==e?void 0:e[t]};var H=function(e,t){var r=F(e,t);return M(r)?r:void 0},J=H(Object,"create");var $=function(){this.__data__=J?J(null):{},this.size=0};var K=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},G="__lodash_hash_undefined__",B=Object.prototype.hasOwnProperty;var W=function(e){var t=this.__data__;if(J){var r=t[e];return r===G?void 0:r}return B.call(t,e)?t[e]:void 0},z=Object.prototype.hasOwnProperty;var x=function(e){var t=this.__data__;return J?void 0!==t[e]:z.call(t,e)},V="__lodash_hash_undefined__";var q=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=J&&void 0===t?V:t,this};function X(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}X.prototype.clear=$,X.prototype.delete=K,X.prototype.get=W,X.prototype.has=x,X.prototype.set=q;var Y=X;var Q=function(){this.__data__=[],this.size=0};var Z=function(e,t){return e===t||e!=e&&t!=t};var ee=function(e,t){for(var r=e.length;r--;)if(Z(e[r][0],t))return r;return-1},te=Array.prototype.splice;var re=function(e){var t=this.__data__,r=ee(t,e);return!(r<0||(r==t.length-1?t.pop():te.call(t,r,1),--this.size,0))};var ne=function(e){var t=this.__data__,r=ee(t,e);return r<0?void 0:t[r][1]};var oe=function(e){return ee(this.__data__,e)>-1};var ae=function(e,t){var r=this.__data__,n=ee(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this};function ie(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}ie.prototype.clear=Q,ie.prototype.delete=re,ie.prototype.get=ne,ie.prototype.has=oe,ie.prototype.set=ae;var ce=ie,se=H(i,"Map");var ue=function(){this.size=0,this.__data__={hash:new Y,map:new(se||ce),string:new Y}};var le=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};var fe=function(e,t){var r=e.__data__;return le(t)?r["string"==typeof t?"string":"hash"]:r.map};var de=function(e){var t=fe(this,e).delete(e);return this.size-=t?1:0,t};var pe=function(e){return fe(this,e).get(e)};var he=function(e){return fe(this,e).has(e)};var ve=function(e,t){var r=fe(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this};function me(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}me.prototype.clear=ue,me.prototype.delete=de,me.prototype.get=pe,me.prototype.has=he,me.prototype.set=ve;var ge=me,be="__lodash_hash_undefined__";var Ee=function(e){return this.__data__.set(e,be),this};var _e=function(e){return this.__data__.has(e)};function Re(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new ge;++t<r;)this.add(e[t])}Re.prototype.add=Re.prototype.push=Ee,Re.prototype.has=_e;var ye=Re;var Ae=function(e,t,r,n){for(var o=e.length,a=r+(n?1:-1);n?a--:++a<o;)if(t(e[a],a,e))return a;return-1};var Se=function(e){return e!=e};var Te=function(e,t,r){for(var n=r-1,o=e.length;++n<o;)if(e[n]===t)return n;return-1};var Oe=function(e,t,r){return t==t?Te(e,t,r):Ae(e,Se,r)};var Ce=function(e,t){return!(null==e||!e.length)&&Oe(e,t,0)>-1};var Ue=function(e,t,r){for(var n=-1,o=null==e?0:e.length;++n<o;)if(r(t,e[n]))return!0;return!1};var Ie=function(e,t){return e.has(t)},Pe=H(i,"Set");var Ne=function(){};var De=function(e){var t=-1,r=Array(e.size);return e.forEach(function(e){r[++t]=e}),r},we=Pe&&1/De(new Pe([,-0]))[1]==1/0?function(e){return new Pe(e)}:Ne,Le=200;var je=function(e,t,r){var n=-1,o=Ce,a=e.length,i=!0,c=[],s=c;if(r)i=!1,o=Ue;else if(a>=Le){var u=t?null:we(e);if(u)return De(u);i=!1,o=Ie,s=new ye}else s=t?[]:c;e:for(;++n<a;){var l=e[n],f=t?t(l):l;if(l=r||0!==l?l:0,i&&f==f){for(var d=s.length;d--;)if(s[d]===f)continue e;t&&s.push(f),c.push(l)}else o(s,f,r)||(s!==c&&s.push(f),c.push(l))}return c};var ke=function(e){return e&&e.length?je(e):[]};const Me="TIME";var Fe=Object.freeze({TIME:Me,CURRENT_PRICE:"CURRENT_PRICE"});const He=18e4,Je=12e4,$e=10,Ke=12e4,Ge="Price Tag",Be="Price Tag - This item is being tracked",We={WATCHED:"WATCHED",NOT_FOUND:"NOT_FOUND",INCREASED:"INCREASED",DECREASED:"DECREASED",ACK_DECREASE:"ACK_DECREASE",ACK_INCREASE:"ACK_INCREASE",FIXED:"FIXED"},ze=Object.values(We);var xe={WATCHED:We.WATCHED,NOT_FOUND:We.NOT_FOUND,INCREASED:We.INCREASED,DECREASED:We.DECREASED,ACK_DECREASE:We.ACK_DECREASE,ACK_INCREASE:We.ACK_INCREASE,FIXED:We.FIXED,ALL_STATUSES:ze};const Ve="assets/icon_48.png",qe="assets/icon_active_48.png",Xe="./assets/time-is-money.svg",Ye="./assets/time.svg",Qe="./assets/coin.svg";var Ze={PRICE:/((?:\d+[.,])?\d+(?:[.,]\d+)?)/,HOSTNAME:/https?:\/\/([\w.]+)\/*/,DOMAIN:/^([\w-]+\.)+[\w-]+\w$/,URL:/^https?:\/\/([\w-]+\.)+[\w-]+\w(\/[\w-=.]+)+\/?(\?([\w]+=?[\w-%!@()\\["#\]]+&?)*)?/,CAPTURE:{DOMAIN_IN_URL:/https?:\/\/([\w.]+)\/*/,HOSTNAME_AND_PATH:/^https?:\/\/((?:[\w-]+\.)+[\w-]+\w(?:\/[\w-=.]+)+\/?)/,PROTOCOL_HOSTNAME_AND_PATH:/^(https?:\/\/(?:[\w-]+\.)+[\w-]+\w(?:\/[\w-=.]+)+\/?)/}};function et(){chrome.browserAction.setTitle({title:Ge}),chrome.browserAction.setIcon({path:Ve})}function tt(){chrome.browserAction.setTitle({title:Be}),chrome.browserAction.setIcon({path:qe})}function rt(e){const t=parseFloat(e.replace(",",".")).toFixed(2);return parseFloat(t)}function nt(e){return e&&(t=e,Ze.CAPTURE.HOSTNAME_AND_PATH.test(t));var t}function ot(e){return Ze.DOMAIN.test(e)}function at(e){return Ze.URL.test(e)}function it(e){const t=e.match(Ze.CAPTURE.HOSTNAME_AND_PATH);let r=null;return t&&([,r]=t),r}function ct(e){const t=e.match(Ze.CAPTURE.PROTOCOL_HOSTNAME_AND_PATH);let r=null;return t&&([,r]=t),r}var st=function(e,t,r){var n;return r(e,function(e,r,o){if(t(e,r,o))return n=r,!1}),n};var ut=function(e){return function(t,r,n){for(var o=-1,a=Object(t),i=n(t),c=i.length;c--;){var s=i[e?c:++o];if(!1===r(a[s],s,a))break}return t}}();var lt=function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n};var ft=function(e){return null!=e&&"object"==typeof e},dt="[object Arguments]";var pt=function(e){return ft(e)&&b(e)==dt},ht=Object.prototype,vt=ht.hasOwnProperty,mt=ht.propertyIsEnumerable,gt=pt(function(){return arguments}())?pt:function(e){return ft(e)&&vt.call(e,"callee")&&!mt.call(e,"callee")},bt=Array.isArray;var Et=function(){return!1},_t=n(function(e,t){var r=t&&!t.nodeType&&t,n=r&&e&&!e.nodeType&&e,o=n&&n.exports===r?i.Buffer:void 0,a=(o?o.isBuffer:void 0)||Et;e.exports=a}),Rt=9007199254740991,yt=/^(?:0|[1-9]\d*)$/;var At=function(e,t){var r=typeof e;return!!(t=null==t?Rt:t)&&("number"==r||"symbol"!=r&&yt.test(e))&&e>-1&&e%1==0&&e<t},St=9007199254740991;var Tt=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=St},Ot={};Ot["[object Float32Array]"]=Ot["[object Float64Array]"]=Ot["[object Int8Array]"]=Ot["[object Int16Array]"]=Ot["[object Int32Array]"]=Ot["[object Uint8Array]"]=Ot["[object Uint8ClampedArray]"]=Ot["[object Uint16Array]"]=Ot["[object Uint32Array]"]=!0,Ot["[object Arguments]"]=Ot["[object Array]"]=Ot["[object ArrayBuffer]"]=Ot["[object Boolean]"]=Ot["[object DataView]"]=Ot["[object Date]"]=Ot["[object Error]"]=Ot["[object Function]"]=Ot["[object Map]"]=Ot["[object Number]"]=Ot["[object Object]"]=Ot["[object RegExp]"]=Ot["[object Set]"]=Ot["[object String]"]=Ot["[object WeakMap]"]=!1;var Ct=function(e){return ft(e)&&Tt(e.length)&&!!Ot[b(e)]};var Ut=function(e){return function(t){return e(t)}},It=n(function(e,t){var r=t&&!t.nodeType&&t,n=r&&e&&!e.nodeType&&e,a=n&&n.exports===r&&o.process,i=function(){try{var e=n&&n.require&&n.require("util").types;return e||a&&a.binding&&a.binding("util")}catch(e){}}();e.exports=i}),Pt=It&&It.isTypedArray,Nt=Pt?Ut(Pt):Ct,Dt=Object.prototype.hasOwnProperty;var wt=function(e,t){var r=bt(e),n=!r&&gt(e),o=!r&&!n&&_t(e),a=!r&&!n&&!o&&Nt(e),i=r||n||o||a,c=i?lt(e.length,String):[],s=c.length;for(var u in e)!t&&!Dt.call(e,u)||i&&("length"==u||o&&("offset"==u||"parent"==u)||a&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||At(u,s))||c.push(u);return c},Lt=Object.prototype;var jt=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Lt)};var kt=function(e,t){return function(r){return e(t(r))}}(Object.keys,Object),Mt=Object.prototype.hasOwnProperty;var Ft=function(e){if(!jt(e))return kt(e);var t=[];for(var r in Object(e))Mt.call(e,r)&&"constructor"!=r&&t.push(r);return t};var Ht=function(e){return null!=e&&Tt(e.length)&&!T(e)};var Jt=function(e){return Ht(e)?wt(e):Ft(e)};var $t=function(e,t){return e&&ut(e,t,Jt)};var Kt=function(){this.__data__=new ce,this.size=0};var Gt=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r};var Bt=function(e){return this.__data__.get(e)};var Wt=function(e){return this.__data__.has(e)},zt=200;var xt=function(e,t){var r=this.__data__;if(r instanceof ce){var n=r.__data__;if(!se||n.length<zt-1)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new ge(n)}return r.set(e,t),this.size=r.size,this};function Vt(e){var t=this.__data__=new ce(e);this.size=t.size}Vt.prototype.clear=Kt,Vt.prototype.delete=Gt,Vt.prototype.get=Bt,Vt.prototype.has=Wt,Vt.prototype.set=xt;var qt=Vt;var Xt=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1},Yt=1,Qt=2;var Zt=function(e,t,r,n,o,a){var i=r&Yt,c=e.length,s=t.length;if(c!=s&&!(i&&s>c))return!1;var u=a.get(e);if(u&&a.get(t))return u==t;var l=-1,f=!0,d=r&Qt?new ye:void 0;for(a.set(e,t),a.set(t,e);++l<c;){var p=e[l],h=t[l];if(n)var v=i?n(h,p,l,t,e,a):n(p,h,l,e,t,a);if(void 0!==v){if(v)continue;f=!1;break}if(d){if(!Xt(t,function(e,t){if(!Ie(d,t)&&(p===e||o(p,e,r,n,a)))return d.push(t)})){f=!1;break}}else if(p!==h&&!o(p,h,r,n,a)){f=!1;break}}return a.delete(e),a.delete(t),f},er=i.Uint8Array;var tr=function(e){var t=-1,r=Array(e.size);return e.forEach(function(e,n){r[++t]=[n,e]}),r},rr=1,nr=2,or="[object Boolean]",ar="[object Date]",ir="[object Error]",cr="[object Map]",sr="[object Number]",ur="[object RegExp]",lr="[object Set]",fr="[object String]",dr="[object Symbol]",pr="[object ArrayBuffer]",hr="[object DataView]",vr=c?c.prototype:void 0,mr=vr?vr.valueOf:void 0;var gr=function(e,t,r,n,o,a,i){switch(r){case hr:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case pr:return!(e.byteLength!=t.byteLength||!a(new er(e),new er(t)));case or:case ar:case sr:return Z(+e,+t);case ir:return e.name==t.name&&e.message==t.message;case ur:case fr:return e==t+"";case cr:var c=tr;case lr:var s=n&rr;if(c||(c=De),e.size!=t.size&&!s)return!1;var u=i.get(e);if(u)return u==t;n|=nr,i.set(e,t);var l=Zt(c(e),c(t),n,o,a,i);return i.delete(e),l;case dr:if(mr)return mr.call(e)==mr.call(t)}return!1};var br=function(e,t){for(var r=-1,n=t.length,o=e.length;++r<n;)e[o+r]=t[r];return e};var Er=function(e,t,r){var n=t(e);return bt(e)?n:br(n,r(e))};var _r=function(e,t){for(var r=-1,n=null==e?0:e.length,o=0,a=[];++r<n;){var i=e[r];t(i,r,e)&&(a[o++]=i)}return a};var Rr=function(){return[]},yr=Object.prototype.propertyIsEnumerable,Ar=Object.getOwnPropertySymbols,Sr=Ar?function(e){return null==e?[]:(e=Object(e),_r(Ar(e),function(t){return yr.call(e,t)}))}:Rr;var Tr=function(e){return Er(e,Jt,Sr)},Or=1,Cr=Object.prototype.hasOwnProperty;var Ur=function(e,t,r,n,o,a){var i=r&Or,c=Tr(e),s=c.length;if(s!=Tr(t).length&&!i)return!1;for(var u=s;u--;){var l=c[u];if(!(i?l in t:Cr.call(t,l)))return!1}var f=a.get(e);if(f&&a.get(t))return f==t;var d=!0;a.set(e,t),a.set(t,e);for(var p=i;++u<s;){var h=e[l=c[u]],v=t[l];if(n)var m=i?n(v,h,l,t,e,a):n(h,v,l,e,t,a);if(!(void 0===m?h===v||o(h,v,r,n,a):m)){d=!1;break}p||(p="constructor"==l)}if(d&&!p){var g=e.constructor,b=t.constructor;g!=b&&"constructor"in e&&"constructor"in t&&!("function"==typeof g&&g instanceof g&&"function"==typeof b&&b instanceof b)&&(d=!1)}return a.delete(e),a.delete(t),d},Ir=H(i,"DataView"),Pr=H(i,"Promise"),Nr=H(i,"WeakMap"),Dr=P(Ir),wr=P(se),Lr=P(Pr),jr=P(Pe),kr=P(Nr),Mr=b;(Ir&&"[object DataView]"!=Mr(new Ir(new ArrayBuffer(1)))||se&&"[object Map]"!=Mr(new se)||Pr&&"[object Promise]"!=Mr(Pr.resolve())||Pe&&"[object Set]"!=Mr(new Pe)||Nr&&"[object WeakMap]"!=Mr(new Nr))&&(Mr=function(e){var t=b(e),r="[object Object]"==t?e.constructor:void 0,n=r?P(r):"";if(n)switch(n){case Dr:return"[object DataView]";case wr:return"[object Map]";case Lr:return"[object Promise]";case jr:return"[object Set]";case kr:return"[object WeakMap]"}return t});var Fr=Mr,Hr=1,Jr="[object Arguments]",$r="[object Array]",Kr="[object Object]",Gr=Object.prototype.hasOwnProperty;var Br=function(e,t,r,n,o,a){var i=bt(e),c=bt(t),s=i?$r:Fr(e),u=c?$r:Fr(t),l=(s=s==Jr?Kr:s)==Kr,f=(u=u==Jr?Kr:u)==Kr,d=s==u;if(d&&_t(e)){if(!_t(t))return!1;i=!0,l=!1}if(d&&!l)return a||(a=new qt),i||Nt(e)?Zt(e,t,r,n,o,a):gr(e,t,s,r,n,o,a);if(!(r&Hr)){var p=l&&Gr.call(e,"__wrapped__"),h=f&&Gr.call(t,"__wrapped__");if(p||h){var v=p?e.value():e,m=h?t.value():t;return a||(a=new qt),o(v,m,r,n,a)}}return!!d&&(a||(a=new qt),Ur(e,t,r,n,o,a))};var Wr=function e(t,r,n,o,a){return t===r||(null==t||null==r||!ft(t)&&!ft(r)?t!=t&&r!=r:Br(t,r,n,o,e,a))},zr=1,xr=2;var Vr=function(e,t,r,n){var o=r.length,a=o,i=!n;if(null==e)return!a;for(e=Object(e);o--;){var c=r[o];if(i&&c[2]?c[1]!==e[c[0]]:!(c[0]in e))return!1}for(;++o<a;){var s=(c=r[o])[0],u=e[s],l=c[1];if(i&&c[2]){if(void 0===u&&!(s in e))return!1}else{var f=new qt;if(n)var d=n(u,l,s,e,t,f);if(!(void 0===d?Wr(l,u,zr|xr,n,f):d))return!1}}return!0};var qr=function(e){return e==e&&!E(e)};var Xr=function(e){for(var t=Jt(e),r=t.length;r--;){var n=t[r],o=e[n];t[r]=[n,o,qr(o)]}return t};var Yr=function(e,t){return function(r){return null!=r&&r[e]===t&&(void 0!==t||e in Object(r))}};var Qr=function(e){var t=Xr(e);return 1==t.length&&t[0][2]?Yr(t[0][0],t[0][1]):function(r){return r===e||Vr(r,e,t)}},Zr="[object Symbol]";var en=function(e){return"symbol"==typeof e||ft(e)&&b(e)==Zr},tn=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,rn=/^\w*$/;var nn=function(e,t){if(bt(e))return!1;var r=typeof e;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!en(e))||rn.test(e)||!tn.test(e)||null!=t&&e in Object(t)},on="Expected a function";function an(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError(on);var r=function(){var n=arguments,o=t?t.apply(this,n):n[0],a=r.cache;if(a.has(o))return a.get(o);var i=e.apply(this,n);return r.cache=a.set(o,i)||a,i};return r.cache=new(an.Cache||ge),r}an.Cache=ge;var cn=an,sn=500;var un=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ln=/\\(\\)?/g,fn=function(e){var t=cn(e,function(e){return r.size===sn&&r.clear(),e}),r=t.cache;return t}(function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(un,function(e,r,n,o){t.push(n?o.replace(ln,"$1"):r||e)}),t});var dn=function(e,t){for(var r=-1,n=null==e?0:e.length,o=Array(n);++r<n;)o[r]=t(e[r],r,e);return o},pn=1/0,hn=c?c.prototype:void 0,vn=hn?hn.toString:void 0;var mn=function e(t){if("string"==typeof t)return t;if(bt(t))return dn(t,e)+"";if(en(t))return vn?vn.call(t):"";var r=t+"";return"0"==r&&1/t==-pn?"-0":r};var gn=function(e){return null==e?"":mn(e)};var bn=function(e,t){return bt(e)?e:nn(e,t)?[e]:fn(gn(e))},En=1/0;var _n=function(e){if("string"==typeof e||en(e))return e;var t=e+"";return"0"==t&&1/e==-En?"-0":t};var Rn=function(e,t){for(var r=0,n=(t=bn(t,e)).length;null!=e&&r<n;)e=e[_n(t[r++])];return r&&r==n?e:void 0};var yn=function(e,t,r){var n=null==e?void 0:Rn(e,t);return void 0===n?r:n};var An=function(e,t){return null!=e&&t in Object(e)};var Sn=function(e,t,r){for(var n=-1,o=(t=bn(t,e)).length,a=!1;++n<o;){var i=_n(t[n]);if(!(a=null!=e&&r(e,i)))break;e=e[i]}return a||++n!=o?a:!!(o=null==e?0:e.length)&&Tt(o)&&At(i,o)&&(bt(e)||gt(e))};var Tn=function(e,t){return null!=e&&Sn(e,t,An)},On=1,Cn=2;var Un=function(e,t){return nn(e)&&qr(t)?Yr(_n(e),t):function(r){var n=yn(r,e);return void 0===n&&n===t?Tn(r,e):Wr(t,n,On|Cn)}};var In=function(e){return e};var Pn=function(e){return function(t){return null==t?void 0:t[e]}};var Nn=function(e){return function(t){return Rn(t,e)}};var Dn=function(e){return nn(e)?Pn(_n(e)):Nn(e)};var wn=function(e){return"function"==typeof e?e:null==e?In:"object"==typeof e?bt(e)?Un(e[0],e[1]):Qr(e):Dn(e)};var Ln=function(e,t){return st(e,wn(t,3),$t)};function jn(e){let r={};for(let n in e)if(e.hasOwnProperty(n)&&ot(n)&&e[n]){r=t({},r,{[n]:JSON.parse(e[n])})}return r}class kn{static createState(e){return{recordActive:!1,notifications:{},notificationsCounter:0,autoSaveEnabled:!1,isPriceUpdateEnabled:!1,selection:null,isSimilarElementHighlighted:!1,originalBackgroundColor:null,isCurrentPageTracked:!1,faviconURL:null,_faviconURLMap:{},currentURL:null,canonicalURL:null,browserURL:null,domain:null,_sortItemsBy:e,_undoRemovedItems:[],_undoRemovedItemsResetTask:null}}static toggleRecord(e){return t({},e,{recordActive:!e.recordActive})}static disableRecord(e){return t({},e,{recordActive:!1})}static updateCurrentDomain(e,r){return t({},e,{domain:r})}static updateCurrentURL(e,r){return t({},e,{currentURL:r})}static updateCanonicalURL(e,r){return t({},e,{canonicalURL:r})}static updateBrowserURL(e,r){return t({},e,{browserURL:r})}static enableCurrentPageTracked(e){return t({},e,{isCurrentPageTracked:!0})}static disableCurrentPageTracked(e){return t({},e,{isCurrentPageTracked:!1})}static updateFaviconURL(e,r){return t({},e,{faviconURL:r})}static updateFaviconURLMapItem(e,r,n){return t({},e,{_faviconURLMap:t({},e._faviconURLMap,{[r]:n})})}static enableAutoSave(e,r){return t({},e,{autoSaveEnabled:!0,selection:r=r||e.selection})}static disableAutoSave(e){return t({},e,{autoSaveEnabled:!1})}static enablePriceUpdate(e,r){return t({},e,{isPriceUpdateEnabled:!0,selection:r})}static disablePriceUpdate(e){return t({},e,{isPriceUpdateEnabled:!1})}static setSelectionInfo(e,r,n,o,a){return t({},e,{selection:r,price:n,faviconURL:o,faviconAlt:a})}static setSimilarElementHighlight(e,r,n){return t({},e,{isSimilarElementHighlighted:r,originalBackgroundColor:n})}static incrementNotificationsCounter(e){return t({},e,{notificationsCounter:e.notificationsCounter+1})}static deleteNotificationsItem(e,r){const n=t({},e);return delete n.notifications[r],n}static updateNotificationsItem(e,r,n){return t({},e,{notifications:t({},e.notifications,{[r]:n})})}static updateSortItemsBy(e,r){return t({},e,{_sortItemsBy:r})}static addUndoRemovedItem(e,r,{timestamp:n},o){const a={url:r,timestamp:n},i=[...e._undoRemovedItems];return i.unshift(a),t({},e,{_undoRemovedItems:i.slice(0,o)})}static getUndoRemovedItemsHead(e){return e._undoRemovedItems[0]}static removeUndoRemovedItem(e){const r=[...e._undoRemovedItems];return r.shift(),t({},e,{_undoRemovedItems:r})}static resetUndoRemovedItems(e){return t({},e,{_undoRemovedItems:[]})}static setUndoRemovedItemsResetTask(e,r){return t({},e,{_undoRemovedItemsResetTask:r})}static toStorageStateFormat(e){return Object.keys(e).reduce((r,n)=>t({},r,{[n]:JSON.stringify(e[n])}),{})}}function Mn(){chrome.storage.local.get(null,e=>{const t=jn(e);chrome.storage.sync.get(null,e=>{const r=jn(e),n=JSON.parse(JSON.stringify(t));for(let e in r)if(r.hasOwnProperty(e)&&ot(e)){const t=r[e];if(n[e]){for(let r in t)if(t.hasOwnProperty(r)){const o=t[r];n[e][r]?o.lastUpdateTimestamp>n[e][r].lastUpdateTimestamp&&(n[e][r]=JSON.parse(JSON.stringify(o))):n[e][r]=Object.assign({},o)}}else n[e]=JSON.parse(JSON.stringify(t))}chrome.storage.local.set(kn.toStorageStateFormat(n)),chrome.storage.sync.set(kn.toStorageStateFormat(n))})})}class Fn{constructor(e,t,r,n,o,a,i=null,c,s){this.selection=e,this.price=t,this.currentPrice=t,this.startingPrice=t,this.previousPrice=r||null,this.faviconURL=n,this.faviconAlt=o,this.timestamp=c||(new Date).getTime(),this.lastUpdateTimestamp=s||(new Date).getTime(),this.statuses=a,this.diffPercentage=i}updateCurrentPrice(e){return this.previousPrice=this.currentPrice,this.currentPrice=e,this.updateDiffPercentage()}updateDiffPercentage(){const e=100*Math.abs(this.currentPrice-this.price)/this.price,t=parseFloat(e.toFixed(2));let r=null;t&&((r=this.currentPrice>this.price?+t:-t)>0&&r<1?r=Math.ceil(r):r>-1&&r<0&&(r=Math.floor(r))),this.diffPercentage=r}updateTrackStatus(e,t,r,n=!1){t||(t=[]),r||(r=[]),this.statuses=ke([...this.removeStatuses(r),...t]),this.lastUpdateTimestamp=(new Date).getTime(),n&&(this.startingPrice=this.price),e&&(this.price=e)}removeStatuses(e=[]){return e.length>0&&this.statuses.length>0?this.statuses.filter(t=>!e.includes(t)):this.statuses}isWatched(){return this.statuses.includes(xe.WATCHED)}isNotFound(){return this.statuses.includes(xe.NOT_FOUND)}hasAcknowledgeDecrease(){return this.statuses.includes(xe.ACK_DECREASE)}hasAcknowledgeIncrease(){return this.statuses.includes(xe.ACK_INCREASE)}}class Hn{static createItem(e,t,r,n,o,a,i){return new Fn(e,t,r,n,o,a,i)}static createItemFromObject({selection:e,price:t,previousPrice:r,faviconURL:n,faviconAlt:o,statuses:a,diffPercentage:i,timestamp:c,lastUpdateTimestamp:s}){return new Fn(e,t,r,n,o,a,i,c,s)}}var Jn={TIME:function({timestamp:e},{timestamp:t}){return e-t},CURRENT_PRICE:function({currentPrice:e},{currentPrice:t}){return e-t}};let $n=kn.createState(Me);function Kn(e,r,n,o,a=!1){n||(n=[]),o||(o=[]);const i=ke([...function(e,t=[]){return t.length>0&&e.statuses.length>0?e.statuses.filter(e=>!t.includes(e)):e.statuses}(e,o),...n]),c=t({},e,{statuses:i,lastUpdateTimestamp:(new Date).getTime()});return a&&(c.startingPrice=e.price),r&&(c.price=r),c}function Gn(e,t,r,n,o,a,i,c){chrome.tabs.sendMessage(e,{type:"CONFIRMATION_DISPLAY.CREATE",payload:{elementId:"price-tag--url-confirmation"}},({status:r})=>{if(1===r){const r=function(e,t,r){return{title:"This website recommends to follow this item through a different URL",message:`<u>${r}</u> says that a more accurate URL for this item would be:<br>`+`<i><a href="${e}" target="_blank"  rel="noopener noreferrer">${e}</a></i><br>`+"If this is correct, we recommend you to follow it.<br><br><b>However</b> you can still opt to choose following the current browser URL:<br>"+`<i><a href="${t}" target="_blank" rel="noopener noreferrer">${t}</a></i><br><br>`+"Since your choice will affect the way items are tracked in this site futurely,<br>please help us helping you by choosing carefully one of the following options:",buttons:["Use recommended URL. Remember this option for this site","Use recommended URL but just this time","It's not correct, use the current browser URL. Remember this option","Don't use recommended URL. Use the current browser URL instead but just this time"]}}($n.canonicalURL,$n.browserURL,t);chrome.tabs.sendMessage(e,{type:"CONFIRMATION_DISPLAY.LOAD",payload:r},({status:r,index:n})=>{switch(chrome.tabs.sendMessage(e,{type:"CONFIRMATION_DISPLAY.REMOVE",payload:{elementId:"price-tag--url-confirmation"}}),r){case 1:switch(n){case 0:chrome.storage.local.get([t],e=>{const r=e&&e[t]&&JSON.parse(e[t])||{};r._canUseCanonical=!0,chrome.storage.local.set({[t]:JSON.stringify(r)}),$n=kn.updateCurrentURL($n,$n.canonicalURL),c(!0,!0)});break;case 1:$n=kn.updateCurrentURL($n,$n.canonicalURL),c(!0,!0);break;case 2:chrome.storage.local.get([t],e=>{const r=e&&e[t]&&JSON.parse(e[t])||{};r._canUseCanonical=!1,chrome.storage.local.set({[t]:JSON.stringify(r)}),$n=kn.updateCurrentURL($n,$n.browserURL),c(!0,!1)});break;case 3:$n=kn.updateCurrentURL($n,$n.browserURL),c(!0,!1);break;default:c(!1)}break;case 2:default:c(!1)}})}})}function Bn(){$n=kn.disableRecord($n)}function Wn(e,{status:t,selection:r,price:n,faviconURL:o,faviconAlt:a}={}){t>=0?($n=kn.updateFaviconURL($n,$n.faviconURL||o),$n=kn.setSelectionInfo($n,r,n,$n.faviconURL,a),e(!0)):e(!1)}function zn({status:e,isHighlighted:t,originalBackgroundColor:r=null}){e>=0&&($n=kn.setSimilarElementHighlight($n,t,r))}function xn(e,t,r,n,o,a,i,c){chrome.storage.local.get([e],s=>{const u=s&&s[e]?JSON.parse(s[e]):{};u[t]=Hn.createItem(r,rt(n),null,o,a,i),chrome.storage.local.set({[e]:JSON.stringify(u)},()=>{$n=kn.disableAutoSave($n),c&&c()})})}function Vn(e,t,r){chrome.storage.local.get([t],n=>{const o=n&&n[t]&&JSON.parse(n[t])||null,a=!o||void 0===o._canUseCanonical;r(a&&!!e.canonicalURL&&e.canonicalURL!==e.browserURL)})}function qn(){chrome.storage.local.get(null,e=>{for(let t in e)if(e.hasOwnProperty(t)&&ot(t)){const r=JSON.parse(e[t]);for(let e in r)if(r.hasOwnProperty(e)&&at(e)){const n=Hn.createItemFromObject(r[e]);if(n.isWatched()){const{price:o,currentPrice:a}=n;oo(e,i=>{try{let c=null;const{textContent:s}=i.querySelector(r[e].selection);if(s){const i=s.match(Ze.PRICE);i&&([,c]=i,c=rt(c),o?c<a?(n.updateCurrentPrice(c),n.updateTrackStatus(null,[xe.DECREASED],[xe.INCREASED,xe.NOT_FOUND,xe.ACK_DECREASE]),r[e]=n,chrome.storage.local.set({[t]:JSON.stringify(r)},()=>{if(c<o&&!n.hasAcknowledgeDecrease()){Qn(`TRACK.PRICE_UPDATE-${$n.notificationsCounter}`,Xe,"Lower price!!",`${c} (previous ${o})`,e,e,t,xe.DECREASED,{buttons:[{title:`Keep tracking but w/ new price (${c})`},{title:"Stop watching"}]})}})):c>a?(n.updateCurrentPrice(c),n.updateTrackStatus(null,[xe.INCREASED],[xe.DECREASED,xe.NOT_FOUND,xe.ACK_INCREASE]),r[e]=n,chrome.storage.local.set({[t]:JSON.stringify(r)},()=>{if(!n.hasAcknowledgeIncrease()){const n=`TRACK.PRICE_UPDATE-${$n.notificationsCounter}`,o=r[e].price!==r[e].previousPrice?{buttons:[{title:`Increase interest price to the previous (${r[e].previousPrice})`}]}:{buttons:[]};o.buttons.push({title:"Stop watching"}),Qn(n,Xe,"Price increase",`${c} (previous ${r[e].previousPrice})`,e,e,t,xe.INCREASED,o)}})):n.isNotFound()?(n.updateTrackStatus(null,null,[xe.NOT_FOUND]),r[e]=n,chrome.storage.local.set({[t]:JSON.stringify(r)})):(n.updateTrackStatus(null,null,[xe.NOT_FOUND]),r[e]=n,chrome.storage.local.set({[t]:JSON.stringify(r)},()=>{})):(n.updateTrackStatus(c,[xe.FIXED],[xe.NOT_FOUND]),r[e]=n,chrome.storage.local.set({[t]:JSON.stringify(r)},()=>{Qn(`TRACK.PRICE_FIXED-${$n.notificationsCounter}`,Qe,"Fixed price",`Ermm.. We've just fixed a wrongly set price to ${c}`,e,e,t)})))}n.price&&!c&&(n.isNotFound()||(n.updateTrackStatus(null,[xe.NOT_FOUND],[xe.DECREASED,xe.INCREASED,xe.FIXED,xe.ACK_DECREASE]),r[e]=n,chrome.storage.local.set({[t]:JSON.stringify(r)},()=>{Qn(`TRACK.PRICE_NOT_FOUND-${$n.notificationsCounter}`,Ye,"Price gone",`Price tag no longer found${o?` (previous ${o})`:""}`,e,e,t)})))}catch(a){n.isNotFound()||(console.warn(`Invalid price selection element in\n${e}:\t"${r[e].selection}"`),n.updateTrackStatus(null,[xe.NOT_FOUND],[xe.DECREASED,xe.INCREASED,xe.FIXED,xe.ACK_DECREASE]),r[e]=n,chrome.storage.local.set({[t]:JSON.stringify(r)},()=>{Qn(`TRACK.PRICE_NOT_FOUND-${$n.notificationsCounter}`,Ye,"Price gone",`Price tag no longer found${o?` (previous ${o})`:""}`,e,e,t)}))}})}}}})}function Xn(e,r){chrome.storage.local.get(null,n=>{let o=[];Object.keys(n).forEach(e=>{if(ot(e)){const r=n[e],a=JSON.parse(r)||null;if(a){let e=[];Object.keys(a).forEach(r=>{if(function(e){return Ze.HOSTNAME.test(e)}(r)){const n=Hn.createItemFromObject(a[r]);n.isWatched()&&e.push(t({},n,{url:r}))}}),o=[...o,...e]}}});const a=Jn[e];o.sort(a),r(o)})}function Yn(e,t){chrome.notifications.clear(e,r=>{if(r||t){const{domain:t,url:r,type:n}=$n.notifications[e];chrome.storage.local.get([t],e=>{const o=e&&e[t]?JSON.parse(e[t]):null;switch(n){case xe.DECREASED:o[r]=Kn(o[r],null,[xe.ACK_DECREASE]);break;case xe.INCREASED:o[r]=Kn(o[r],null,[xe.ACK_INCREASE])}chrome.storage.local.set({[t]:JSON.stringify(o)})})}$n=kn.deleteNotificationsItem($n,e)})}function Qn(e,r,n,o,a="",i,c,s,u={}){const l=t({type:"basic",title:n,message:o,iconUrl:r,contextMessage:a,requireInteraction:!0},u);chrome.notifications.create(e,l,e=>{$n=kn.updateNotificationsItem($n,e,{url:i,domain:c,type:s})}),$n=kn.incrementNotificationsCounter($n)}function Zn(e,t,r){chrome.storage.local.get([t],n=>{const o=n&&n[t]?JSON.parse(n[t]):{},a=o[e]&&Hn.createItemFromObject(o[e]),i=o[r]&&Hn.createItemFromObject(o[r]),c=a&&a.isWatched()||i&&i.isWatched();if(o&&!c){const e=function(e){return Ln(e,(e,t)=>at(t))}(o),t=o[e]&&Hn.createItemFromObject(o[e]);t&&t.selection&&($n=kn.enableAutoSave($n,t.selection))}else $n=kn.disableAutoSave($n)})}function eo(e,t,r){chrome.storage.local.get([t],n=>{const o=n&&n[t]?JSON.parse(n[t]):{},a=o[e]&&Hn.createItemFromObject(o[e])||o[r]&&Hn.createItemFromObject(o[r]),i=a&&a.price!==a.currentPrice;$n=i?kn.enablePriceUpdate($n,a.selection):kn.disablePriceUpdate($n)})}function to(e,t,r,n){!0===r?(tt(),$n=kn.enableCurrentPageTracked($n)):!1===r?(et(),$n=kn.disableCurrentPageTracked($n)):r||chrome.storage.local.get([e],r=>{const o=function(e,t){return e&&e[t]&&JSON.parse(e[t])||null}(r,e);if(o){const e=o[t]||o[n],r=e&&Hn.createItemFromObject(e);r&&r.isWatched()?(tt(),$n=kn.enableCurrentPageTracked($n)):(et(),$n=kn.disableCurrentPageTracked($n))}else et(),$n=kn.disableCurrentPageTracked($n)})}function ro(e,t,r){const n=it(t);for(let o in e)if(e.hasOwnProperty(o)&&at(o)){if(Hn.createItemFromObject(e[o]).isWatched()){if(t===o)return void r(null);if(it(o)===n)return void r(o)}}r(null)}function no(e,t,r,n){chrome.storage.local.get([t],o=>{const a=o&&o[t]&&JSON.parse(o[t])||null;a?!0===a._isPathEnoughToTrack?ro(a,r,e=>{e?n(!1,!1):n(!0)}):!1===a._isPathEnoughToTrack?n(!0):ro(a,r,o=>{if(o){const i="price-tag--save-confirmation";chrome.tabs.sendMessage(e,{type:"CONFIRMATION_DISPLAY.CREATE",payload:{elementId:i}},({status:c})=>{if(1===c){const c=function(e,t){return{title:"Item with similar URL to existing one",message:"It appears that the item URL you're trying to save:<br>"+`<i><a href="${e}" target="_blank" rel="noopener noreferrer">${e}</a></i><br>`+"is pretty similar to<br>"+`<i><a href="${t}" target="_blank" rel="noopener noreferrer">${t}</a></i><br><br>`+"Since your choice will affect the way items are tracked in this site futurely,<br>please help us helping you by choosing carefully one of the following options:",buttons:["It's not, save it! Remember this option for this site.","Don't save. Ask me again for items of this site!","Indeed the same item. Don't save! Remember this option for this site. (Use just URL path for accessing items)","For now save this item. Ask me again next time!"]}}(r,o);chrome.tabs.sendMessage(e,{type:"CONFIRMATION_DISPLAY.LOAD",payload:c},({status:r,index:o})=>{switch(chrome.tabs.sendMessage(e,{type:"CONFIRMATION_DISPLAY.REMOVE",payload:{elementId:i}}),r){case 1:switch(o){case 0:a._isPathEnoughToTrack=!1,chrome.storage.local.set({[t]:JSON.stringify(a)}),n(!0);break;case 1:n(!1,!0);break;case 2:a._isPathEnoughToTrack=!0,chrome.storage.local.set({[t]:JSON.stringify(a)}),n(!1,!1);break;case 3:n(!0);break;default:n(!1,!0)}break;case 2:default:n(!1,!0)}})}else n(!1,!0)})}else n(!0)}):n(!0)})}function oo(e,t){const r=new XMLHttpRequest;r.onload=function(){const e=function(e){const t=document.createElement("template");return t.innerHTML=e.trim(),t.content}(this.response);t(e)},r.open("GET",e),r.send()}function ao(e,t){const r=t.match(Ze.CAPTURE.DOMAIN_IN_URL);if(r){const[,e]=r;$n=kn.updateCurrentDomain($n,e),chrome.storage.local.get([e],r=>{const n=r&&r[e]&&JSON.parse(r[e])||null;if(n&&!1===n._canUseCanonical){if($n=kn.updateCanonicalURL($n,null),$n=kn.updateCurrentURL($n,t),$n=kn.updateBrowserURL($n,t),!0===n._isPathEnoughToTrack){const e=ct(t);e&&($n=kn.updateCurrentURL($n,e),$n=kn.updateBrowserURL($n,e))}Zn($n.currentURL,$n.domain,t),eo($n.currentURL,$n.domain,t),to($n.domain,$n.currentURL,null,t)}else $n=kn.updateBrowserURL($n,t),oo(t,e=>{const r=function(e){const t=e.querySelector('link[rel="canonical"]');return t&&t.getAttribute("href")}(e);if(nt(r))$n=kn.updateCurrentURL($n,r),$n=kn.updateCanonicalURL($n,r);else if($n=kn.updateCanonicalURL($n,null),$n=kn.updateCurrentURL($n,t),n&&!0===n._isPathEnoughToTrack){const e=ct(t);e&&($n=kn.updateCurrentURL($n,e),$n=kn.updateBrowserURL($n,e))}Zn($n.currentURL,$n.domain,t),eo($n.currentURL,$n.domain,t),to($n.domain,$n.currentURL,null,t)})})}}function io(){chrome.runtime.onInstalled.addListener(()=>{console.log("Price tag installed.")}),chrome.tabs.onActivated.addListener(()=>{chrome.tabs.query({active:!0,currentWindow:!0},([{id:e,url:t}])=>{t.startsWith("http")?(ao(0,t),$n=kn.updateFaviconURL($n,$n._faviconURLMap[e]||null)):et()})}),chrome.tabs.onUpdated.addListener((e,{favIconUrl:t},{active:r,url:n})=>{n.startsWith("http")?r&&t&&($n=kn.updateFaviconURLMapItem($n,e,t),$n=kn.updateFaviconURL($n,t)):et()}),chrome.webNavigation.onCompleted.addListener(({frameId:e})=>{0===e&&chrome.tabs.query({active:!0,currentWindow:!0},e=>{if(e.length>0){const[{id:t,url:r}]=e;ao(0,r)}})}),chrome.webNavigation.onHistoryStateUpdated.addListener(()=>{chrome.tabs.query({active:!0,currentWindow:!0},e=>{if(e.length>0){const[{id:t,url:r}]=e;void 0!==r&&r!==$n.browserURL&&ao(0,r)}})}),chrome.runtime.onMessage.addListener(({type:e,payload:r={}},n,o)=>{let a;const{id:i,url:c,sortByType:s}=r,{recordActive:u,autoSaveEnabled:l,isPriceUpdateEnabled:f,currentURL:d,domain:p}=$n;switch(e){case"POPUP.STATUS":o({status:1,state:{recordActive:u,autoSaveEnabled:l,isPriceUpdateEnabled:f}});break;case"RECORD.ATTEMPT":if(($n=kn.toggleRecord($n)).recordActive){const{url:e}=r;chrome.tabs.sendMessage(i,{type:"RECORD.START",payload:{url:e}},function(e,t){const{status:r,selection:n,price:o,faviconURL:a,faviconAlt:i}=t,{currentURL:c,domain:s}=$n;r>0&&(Vn($n=kn.updateFaviconURL($n,$n.faviconURL||a),s,t=>{t?Gn(e,s,0,0,0,0,0,(t,r)=>{if(t){const t=r?$n.canonicalURL:$n.browserURL;no(e,s,t,e=>{e&&(xn(s,t,n,o,$n.faviconURL,i,[xe.WATCHED]),to(s,t,!0))})}}):no(e,s,c,e=>{e&&(xn(s,c,n,o,$n.faviconURL,i,[xe.WATCHED]),to(s,c,!0))})}),$n=kn.disableRecord($n))}.bind(null,i))}else chrome.tabs.sendMessage(i,{type:"RECORD.CANCEL"},Bn);o({status:1,state:{recordActive:$n.recordActive}});break;case"AUTO_SAVE.STATUS":return chrome.storage.local.get([p],e=>{const t=e&&e[p]&&JSON.parse(e[p])||null;t&&!0===t._isPathEnoughToTrack?ro(t,d,e=>{e?o({status:-1}):chrome.tabs.sendMessage(i,{type:"AUTO_SAVE.CHECK_STATUS",payload:{url:d,selection:$n.selection}},Wn.bind(null,o))}):chrome.tabs.sendMessage(i,{type:"AUTO_SAVE.CHECK_STATUS",payload:{url:d,selection:$n.selection}},Wn.bind(null,o))}),!0;case"AUTO_SAVE.ATTEMPT":if($n.autoSaveEnabled){const{domain:e,currentURL:t,selection:r,price:n,faviconURL:a,faviconAlt:c,originalBackgroundColor:s}=$n;return Vn($n,e,u=>{u?Gn(i,e,0,0,0,0,0,(t,u)=>{if(t){const t=u?$n.canonicalURL:$n.browserURL;no(i,e,t,(u,l)=>{u?xn(e,t,r,n,a,c,[xe.WATCHED],()=>{chrome.tabs.sendMessage(i,{type:"PRICE_TAG.HIGHLIGHT.STOP",payload:{selection:r,originalBackgroundColor:s}},zn),to(e,t,!0),$n=kn.disableAutoSave($n),o(!1)}):l||($n=kn.disableAutoSave($n))})}}):no(i,e,t,u=>{u&&xn(e,t,r,n,a,c,[xe.WATCHED],()=>{chrome.tabs.sendMessage(i,{type:"PRICE_TAG.HIGHLIGHT.STOP",payload:{selection:r,originalBackgroundColor:s}},zn),to(e,t,!0),$n=kn.disableAutoSave($n),o(!1)})})}),!0}o(!1);break;case"AUTO_SAVE.HIGHLIGHT.PRE_START":if($n.autoSaveEnabled){const{selection:e}=$n;chrome.tabs.sendMessage(i,{type:"PRICE_TAG.HIGHLIGHT.START",payload:{selection:e}},zn)}break;case"AUTO_SAVE.HIGHLIGHT.PRE_STOP":if($n.autoSaveEnabled){const{selection:e,originalBackgroundColor:t}=$n;chrome.tabs.sendMessage(i,{type:"PRICE_TAG.HIGHLIGHT.STOP",payload:{selection:e,originalBackgroundColor:t}},zn)}break;case"PRICE_UPDATE.STATUS":return chrome.storage.local.get([$n.domain],e=>{const t=e&&e[$n.domain]?JSON.parse(e[$n.domain]):{},r=t[$n.currentURL]&&Hn.createItemFromObject(t[$n.currentURL])||t[$n.browserURL]&&Hn.createItemFromObject(t[$n.browserURL]);r?chrome.tabs.sendMessage(i,{type:"PRICE_UPDATE.CHECK_STATUS",payload:{selection:$n.selection}},function(e,t,{status:r,selection:n,price:o,faviconURL:a,faviconAlt:i}={}){r>=0&&($n=kn.updateFaviconURL($n,$n.faviconURL||a),$n=kn.setSelectionInfo($n,n,o,$n.faviconURL,i),rt(o)!==t)?e(!0):e(!1)}.bind(null,o,r.price)):o(!1)}),!0;case"PRICE_UPDATE.ATTEMPT":if($n.isPriceUpdateEnabled){const{domain:e,currentURL:t,selection:r,price:n,originalBackgroundColor:a}=$n,c=n&&rt(n);chrome.storage.local.get([e],n=>{const s=n&&n[e]?JSON.parse(n[e]):{};s[t]=Kn(s[t],c,null,[xe.INCREASED,xe.ACK_INCREASE,xe.DECREASED,xe.INCREASED,xe.DECREASED,xe.ACK_DECREASE,xe.DECREASED,xe.DECREASED,xe.NOT_FOUND]),s[t]=function(e){const t=100*Math.abs(e.currentPrice-e.price)/e.price,r=parseFloat(t.toFixed(2));let n=null;return r&&((n=e.currentPrice>e.price?+r:-r)>0&&n<1?n=Math.ceil(n):n>-1&&n<0&&(n=Math.floor(n))),e.diffPercentage=n,e}(s[t]),chrome.storage.local.set({[e]:JSON.stringify(s)}),chrome.tabs.sendMessage(i,{type:"PRICE_TAG.HIGHLIGHT.STOP",payload:{selection:r,originalBackgroundColor:a}},zn),$n=kn.disablePriceUpdate($n),o(!1)})}return!0;case"PRICE_UPDATE.HIGHLIGHT.PRE_START":if($n.isPriceUpdateEnabled){const{selection:e}=$n;chrome.tabs.sendMessage(i,{type:"PRICE_TAG.HIGHLIGHT.START",payload:{selection:e}},zn)}break;case"PRICE_UPDATE.HIGHLIGHT.PRE_STOP":if($n.isPriceUpdateEnabled){const{selection:e,originalBackgroundColor:t}=$n;chrome.tabs.sendMessage(i,{type:"PRICE_TAG.HIGHLIGHT.STOP",payload:{selection:e,originalBackgroundColor:t}},zn)}break;case"TRACKED_ITEMS.OPEN":a=($n=kn.updateSortItemsBy($n,Me))._undoRemovedItems.length>0,o({isUndoStatusActive:a});break;case"TRACKED_ITEMS.GET":return Xn($n._sortItemsBy,o),!0;case"TRACKED_ITEMS.UNFOLLOW":return function(e,r,n){let o=!1;chrome.storage.local.get(null,a=>{Object.keys(a).forEach(i=>{if(ot(i)){const c=a[i],s=JSON.parse(c)||null;if(s[e]){o=!0,$n._undoRemovedItemsResetTask&&(clearTimeout($n._undoRemovedItemsResetTask),$n=kn.setUndoRemovedItemsResetTask($n,null));const a=t({},s[e]);$n=kn.addUndoRemovedItem($n,e,a,$e),chrome.runtime.sendMessage({type:"TRACKED_ITEMS.UNDO_STATUS",payload:{isUndoStatusActive:!0}});const c=setTimeout(()=>{$n=kn.resetUndoRemovedItems($n),chrome.runtime.sendMessage({type:"TRACKED_ITEMS.UNDO_STATUS",payload:{isUndoStatusActive:!1}})},Ke);$n=kn.setUndoRemovedItemsResetTask($n,c),s[e]=Kn(s[e],null,null,[xe.WATCHED]),chrome.storage.local.set({[i]:JSON.stringify(s)},()=>{r===e&&(Zn(e,i),eo(e,i),to(i,e,!1)),n(!0)})}}}),o||n(!1)})}(c,$n.currentURL,o),!0;case"TRACKED_ITEMS.CHANGE_SORT":$n=kn.updateSortItemsBy($n,Fe[s]);break;case"TRACKED_ITEMS.UNDO_ATTEMPT":if($n._undoRemovedItems.length>0){return function(e,t,r){let n=!1;chrome.storage.local.get(null,o=>{Object.keys(o).forEach(a=>{if(ot(a)){const i=o[a],c=JSON.parse(i)||null;c[e]&&(n=!0,c[e]=Kn(c[e],null,[xe.WATCHED],null),chrome.storage.local.set({[a]:JSON.stringify(c)},()=>{t===e&&(Zn(e,a),eo(e,a),to(a,e,!0)),r(!0)}))}}),n||r(!0)})}(kn.getUndoRemovedItemsHead($n).url,$n.currentURL,e=>{e&&(0===($n=kn.removeUndoRemovedItem($n))._undoRemovedItems.length?o({isUndoStatusActive:!1}):o({isUndoStatusActive:!0}))}),!0}o({isUndoStatusActive:!1})}}),chrome.notifications.onClicked.addListener(e=>{chrome.tabs.create({url:$n.notifications[e].url}),Yn(e)}),chrome.notifications.onButtonClicked.addListener((e,t)=>{const{domain:r,url:n,type:o}=$n.notifications[e];switch(t){case 0:switch(o){case xe.DECREASED:chrome.storage.local.get([r],e=>{const t=e&&e[r]?JSON.parse(e[r]):{};if(t[n]){const{price:e}=t[n];t[n]=Kn(t[n],e,null,[xe.DECREASED,xe.ACK_DECREASE],!0),chrome.storage.local.set({[r]:JSON.stringify(t)})}});break;case xe.INCREASED:chrome.storage.local.get([r],e=>{const t=e&&e[r]?JSON.parse(e[r]):{};if(t[n]){const{previousPrice:e}=t[n];t[n]=Kn(t[n],e,null,[xe.INCREASED,xe.ACK_INCREASE],!0),chrome.storage.local.set({[r]:JSON.stringify(t)})}})}break;case 1:switch(o){case xe.INCREASED:chrome.storage.local.get([r],e=>{const t=e&&e[r]?JSON.parse(e[r]):{};t[n]&&(t[n]=Kn(t[n],null,null,xe.ALL_STATUSES),chrome.storage.local.set({[r]:JSON.stringify(t)}))})}}}),chrome.notifications.onClosed.addListener(Yn)}Mn(),setInterval(Mn,Je),qn(),setInterval(qn,He),io()}();
