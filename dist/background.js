!function(){"use strict";function e(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function t(t){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(r){e(t,r,n[r])})}return t}const r="TIME";var n=Object.freeze({TIME:r,CURRENT_PRICE:"CURRENT_PRICE"});const o=18e4,a=12e4,i=10,c=12e4,s="Price Tag",u="Price Tag - This item is being tracked",l={WATCHED:"WATCHED",NOT_FOUND:"NOT_FOUND",INCREASED:"INCREASED",DECREASED:"DECREASED",ACK_DECREASE:"ACK_DECREASE",ACK_INCREASE:"ACK_INCREASE",FIXED:"FIXED"},f=Object.values(l);var d={WATCHED:l.WATCHED,NOT_FOUND:l.NOT_FOUND,INCREASED:l.INCREASED,DECREASED:l.DECREASED,ACK_DECREASE:l.ACK_DECREASE,ACK_INCREASE:l.ACK_INCREASE,FIXED:l.FIXED,ALL_STATUSES:f};const p="assets/icon_48.png",h="assets/icon_active_48.png",v="./assets/time-is-money.svg",m="./assets/time.svg",g="./assets/coin.svg";var b={PRICE:/((?:\d+[.,])?\d+(?:[.,]\d+)?)/,HOSTNAME:/https?:\/\/([\w.]+)\/*/,DOMAIN:/^([\w-]+\.)+[\w-]+\w$/,URL:/^https?:\/\/([\w-]+\.)+[\w-]+\w(\/[\w-=.]+)+\/?(\?([\w]+=?[\w-%!@()\\["#\]]+&?)*)?/,CAPTURE:{DOMAIN_IN_URL:/https?:\/\/([\w.]+)\/*/,HOSTNAME_AND_PATH:/^https?:\/\/((?:[\w-]+\.)+[\w-]+\w(?:\/[\w-=.]+)+\/?)/,PROTOCOL_HOSTNAME_AND_PATH:/^(https?:\/\/(?:[\w-]+\.)+[\w-]+\w(?:\/[\w-=.]+)+\/?)/}};function E(){chrome.browserAction.setTitle({title:s}),chrome.browserAction.setIcon({path:p})}function _(){chrome.browserAction.setTitle({title:u}),chrome.browserAction.setIcon({path:h})}function R(e){const t=parseFloat(e.replace(",",".")).toFixed(2);return parseFloat(t)}function y(e){return e&&(t=e,b.CAPTURE.HOSTNAME_AND_PATH.test(t));var t}function A(e){return b.DOMAIN.test(e)}function S(e){return b.URL.test(e)}function T(e){const t=e.match(b.CAPTURE.HOSTNAME_AND_PATH);let r=null;return t&&([,r]=t),r}function O(e){const t=e.match(b.CAPTURE.PROTOCOL_HOSTNAME_AND_PATH);let r=null;return t&&([,r]=t),r}var C=function(e,t,r){var n;return r(e,function(e,r,o){if(t(e,r,o))return n=r,!1}),n};var U=function(e){return function(t,r,n){for(var o=-1,a=Object(t),i=n(t),c=i.length;c--;){var s=i[e?c:++o];if(!1===r(a[s],s,a))break}return t}}();var I=function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n},P="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function N(e,t){return e(t={exports:{}},t.exports),t.exports}var D="object"==typeof P&&P&&P.Object===Object&&P,w="object"==typeof self&&self&&self.Object===Object&&self,L=D||w||Function("return this")(),j=L.Symbol,k=Object.prototype,F=k.hasOwnProperty,M=k.toString,H=j?j.toStringTag:void 0;var J=function(e){var t=F.call(e,H),r=e[H];try{e[H]=void 0}catch(e){}var n=M.call(e);return t?e[H]=r:delete e[H],n},$=Object.prototype.toString;var K=function(e){return $.call(e)},G="[object Null]",B="[object Undefined]",W=j?j.toStringTag:void 0;var z=function(e){return null==e?void 0===e?B:G:W&&W in Object(e)?J(e):K(e)};var x=function(e){return null!=e&&"object"==typeof e},V="[object Arguments]";var q=function(e){return x(e)&&z(e)==V},X=Object.prototype,Y=X.hasOwnProperty,Q=X.propertyIsEnumerable,Z=q(function(){return arguments}())?q:function(e){return x(e)&&Y.call(e,"callee")&&!Q.call(e,"callee")},ee=Array.isArray;var te=function(){return!1},re=N(function(e,t){var r=t&&!t.nodeType&&t,n=r&&e&&!e.nodeType&&e,o=n&&n.exports===r?L.Buffer:void 0,a=(o?o.isBuffer:void 0)||te;e.exports=a}),ne=9007199254740991,oe=/^(?:0|[1-9]\d*)$/;var ae=function(e,t){var r=typeof e;return!!(t=null==t?ne:t)&&("number"==r||"symbol"!=r&&oe.test(e))&&e>-1&&e%1==0&&e<t},ie=9007199254740991;var ce=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=ie},se={};se["[object Float32Array]"]=se["[object Float64Array]"]=se["[object Int8Array]"]=se["[object Int16Array]"]=se["[object Int32Array]"]=se["[object Uint8Array]"]=se["[object Uint8ClampedArray]"]=se["[object Uint16Array]"]=se["[object Uint32Array]"]=!0,se["[object Arguments]"]=se["[object Array]"]=se["[object ArrayBuffer]"]=se["[object Boolean]"]=se["[object DataView]"]=se["[object Date]"]=se["[object Error]"]=se["[object Function]"]=se["[object Map]"]=se["[object Number]"]=se["[object Object]"]=se["[object RegExp]"]=se["[object Set]"]=se["[object String]"]=se["[object WeakMap]"]=!1;var ue=function(e){return x(e)&&ce(e.length)&&!!se[z(e)]};var le=function(e){return function(t){return e(t)}},fe=N(function(e,t){var r=t&&!t.nodeType&&t,n=r&&e&&!e.nodeType&&e,o=n&&n.exports===r&&D.process,a=function(){try{var e=n&&n.require&&n.require("util").types;return e||o&&o.binding&&o.binding("util")}catch(e){}}();e.exports=a}),de=fe&&fe.isTypedArray,pe=de?le(de):ue,he=Object.prototype.hasOwnProperty;var ve=function(e,t){var r=ee(e),n=!r&&Z(e),o=!r&&!n&&re(e),a=!r&&!n&&!o&&pe(e),i=r||n||o||a,c=i?I(e.length,String):[],s=c.length;for(var u in e)!t&&!he.call(e,u)||i&&("length"==u||o&&("offset"==u||"parent"==u)||a&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||ae(u,s))||c.push(u);return c},me=Object.prototype;var ge=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||me)};var be=function(e,t){return function(r){return e(t(r))}}(Object.keys,Object),Ee=Object.prototype.hasOwnProperty;var _e=function(e){if(!ge(e))return be(e);var t=[];for(var r in Object(e))Ee.call(e,r)&&"constructor"!=r&&t.push(r);return t};var Re=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)},ye="[object AsyncFunction]",Ae="[object Function]",Se="[object GeneratorFunction]",Te="[object Proxy]";var Oe=function(e){if(!Re(e))return!1;var t=z(e);return t==Ae||t==Se||t==ye||t==Te};var Ce=function(e){return null!=e&&ce(e.length)&&!Oe(e)};var Ue=function(e){return Ce(e)?ve(e):_e(e)};var Ie=function(e,t){return e&&U(e,t,Ue)};var Pe=function(){this.__data__=[],this.size=0};var Ne=function(e,t){return e===t||e!=e&&t!=t};var De=function(e,t){for(var r=e.length;r--;)if(Ne(e[r][0],t))return r;return-1},we=Array.prototype.splice;var Le=function(e){var t=this.__data__,r=De(t,e);return!(r<0||(r==t.length-1?t.pop():we.call(t,r,1),--this.size,0))};var je=function(e){var t=this.__data__,r=De(t,e);return r<0?void 0:t[r][1]};var ke=function(e){return De(this.__data__,e)>-1};var Fe=function(e,t){var r=this.__data__,n=De(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this};function Me(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Me.prototype.clear=Pe,Me.prototype.delete=Le,Me.prototype.get=je,Me.prototype.has=ke,Me.prototype.set=Fe;var He=Me;var Je=function(){this.__data__=new He,this.size=0};var $e=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r};var Ke=function(e){return this.__data__.get(e)};var Ge,Be=function(e){return this.__data__.has(e)},We=L["__core-js_shared__"],ze=(Ge=/[^.]+$/.exec(We&&We.keys&&We.keys.IE_PROTO||""))?"Symbol(src)_1."+Ge:"";var xe=function(e){return!!ze&&ze in e},Ve=Function.prototype.toString;var qe=function(e){if(null!=e){try{return Ve.call(e)}catch(e){}try{return e+""}catch(e){}}return""},Xe=/^\[object .+?Constructor\]$/,Ye=Function.prototype,Qe=Object.prototype,Ze=Ye.toString,et=Qe.hasOwnProperty,tt=RegExp("^"+Ze.call(et).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var rt=function(e){return!(!Re(e)||xe(e))&&(Oe(e)?tt:Xe).test(qe(e))};var nt=function(e,t){return null==e?void 0:e[t]};var ot=function(e,t){var r=nt(e,t);return rt(r)?r:void 0},at=ot(L,"Map"),it=ot(Object,"create");var ct=function(){this.__data__=it?it(null):{},this.size=0};var st=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},ut="__lodash_hash_undefined__",lt=Object.prototype.hasOwnProperty;var ft=function(e){var t=this.__data__;if(it){var r=t[e];return r===ut?void 0:r}return lt.call(t,e)?t[e]:void 0},dt=Object.prototype.hasOwnProperty;var pt=function(e){var t=this.__data__;return it?void 0!==t[e]:dt.call(t,e)},ht="__lodash_hash_undefined__";var vt=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=it&&void 0===t?ht:t,this};function mt(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}mt.prototype.clear=ct,mt.prototype.delete=st,mt.prototype.get=ft,mt.prototype.has=pt,mt.prototype.set=vt;var gt=mt;var bt=function(){this.size=0,this.__data__={hash:new gt,map:new(at||He),string:new gt}};var Et=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};var _t=function(e,t){var r=e.__data__;return Et(t)?r["string"==typeof t?"string":"hash"]:r.map};var Rt=function(e){var t=_t(this,e).delete(e);return this.size-=t?1:0,t};var yt=function(e){return _t(this,e).get(e)};var At=function(e){return _t(this,e).has(e)};var St=function(e,t){var r=_t(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this};function Tt(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Tt.prototype.clear=bt,Tt.prototype.delete=Rt,Tt.prototype.get=yt,Tt.prototype.has=At,Tt.prototype.set=St;var Ot=Tt,Ct=200;var Ut=function(e,t){var r=this.__data__;if(r instanceof He){var n=r.__data__;if(!at||n.length<Ct-1)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new Ot(n)}return r.set(e,t),this.size=r.size,this};function It(e){var t=this.__data__=new He(e);this.size=t.size}It.prototype.clear=Je,It.prototype.delete=$e,It.prototype.get=Ke,It.prototype.has=Be,It.prototype.set=Ut;var Pt=It,Nt="__lodash_hash_undefined__";var Dt=function(e){return this.__data__.set(e,Nt),this};var wt=function(e){return this.__data__.has(e)};function Lt(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new Ot;++t<r;)this.add(e[t])}Lt.prototype.add=Lt.prototype.push=Dt,Lt.prototype.has=wt;var jt=Lt;var kt=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1};var Ft=function(e,t){return e.has(t)},Mt=1,Ht=2;var Jt=function(e,t,r,n,o,a){var i=r&Mt,c=e.length,s=t.length;if(c!=s&&!(i&&s>c))return!1;var u=a.get(e);if(u&&a.get(t))return u==t;var l=-1,f=!0,d=r&Ht?new jt:void 0;for(a.set(e,t),a.set(t,e);++l<c;){var p=e[l],h=t[l];if(n)var v=i?n(h,p,l,t,e,a):n(p,h,l,e,t,a);if(void 0!==v){if(v)continue;f=!1;break}if(d){if(!kt(t,function(e,t){if(!Ft(d,t)&&(p===e||o(p,e,r,n,a)))return d.push(t)})){f=!1;break}}else if(p!==h&&!o(p,h,r,n,a)){f=!1;break}}return a.delete(e),a.delete(t),f},$t=L.Uint8Array;var Kt=function(e){var t=-1,r=Array(e.size);return e.forEach(function(e,n){r[++t]=[n,e]}),r};var Gt=function(e){var t=-1,r=Array(e.size);return e.forEach(function(e){r[++t]=e}),r},Bt=1,Wt=2,zt="[object Boolean]",xt="[object Date]",Vt="[object Error]",qt="[object Map]",Xt="[object Number]",Yt="[object RegExp]",Qt="[object Set]",Zt="[object String]",er="[object Symbol]",tr="[object ArrayBuffer]",rr="[object DataView]",nr=j?j.prototype:void 0,or=nr?nr.valueOf:void 0;var ar=function(e,t,r,n,o,a,i){switch(r){case rr:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case tr:return!(e.byteLength!=t.byteLength||!a(new $t(e),new $t(t)));case zt:case xt:case Xt:return Ne(+e,+t);case Vt:return e.name==t.name&&e.message==t.message;case Yt:case Zt:return e==t+"";case qt:var c=Kt;case Qt:var s=n&Bt;if(c||(c=Gt),e.size!=t.size&&!s)return!1;var u=i.get(e);if(u)return u==t;n|=Wt,i.set(e,t);var l=Jt(c(e),c(t),n,o,a,i);return i.delete(e),l;case er:if(or)return or.call(e)==or.call(t)}return!1};var ir=function(e,t){for(var r=-1,n=t.length,o=e.length;++r<n;)e[o+r]=t[r];return e};var cr=function(e,t,r){var n=t(e);return ee(e)?n:ir(n,r(e))};var sr=function(e,t){for(var r=-1,n=null==e?0:e.length,o=0,a=[];++r<n;){var i=e[r];t(i,r,e)&&(a[o++]=i)}return a};var ur=function(){return[]},lr=Object.prototype.propertyIsEnumerable,fr=Object.getOwnPropertySymbols,dr=fr?function(e){return null==e?[]:(e=Object(e),sr(fr(e),function(t){return lr.call(e,t)}))}:ur;var pr=function(e){return cr(e,Ue,dr)},hr=1,vr=Object.prototype.hasOwnProperty;var mr=function(e,t,r,n,o,a){var i=r&hr,c=pr(e),s=c.length;if(s!=pr(t).length&&!i)return!1;for(var u=s;u--;){var l=c[u];if(!(i?l in t:vr.call(t,l)))return!1}var f=a.get(e);if(f&&a.get(t))return f==t;var d=!0;a.set(e,t),a.set(t,e);for(var p=i;++u<s;){var h=e[l=c[u]],v=t[l];if(n)var m=i?n(v,h,l,t,e,a):n(h,v,l,e,t,a);if(!(void 0===m?h===v||o(h,v,r,n,a):m)){d=!1;break}p||(p="constructor"==l)}if(d&&!p){var g=e.constructor,b=t.constructor;g!=b&&"constructor"in e&&"constructor"in t&&!("function"==typeof g&&g instanceof g&&"function"==typeof b&&b instanceof b)&&(d=!1)}return a.delete(e),a.delete(t),d},gr=ot(L,"DataView"),br=ot(L,"Promise"),Er=ot(L,"Set"),_r=ot(L,"WeakMap"),Rr=qe(gr),yr=qe(at),Ar=qe(br),Sr=qe(Er),Tr=qe(_r),Or=z;(gr&&"[object DataView]"!=Or(new gr(new ArrayBuffer(1)))||at&&"[object Map]"!=Or(new at)||br&&"[object Promise]"!=Or(br.resolve())||Er&&"[object Set]"!=Or(new Er)||_r&&"[object WeakMap]"!=Or(new _r))&&(Or=function(e){var t=z(e),r="[object Object]"==t?e.constructor:void 0,n=r?qe(r):"";if(n)switch(n){case Rr:return"[object DataView]";case yr:return"[object Map]";case Ar:return"[object Promise]";case Sr:return"[object Set]";case Tr:return"[object WeakMap]"}return t});var Cr=Or,Ur=1,Ir="[object Arguments]",Pr="[object Array]",Nr="[object Object]",Dr=Object.prototype.hasOwnProperty;var wr=function(e,t,r,n,o,a){var i=ee(e),c=ee(t),s=i?Pr:Cr(e),u=c?Pr:Cr(t),l=(s=s==Ir?Nr:s)==Nr,f=(u=u==Ir?Nr:u)==Nr,d=s==u;if(d&&re(e)){if(!re(t))return!1;i=!0,l=!1}if(d&&!l)return a||(a=new Pt),i||pe(e)?Jt(e,t,r,n,o,a):ar(e,t,s,r,n,o,a);if(!(r&Ur)){var p=l&&Dr.call(e,"__wrapped__"),h=f&&Dr.call(t,"__wrapped__");if(p||h){var v=p?e.value():e,m=h?t.value():t;return a||(a=new Pt),o(v,m,r,n,a)}}return!!d&&(a||(a=new Pt),mr(e,t,r,n,o,a))};var Lr=function e(t,r,n,o,a){return t===r||(null==t||null==r||!x(t)&&!x(r)?t!=t&&r!=r:wr(t,r,n,o,e,a))},jr=1,kr=2;var Fr=function(e,t,r,n){var o=r.length,a=o,i=!n;if(null==e)return!a;for(e=Object(e);o--;){var c=r[o];if(i&&c[2]?c[1]!==e[c[0]]:!(c[0]in e))return!1}for(;++o<a;){var s=(c=r[o])[0],u=e[s],l=c[1];if(i&&c[2]){if(void 0===u&&!(s in e))return!1}else{var f=new Pt;if(n)var d=n(u,l,s,e,t,f);if(!(void 0===d?Lr(l,u,jr|kr,n,f):d))return!1}}return!0};var Mr=function(e){return e==e&&!Re(e)};var Hr=function(e){for(var t=Ue(e),r=t.length;r--;){var n=t[r],o=e[n];t[r]=[n,o,Mr(o)]}return t};var Jr=function(e,t){return function(r){return null!=r&&r[e]===t&&(void 0!==t||e in Object(r))}};var $r=function(e){var t=Hr(e);return 1==t.length&&t[0][2]?Jr(t[0][0],t[0][1]):function(r){return r===e||Fr(r,e,t)}},Kr="[object Symbol]";var Gr=function(e){return"symbol"==typeof e||x(e)&&z(e)==Kr},Br=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Wr=/^\w*$/;var zr=function(e,t){if(ee(e))return!1;var r=typeof e;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!Gr(e))||Wr.test(e)||!Br.test(e)||null!=t&&e in Object(t)},xr="Expected a function";function Vr(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError(xr);var r=function(){var n=arguments,o=t?t.apply(this,n):n[0],a=r.cache;if(a.has(o))return a.get(o);var i=e.apply(this,n);return r.cache=a.set(o,i)||a,i};return r.cache=new(Vr.Cache||Ot),r}Vr.Cache=Ot;var qr=Vr,Xr=500;var Yr=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Qr=/\\(\\)?/g,Zr=function(e){var t=qr(e,function(e){return r.size===Xr&&r.clear(),e}),r=t.cache;return t}(function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(Yr,function(e,r,n,o){t.push(n?o.replace(Qr,"$1"):r||e)}),t});var en=function(e,t){for(var r=-1,n=null==e?0:e.length,o=Array(n);++r<n;)o[r]=t(e[r],r,e);return o},tn=1/0,rn=j?j.prototype:void 0,nn=rn?rn.toString:void 0;var on=function e(t){if("string"==typeof t)return t;if(ee(t))return en(t,e)+"";if(Gr(t))return nn?nn.call(t):"";var r=t+"";return"0"==r&&1/t==-tn?"-0":r};var an=function(e){return null==e?"":on(e)};var cn=function(e,t){return ee(e)?e:zr(e,t)?[e]:Zr(an(e))},sn=1/0;var un=function(e){if("string"==typeof e||Gr(e))return e;var t=e+"";return"0"==t&&1/e==-sn?"-0":t};var ln=function(e,t){for(var r=0,n=(t=cn(t,e)).length;null!=e&&r<n;)e=e[un(t[r++])];return r&&r==n?e:void 0};var fn=function(e,t,r){var n=null==e?void 0:ln(e,t);return void 0===n?r:n};var dn=function(e,t){return null!=e&&t in Object(e)};var pn=function(e,t,r){for(var n=-1,o=(t=cn(t,e)).length,a=!1;++n<o;){var i=un(t[n]);if(!(a=null!=e&&r(e,i)))break;e=e[i]}return a||++n!=o?a:!!(o=null==e?0:e.length)&&ce(o)&&ae(i,o)&&(ee(e)||Z(e))};var hn=function(e,t){return null!=e&&pn(e,t,dn)},vn=1,mn=2;var gn=function(e,t){return zr(e)&&Mr(t)?Jr(un(e),t):function(r){var n=fn(r,e);return void 0===n&&n===t?hn(r,e):Lr(t,n,vn|mn)}};var bn=function(e){return e};var En=function(e){return function(t){return null==t?void 0:t[e]}};var _n=function(e){return function(t){return ln(t,e)}};var Rn=function(e){return zr(e)?En(un(e)):_n(e)};var yn=function(e){return"function"==typeof e?e:null==e?bn:"object"==typeof e?ee(e)?gn(e[0],e[1]):$r(e):Rn(e)};var An=function(e,t){return C(e,yn(t,3),Ie)};function Sn(e){let r={};for(let n in e)if(e.hasOwnProperty(n)&&A(n)&&e[n]){r=t({},r,{[n]:JSON.parse(e[n])})}return r}class Tn{static createState(e){return{recordActive:!1,notifications:{},notificationsCounter:0,autoSaveEnabled:!1,isPriceUpdateEnabled:!1,selection:null,isSimilarElementHighlighted:!1,originalBackgroundColor:null,isCurrentPageTracked:!1,faviconURL:null,_faviconURLMap:{},currentURL:null,canonicalURL:null,browserURL:null,domain:null,_sortItemsBy:e,_undoRemovedItems:[],_undoRemovedItemsResetTask:null}}static toggleRecord(e){return t({},e,{recordActive:!e.recordActive})}static disableRecord(e){return t({},e,{recordActive:!1})}static updateCurrentDomain(e,r){return t({},e,{domain:r})}static updateCurrentURL(e,r){return t({},e,{currentURL:r})}static updateCanonicalURL(e,r){return t({},e,{canonicalURL:r})}static updateBrowserURL(e,r){return t({},e,{browserURL:r})}static enableCurrentPageTracked(e){return t({},e,{isCurrentPageTracked:!0})}static disableCurrentPageTracked(e){return t({},e,{isCurrentPageTracked:!1})}static updateFaviconURL(e,r){return t({},e,{faviconURL:r})}static updateFaviconURLMapItem(e,r,n){return t({},e,{_faviconURLMap:t({},e._faviconURLMap,{[r]:n})})}static enableAutoSave(e,r){return t({},e,{autoSaveEnabled:!0,selection:r=r||e.selection})}static disableAutoSave(e){return t({},e,{autoSaveEnabled:!1})}static enablePriceUpdate(e,r){return t({},e,{isPriceUpdateEnabled:!0,selection:r})}static disablePriceUpdate(e){return t({},e,{isPriceUpdateEnabled:!1})}static setSelectionInfo(e,r,n,o,a){return t({},e,{selection:r,price:n,faviconURL:o,faviconAlt:a})}static setSimilarElementHighlight(e,r,n){return t({},e,{isSimilarElementHighlighted:r,originalBackgroundColor:n})}static incrementNotificationsCounter(e){return t({},e,{notificationsCounter:e.notificationsCounter+1})}static deleteNotificationsItem(e,r){const n=t({},e);return delete n.notifications[r],n}static updateNotificationsItem(e,r,n){return t({},e,{notifications:t({},e.notifications,{[r]:n})})}static updateSortItemsBy(e,r){return t({},e,{_sortItemsBy:r})}static addUndoRemovedItem(e,r,{timestamp:n},o){const a={url:r,timestamp:n},i=[...e._undoRemovedItems];return i.unshift(a),t({},e,{_undoRemovedItems:i.slice(0,o)})}static getUndoRemovedItemsHead(e){return e._undoRemovedItems[0]}static removeUndoRemovedItem(e){const r=[...e._undoRemovedItems];return r.shift(),t({},e,{_undoRemovedItems:r})}static resetUndoRemovedItems(e){return t({},e,{_undoRemovedItems:[]})}static setUndoRemovedItemsResetTask(e,r){return t({},e,{_undoRemovedItemsResetTask:r})}static toStorageStateFormat(e){return Object.keys(e).reduce((r,n)=>t({},r,{[n]:JSON.stringify(e[n])}),{})}}function On(){chrome.storage.local.get(null,e=>{const t=Sn(e);chrome.storage.sync.get(null,e=>{const r=Sn(e),n=JSON.parse(JSON.stringify(t));for(let e in r)if(r.hasOwnProperty(e)&&A(e)){const t=r[e];if(n[e]){for(let r in t)if(t.hasOwnProperty(r)){const o=t[r];n[e][r]?o.lastUpdateTimestamp>n[e][r].lastUpdateTimestamp&&(n[e][r]=JSON.parse(JSON.stringify(o))):n[e][r]=Object.assign({},o)}}else n[e]=JSON.parse(JSON.stringify(t))}chrome.storage.local.set(Tn.toStorageStateFormat(n)),chrome.storage.sync.set(Tn.toStorageStateFormat(n))})})}var Cn=function(e,t,r,n){for(var o=e.length,a=r+(n?1:-1);n?a--:++a<o;)if(t(e[a],a,e))return a;return-1};var Un=function(e){return e!=e};var In=function(e,t,r){for(var n=r-1,o=e.length;++n<o;)if(e[n]===t)return n;return-1};var Pn=function(e,t,r){return t==t?In(e,t,r):Cn(e,Un,r)};var Nn=function(e,t){return!(null==e||!e.length)&&Pn(e,t,0)>-1};var Dn=function(e,t,r){for(var n=-1,o=null==e?0:e.length;++n<o;)if(r(t,e[n]))return!0;return!1};var wn=function(){},Ln=Er&&1/Gt(new Er([,-0]))[1]==1/0?function(e){return new Er(e)}:wn,jn=200;var kn=function(e,t,r){var n=-1,o=Nn,a=e.length,i=!0,c=[],s=c;if(r)i=!1,o=Dn;else if(a>=jn){var u=t?null:Ln(e);if(u)return Gt(u);i=!1,o=Ft,s=new jt}else s=t?[]:c;e:for(;++n<a;){var l=e[n],f=t?t(l):l;if(l=r||0!==l?l:0,i&&f==f){for(var d=s.length;d--;)if(s[d]===f)continue e;t&&s.push(f),c.push(l)}else o(s,f,r)||(s!==c&&s.push(f),c.push(l))}return c};var Fn=function(e){return e&&e.length?kn(e):[]};class Mn{constructor(e,t,r,n,o,a,i=null,c,s){this.selection=e,this.price=t,this.currentPrice=t,this.startingPrice=t,this.previousPrice=r||null,this.faviconURL=n,this.faviconAlt=o,this.timestamp=c||(new Date).getTime(),this.lastUpdateTimestamp=s||(new Date).getTime(),this.statuses=a,this.diffPercentage=i}updateCurrentPrice(e){return this.previousPrice=this.currentPrice,this.currentPrice=e,this.updateDiffPercentage()}updateDiffPercentage(){const e=100*Math.abs(this.currentPrice-this.price)/this.price,t=parseFloat(e.toFixed(2));let r=null;t&&((r=this.currentPrice>this.price?+t:-t)>0&&r<1?r=Math.ceil(r):r>-1&&r<0&&(r=Math.floor(r))),this.diffPercentage=r}updateTrackStatus(e,t,r,n=!1){t||(t=[]),r||(r=[]),this.statuses=Fn([...this.removeStatuses(r),...t]),this.lastUpdateTimestamp=(new Date).getTime(),n&&(this.startingPrice=this.price),e&&(this.price=e)}removeStatuses(e=[]){return e.length>0&&this.statuses.length>0?this.statuses.filter(t=>!e.includes(t)):this.statuses}isWatched(){return this.statuses.includes(d.WATCHED)}isNotFound(){return this.statuses.includes(d.NOT_FOUND)}hasAcknowledgeDecrease(){return this.statuses.includes(d.ACK_DECREASE)}hasAcknowledgeIncrease(){return this.statuses.includes(d.ACK_INCREASE)}}class Hn{static createItem(e,t,r,n,o,a,i){return new Mn(e,t,r,n,o,a,i)}static createItemFromObject({selection:e,price:t,previousPrice:r,faviconURL:n,faviconAlt:o,statuses:a,diffPercentage:i,timestamp:c,lastUpdateTimestamp:s}){return new Mn(e,t,r,n,o,a,i,c,s)}}var Jn={TIME:function({timestamp:e},{timestamp:t}){return e-t},CURRENT_PRICE:function({currentPrice:e},{currentPrice:t}){return e-t}};let $n=Tn.createState(r);function Kn(e,t,r,n,o,a,i,c){chrome.tabs.sendMessage(e,{type:"CONFIRMATION_DISPLAY.CREATE",payload:{elementId:"price-tag--url-confirmation"}},({status:r})=>{if(1===r){const r=function(e,t,r){return{title:"This website recommends to follow this item through a different URL",message:`<u>${r}</u> says that a more accurate URL for this item would be:<br>`+`<i><a href="${e}" target="_blank"  rel="noopener noreferrer">${e}</a></i><br>`+"If this is correct, we recommend you to follow it.<br><br><b>However</b> you can still opt to choose following the current browser URL:<br>"+`<i><a href="${t}" target="_blank" rel="noopener noreferrer">${t}</a></i><br><br>`+"Since your choice will affect the way items are tracked in this site futurely,<br>please help us helping you by choosing carefully one of the following options:",buttons:["Use recommended URL. Remember this option for this site","Use recommended URL but just this time","It's not correct, use the current browser URL. Remember this option","Don't use recommended URL. Use the current browser URL instead but just this time"]}}($n.canonicalURL,$n.browserURL,t);chrome.tabs.sendMessage(e,{type:"CONFIRMATION_DISPLAY.LOAD",payload:r},({status:r,index:n})=>{switch(chrome.tabs.sendMessage(e,{type:"CONFIRMATION_DISPLAY.REMOVE",payload:{elementId:"price-tag--url-confirmation"}}),r){case 1:switch(n){case 0:chrome.storage.local.get([t],e=>{const r=e&&e[t]&&JSON.parse(e[t])||{};r._canUseCanonical=!0,chrome.storage.local.set({[t]:JSON.stringify(r)}),$n=Tn.updateCurrentURL($n,$n.canonicalURL),c(!0,!0)});break;case 1:$n=Tn.updateCurrentURL($n,$n.canonicalURL),c(!0,!0);break;case 2:chrome.storage.local.get([t],e=>{const r=e&&e[t]&&JSON.parse(e[t])||{};r._canUseCanonical=!1,chrome.storage.local.set({[t]:JSON.stringify(r)}),$n=Tn.updateCurrentURL($n,$n.browserURL),c(!0,!1)});break;case 3:$n=Tn.updateCurrentURL($n,$n.browserURL),c(!0,!1);break;default:c(!1)}break;case 2:default:c(!1)}})}})}function Gn(){$n=Tn.disableRecord($n)}function Bn(e,{status:t,selection:r,price:n,faviconURL:o,faviconAlt:a}={}){t>=0?($n=Tn.updateFaviconURL($n,$n.faviconURL||o),$n=Tn.setSelectionInfo($n,r,n,$n.faviconURL,a),e(!0)):e(!1)}function Wn({status:e,isHighlighted:t,originalBackgroundColor:r=null}){e>=0&&($n=Tn.setSimilarElementHighlight($n,t,r))}function zn(e,t,r,n,o,a,i,c){chrome.storage.local.get([e],s=>{const u=s&&s[e]?JSON.parse(s[e]):{};u[t]=Hn.createItem(r,R(n),null,o,a,i),chrome.storage.local.set({[e]:JSON.stringify(u)},()=>{$n=Tn.disableAutoSave($n),c&&c()})})}function xn(e,t,r){chrome.storage.local.get([t],n=>{const o=n&&n[t]&&JSON.parse(n[t])||null,a=!o||void 0===o._canUseCanonical;r(a&&!!e.canonicalURL&&e.canonicalURL!==e.browserURL)})}function Vn(){chrome.storage.local.get(null,e=>{for(let t in e)if(e.hasOwnProperty(t)&&A(t)){const r=JSON.parse(e[t]);for(let e in r)if(r.hasOwnProperty(e)&&S(e)){const n=Hn.createItemFromObject(r[e]);if(n.isWatched()){const{price:o,currentPrice:a}=n;no(e,i=>{try{let c=null;const{textContent:s}=i.querySelector(r[e].selection);if(s){const i=s.match(b.PRICE);i&&([,c]=i,c=R(c),o?c<a?(n.updateCurrentPrice(c),n.updateTrackStatus(null,[d.DECREASED],[d.INCREASED,d.NOT_FOUND,d.ACK_DECREASE]),r[e]=n,chrome.storage.local.set({[t]:JSON.stringify(r)},()=>{if(c<o&&!n.hasAcknowledgeDecrease()){Yn(`TRACK.PRICE_UPDATE-${$n.notificationsCounter}`,v,"Lower price!!",`${c} (previous ${o})`,e,e,t,d.DECREASED,{buttons:[{title:`Keep tracking but w/ new price (${c})`},{title:"Stop watching"}]})}})):c>a?(n.updateCurrentPrice(c),n.updateTrackStatus(null,[d.INCREASED],[d.DECREASED,d.NOT_FOUND,d.ACK_INCREASE]),r[e]=n,chrome.storage.local.set({[t]:JSON.stringify(r)},()=>{if(!n.hasAcknowledgeIncrease()){const n=`TRACK.PRICE_UPDATE-${$n.notificationsCounter}`,o=r[e].price!==r[e].previousPrice?{buttons:[{title:`Increase interest price to the previous (${r[e].previousPrice})`}]}:{buttons:[]};o.buttons.push({title:"Stop watching"}),Yn(n,v,"Price increase",`${c} (previous ${r[e].previousPrice})`,e,e,t,d.INCREASED,o)}})):n.isNotFound()?(n.updateTrackStatus(null,null,[d.NOT_FOUND]),r[e]=n,chrome.storage.local.set({[t]:JSON.stringify(r)})):(n.updateTrackStatus(null,null,[d.NOT_FOUND]),r[e]=n,chrome.storage.local.set({[t]:JSON.stringify(r)},()=>{})):(n.updateTrackStatus(c,[d.FIXED],[d.NOT_FOUND]),r[e]=n,chrome.storage.local.set({[t]:JSON.stringify(r)},()=>{Yn(`TRACK.PRICE_FIXED-${$n.notificationsCounter}`,g,"Fixed price",`Ermm.. We've just fixed a wrongly set price to ${c}`,e,e,t)})))}n.price&&!c&&(n.isNotFound()||(n.updateTrackStatus(null,[d.NOT_FOUND],[d.DECREASED,d.INCREASED,d.FIXED,d.ACK_DECREASE]),r[e]=n,chrome.storage.local.set({[t]:JSON.stringify(r)},()=>{Yn(`TRACK.PRICE_NOT_FOUND-${$n.notificationsCounter}`,m,"Price gone",`Price tag no longer found${o?` (previous ${o})`:""}`,e,e,t)})))}catch(a){n.isNotFound()||(console.warn(`Invalid price selection element in\n${e}:\t"${r[e].selection}"`),n.updateTrackStatus(null,[d.NOT_FOUND],[d.DECREASED,d.INCREASED,d.FIXED,d.ACK_DECREASE]),r[e]=n,chrome.storage.local.set({[t]:JSON.stringify(r)},()=>{Yn(`TRACK.PRICE_NOT_FOUND-${$n.notificationsCounter}`,m,"Price gone",`Price tag no longer found${o?` (previous ${o})`:""}`,e,e,t)}))}})}}}})}function qn(e,r){chrome.storage.local.get(null,n=>{let o=[];Object.keys(n).forEach(e=>{if(A(e)){const r=n[e],a=JSON.parse(r)||null;if(a){let e=[];Object.keys(a).forEach(r=>{if(function(e){return b.HOSTNAME.test(e)}(r)){const n=Hn.createItemFromObject(a[r]);n.isWatched()&&e.push(t({},n,{url:r}))}}),o=[...o,...e]}}});const a=Jn[e];o.sort(a),r(o)})}function Xn(e,t){chrome.notifications.clear(e,r=>{if(r||t){const{domain:t,url:r,type:n}=$n.notifications[e];chrome.storage.local.get([t],e=>{const o=e&&e[t]?JSON.parse(e[t]):null,a=Hn.createItemFromObject(o[r]);switch(n){case d.DECREASED:a.updateTrackStatus(null,[d.ACK_DECREASE]);break;case d.INCREASED:a.updateTrackStatus(null,[d.ACK_INCREASE])}o[r]=a,chrome.storage.local.set({[t]:JSON.stringify(o)})})}$n=Tn.deleteNotificationsItem($n,e)})}function Yn(e,r,n,o,a="",i,c,s,u={}){const l=t({type:"basic",title:n,message:o,iconUrl:r,contextMessage:a,requireInteraction:!0},u);chrome.notifications.create(e,l,e=>{$n=Tn.updateNotificationsItem($n,e,{url:i,domain:c,type:s})}),$n=Tn.incrementNotificationsCounter($n)}function Qn(e,t,r){chrome.storage.local.get([t],n=>{const o=n&&n[t]?JSON.parse(n[t]):{},a=o[e]&&Hn.createItemFromObject(o[e]),i=o[r]&&Hn.createItemFromObject(o[r]),c=a&&a.isWatched()||i&&i.isWatched();if(o&&!c){const e=function(e){return An(e,(e,t)=>S(t))}(o),t=o[e]&&Hn.createItemFromObject(o[e]);t&&t.selection&&($n=Tn.enableAutoSave($n,t.selection))}else $n=Tn.disableAutoSave($n)})}function Zn(e,t,r){chrome.storage.local.get([t],n=>{const o=n&&n[t]?JSON.parse(n[t]):{},a=o[e]&&Hn.createItemFromObject(o[e])||o[r]&&Hn.createItemFromObject(o[r]),i=a&&a.price!==a.currentPrice;$n=i?Tn.enablePriceUpdate($n,a.selection):Tn.disablePriceUpdate($n)})}function eo(e,t,r,n){!0===r?(_(),$n=Tn.enableCurrentPageTracked($n)):!1===r?(E(),$n=Tn.disableCurrentPageTracked($n)):r||chrome.storage.local.get([e],r=>{const o=function(e,t){return e&&e[t]&&JSON.parse(e[t])||null}(r,e);if(o){const e=o[t]||o[n],r=e&&Hn.createItemFromObject(e);r&&r.isWatched()?(_(),$n=Tn.enableCurrentPageTracked($n)):(E(),$n=Tn.disableCurrentPageTracked($n))}else E(),$n=Tn.disableCurrentPageTracked($n)})}function to(e,t,r){const n=T(t);for(let o in e)if(e.hasOwnProperty(o)&&S(o)){if(Hn.createItemFromObject(e[o]).isWatched()){if(t===o)return void r(null);if(T(o)===n)return void r(o)}}r(null)}function ro(e,t,r,n){chrome.storage.local.get([t],o=>{const a=o&&o[t]&&JSON.parse(o[t])||null;a?!0===a._isPathEnoughToTrack?to(a,r,e=>{e?n(!1,!1):n(!0)}):!1===a._isPathEnoughToTrack?n(!0):to(a,r,o=>{if(o){const i="price-tag--save-confirmation";chrome.tabs.sendMessage(e,{type:"CONFIRMATION_DISPLAY.CREATE",payload:{elementId:i}},({status:c})=>{if(1===c){const c=function(e,t){return{title:"Item with similar URL to existing one",message:"It appears that the item URL you're trying to save:<br>"+`<i><a href="${e}" target="_blank" rel="noopener noreferrer">${e}</a></i><br>`+"is pretty similar to<br>"+`<i><a href="${t}" target="_blank" rel="noopener noreferrer">${t}</a></i><br><br>`+"Since your choice will affect the way items are tracked in this site futurely,<br>please help us helping you by choosing carefully one of the following options:",buttons:["It's not, save it! Remember this option for this site.","Don't save. Ask me again for items of this site!","Indeed the same item. Don't save! Remember this option for this site. (Use just URL path for accessing items)","For now save this item. Ask me again next time!"]}}(r,o);chrome.tabs.sendMessage(e,{type:"CONFIRMATION_DISPLAY.LOAD",payload:c},({status:r,index:o})=>{switch(chrome.tabs.sendMessage(e,{type:"CONFIRMATION_DISPLAY.REMOVE",payload:{elementId:i}}),r){case 1:switch(o){case 0:a._isPathEnoughToTrack=!1,chrome.storage.local.set({[t]:JSON.stringify(a)}),n(!0);break;case 1:n(!1,!0);break;case 2:a._isPathEnoughToTrack=!0,chrome.storage.local.set({[t]:JSON.stringify(a)}),n(!1,!1);break;case 3:n(!0);break;default:n(!1,!0)}break;case 2:default:n(!1,!0)}})}else n(!1,!0)})}else n(!0)}):n(!0)})}function no(e,t){const r=new XMLHttpRequest;r.onload=function(){const e=function(e){const t=document.createElement("template");return t.innerHTML=e.trim(),t.content}(this.response);t(e)},r.open("GET",e),r.send()}function oo(e,t){const r=t.match(b.CAPTURE.DOMAIN_IN_URL);if(r){const[,e]=r;$n=Tn.updateCurrentDomain($n,e),chrome.storage.local.get([e],r=>{const n=r&&r[e]&&JSON.parse(r[e])||null;if(n&&!1===n._canUseCanonical){if($n=Tn.updateCanonicalURL($n,null),$n=Tn.updateCurrentURL($n,t),$n=Tn.updateBrowserURL($n,t),!0===n._isPathEnoughToTrack){const e=O(t);e&&($n=Tn.updateCurrentURL($n,e),$n=Tn.updateBrowserURL($n,e))}Qn($n.currentURL,$n.domain,t),Zn($n.currentURL,$n.domain,t),eo($n.domain,$n.currentURL,null,t)}else $n=Tn.updateBrowserURL($n,t),no(t,e=>{const r=function(e){const t=e.querySelector('link[rel="canonical"]');return t&&t.getAttribute("href")}(e);if(y(r))$n=Tn.updateCurrentURL($n,r),$n=Tn.updateCanonicalURL($n,r);else if($n=Tn.updateCanonicalURL($n,null),$n=Tn.updateCurrentURL($n,t),n&&!0===n._isPathEnoughToTrack){const e=O(t);e&&($n=Tn.updateCurrentURL($n,e),$n=Tn.updateBrowserURL($n,e))}Qn($n.currentURL,$n.domain,t),Zn($n.currentURL,$n.domain,t),eo($n.domain,$n.currentURL,null,t)})})}}function ao(){chrome.runtime.onInstalled.addListener(()=>{console.log("Price tag installed.")}),chrome.tabs.onActivated.addListener(()=>{chrome.tabs.query({active:!0,currentWindow:!0},([{id:e,url:t}])=>{t.startsWith("http")?(oo(0,t),$n=Tn.updateFaviconURL($n,$n._faviconURLMap[e]||null)):E()})}),chrome.tabs.onUpdated.addListener((e,{favIconUrl:t},{active:r,url:n})=>{n.startsWith("http")?r&&t&&($n=Tn.updateFaviconURLMapItem($n,e,t),$n=Tn.updateFaviconURL($n,t)):E()}),chrome.webNavigation.onCompleted.addListener(({frameId:e})=>{0===e&&chrome.tabs.query({active:!0,currentWindow:!0},e=>{if(e.length>0){const[{id:t,url:r}]=e;oo(0,r)}})}),chrome.webNavigation.onHistoryStateUpdated.addListener(()=>{chrome.tabs.query({active:!0,currentWindow:!0},e=>{if(e.length>0){const[{id:t,url:r}]=e;void 0!==r&&r!==$n.browserURL&&oo(0,r)}})}),chrome.runtime.onMessage.addListener(({type:e,payload:o={}},a,s)=>{let u;const{id:l,url:f,sortByType:p}=o,{recordActive:h,autoSaveEnabled:v,isPriceUpdateEnabled:m,currentURL:g,domain:b}=$n;switch(e){case"POPUP.STATUS":s({status:1,state:{recordActive:h,autoSaveEnabled:v,isPriceUpdateEnabled:m}});break;case"RECORD.ATTEMPT":if(($n=Tn.toggleRecord($n)).recordActive){const{url:e}=o;chrome.tabs.sendMessage(l,{type:"RECORD.START",payload:{url:e}},function(e,t){const{status:r,selection:n,price:o,faviconURL:a,faviconAlt:i}=t,{currentURL:c,domain:s}=$n;r>0&&(xn($n=Tn.updateFaviconURL($n,$n.faviconURL||a),s,t=>{t?Kn(e,s,0,0,0,0,0,(t,r)=>{if(t){const t=r?$n.canonicalURL:$n.browserURL;ro(e,s,t,e=>{e&&(zn(s,t,n,o,$n.faviconURL,i,[d.WATCHED]),eo(s,t,!0))})}}):ro(e,s,c,e=>{e&&(zn(s,c,n,o,$n.faviconURL,i,[d.WATCHED]),eo(s,c,!0))})}),$n=Tn.disableRecord($n))}.bind(null,l))}else chrome.tabs.sendMessage(l,{type:"RECORD.CANCEL"},Gn);s({status:1,state:{recordActive:$n.recordActive}});break;case"AUTO_SAVE.STATUS":return chrome.storage.local.get([b],e=>{const t=e&&e[b]&&JSON.parse(e[b])||null;t&&!0===t._isPathEnoughToTrack?to(t,g,e=>{e?s({status:-1}):chrome.tabs.sendMessage(l,{type:"AUTO_SAVE.CHECK_STATUS",payload:{url:g,selection:$n.selection}},Bn.bind(null,s))}):chrome.tabs.sendMessage(l,{type:"AUTO_SAVE.CHECK_STATUS",payload:{url:g,selection:$n.selection}},Bn.bind(null,s))}),!0;case"AUTO_SAVE.ATTEMPT":if($n.autoSaveEnabled){const{domain:e,currentURL:t,selection:r,price:n,faviconURL:o,faviconAlt:a,originalBackgroundColor:i}=$n;return xn($n,e,c=>{c?Kn(l,e,0,0,0,0,0,(t,c)=>{if(t){const t=c?$n.canonicalURL:$n.browserURL;ro(l,e,t,(c,u)=>{c?zn(e,t,r,n,o,a,[d.WATCHED],()=>{chrome.tabs.sendMessage(l,{type:"PRICE_TAG.HIGHLIGHT.STOP",payload:{selection:r,originalBackgroundColor:i}},Wn),eo(e,t,!0),$n=Tn.disableAutoSave($n),s(!1)}):u||($n=Tn.disableAutoSave($n))})}}):ro(l,e,t,c=>{c&&zn(e,t,r,n,o,a,[d.WATCHED],()=>{chrome.tabs.sendMessage(l,{type:"PRICE_TAG.HIGHLIGHT.STOP",payload:{selection:r,originalBackgroundColor:i}},Wn),eo(e,t,!0),$n=Tn.disableAutoSave($n),s(!1)})})}),!0}s(!1);break;case"AUTO_SAVE.HIGHLIGHT.PRE_START":if($n.autoSaveEnabled){const{selection:e}=$n;chrome.tabs.sendMessage(l,{type:"PRICE_TAG.HIGHLIGHT.START",payload:{selection:e}},Wn)}break;case"AUTO_SAVE.HIGHLIGHT.PRE_STOP":if($n.autoSaveEnabled){const{selection:e,originalBackgroundColor:t}=$n;chrome.tabs.sendMessage(l,{type:"PRICE_TAG.HIGHLIGHT.STOP",payload:{selection:e,originalBackgroundColor:t}},Wn)}break;case"PRICE_UPDATE.STATUS":return chrome.storage.local.get([$n.domain],e=>{const t=e&&e[$n.domain]?JSON.parse(e[$n.domain]):{},r=t[$n.currentURL]&&Hn.createItemFromObject(t[$n.currentURL])||t[$n.browserURL]&&Hn.createItemFromObject(t[$n.browserURL]);r?chrome.tabs.sendMessage(l,{type:"PRICE_UPDATE.CHECK_STATUS",payload:{selection:$n.selection}},function(e,t,{status:r,selection:n,price:o,faviconURL:a,faviconAlt:i}={}){r>=0&&($n=Tn.updateFaviconURL($n,$n.faviconURL||a),$n=Tn.setSelectionInfo($n,n,o,$n.faviconURL,i),R(o)!==t)?e(!0):e(!1)}.bind(null,s,r.price)):s(!1)}),!0;case"PRICE_UPDATE.ATTEMPT":if($n.isPriceUpdateEnabled){const{domain:e,currentURL:t,selection:r,price:n,originalBackgroundColor:o}=$n,a=n&&R(n);chrome.storage.local.get([e],n=>{const i=n&&n[e]?JSON.parse(n[e]):{},c=Hn.createItemFromObject(i[t]);c.updateTrackStatus(a,null,[d.INCREASED,d.ACK_INCREASE,d.DECREASED,d.INCREASED,d.DECREASED,d.ACK_DECREASE,d.DECREASED,d.DECREASED,d.NOT_FOUND]),c.updateDiffPercentage(),i[t]=c,chrome.storage.local.set({[e]:JSON.stringify(i)}),chrome.tabs.sendMessage(l,{type:"PRICE_TAG.HIGHLIGHT.STOP",payload:{selection:r,originalBackgroundColor:o}},Wn),$n=Tn.disablePriceUpdate($n),s(!1)})}return!0;case"PRICE_UPDATE.HIGHLIGHT.PRE_START":if($n.isPriceUpdateEnabled){const{selection:e}=$n;chrome.tabs.sendMessage(l,{type:"PRICE_TAG.HIGHLIGHT.START",payload:{selection:e}},Wn)}break;case"PRICE_UPDATE.HIGHLIGHT.PRE_STOP":if($n.isPriceUpdateEnabled){const{selection:e,originalBackgroundColor:t}=$n;chrome.tabs.sendMessage(l,{type:"PRICE_TAG.HIGHLIGHT.STOP",payload:{selection:e,originalBackgroundColor:t}},Wn)}break;case"TRACKED_ITEMS.OPEN":u=($n=Tn.updateSortItemsBy($n,r))._undoRemovedItems.length>0,s({isUndoStatusActive:u});break;case"TRACKED_ITEMS.GET":return qn($n._sortItemsBy,s),!0;case"TRACKED_ITEMS.UNFOLLOW":return function(e,r,n){let o=!1;chrome.storage.local.get(null,a=>{Object.keys(a).forEach(s=>{if(A(s)){const u=a[s],l=JSON.parse(u)||null,f=l[e]&&Hn.createItemFromObject(l[e]);if(f){o=!0,$n._undoRemovedItemsResetTask&&(clearTimeout($n._undoRemovedItemsResetTask),$n=Tn.setUndoRemovedItemsResetTask($n,null));const a=t({},f);$n=Tn.addUndoRemovedItem($n,e,a,i),chrome.runtime.sendMessage({type:"TRACKED_ITEMS.UNDO_STATUS",payload:{isUndoStatusActive:!0}});const u=setTimeout(()=>{$n=Tn.resetUndoRemovedItems($n),chrome.runtime.sendMessage({type:"TRACKED_ITEMS.UNDO_STATUS",payload:{isUndoStatusActive:!1}})},c);$n=Tn.setUndoRemovedItemsResetTask($n,u),f.updateTrackStatus(null,null,[d.WATCHED]),l[e]=f,chrome.storage.local.set({[s]:JSON.stringify(l)},()=>{r===e&&(Qn(e,s),Zn(e,s),eo(s,e,!1)),n(!0)})}}}),o||n(!1)})}(f,$n.currentURL,s),!0;case"TRACKED_ITEMS.CHANGE_SORT":$n=Tn.updateSortItemsBy($n,n[p]);break;case"TRACKED_ITEMS.UNDO_ATTEMPT":if($n._undoRemovedItems.length>0){return function(e,t,r){let n=!1;chrome.storage.local.get(null,o=>{Object.keys(o).forEach(a=>{if(A(a)){const i=o[a],c=JSON.parse(i)||null,s=c[e]&&Hn.createItemFromObject(c[e]);s&&(n=!0,s.updateTrackStatus(null,[d.WATCHED],null),c[e]=s,chrome.storage.local.set({[a]:JSON.stringify(c)},()=>{t===e&&(Qn(e,a),Zn(e,a),eo(a,e,!0)),r(!0)}))}}),n||r(!0)})}(Tn.getUndoRemovedItemsHead($n).url,$n.currentURL,e=>{e&&(0===($n=Tn.removeUndoRemovedItem($n))._undoRemovedItems.length?s({isUndoStatusActive:!1}):s({isUndoStatusActive:!0}))}),!0}s({isUndoStatusActive:!1})}}),chrome.notifications.onClicked.addListener(e=>{chrome.tabs.create({url:$n.notifications[e].url}),Xn(e)}),chrome.notifications.onButtonClicked.addListener((e,t)=>{const{domain:r,url:n,type:o}=$n.notifications[e];switch(t){case 0:switch(o){case d.DECREASED:chrome.storage.local.get([r],e=>{const t=e&&e[r]?JSON.parse(e[r]):{};if(t[n]){const e=Hn.createItemFromObject(t[n]),o=e.price;e.updateTrackStatus(o,null,[d.DECREASED,d.ACK_DECREASE],!0),t[n]=e,chrome.storage.local.set({[r]:JSON.stringify(t)})}});break;case d.INCREASED:chrome.storage.local.get([r],e=>{const t=e&&e[r]?JSON.parse(e[r]):{};if(t[n]){const e=Hn.createItemFromObject(t[n]);e.updateTrackStatus(e.previousPrice,null,[d.INCREASED,d.ACK_INCREASE],!0),t[n]=e,chrome.storage.local.set({[r]:JSON.stringify(t)})}})}break;case 1:switch(o){case d.INCREASED:chrome.storage.local.get([r],e=>{const t=e&&e[r]?JSON.parse(e[r]):{},o=t[n]&&Hn.createItemFromObject(t[n]);o&&(o.updateTrackStatus(null,null,d.ALL_STATUSES),t[n]=o,chrome.storage.local.set({[r]:JSON.stringify(t)}))})}}}),chrome.notifications.onClosed.addListener(Xn)}On(),setInterval(On,a),Vn(),setInterval(Vn,o),ao()}();
