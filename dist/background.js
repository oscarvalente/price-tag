!function(){"use strict";function e(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function t(t){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{},r=Object.keys(o);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(o).filter(function(e){return Object.getOwnPropertyDescriptor(o,e).enumerable}))),r.forEach(function(n){e(t,n,o[n])})}return t}let n={recordActive:!1,notifications:{},notificationsCounter:0,autoSaveEnabled:!1,isPriceUpdateEnabled:!1,selection:null,isSimilarElementHighlighted:!1,originalBackgroundColor:null,isCurrentPageTracked:!1,faviconURL:null,_faviconURLMap:{},currentURL:null,canonicalURL:null,browserURL:null,domain:null};const o="assets/icon_48.png",r="assets/icon_active_48.png",i="Price Tag",s="Price Tag - This item is being tracked",c=18e4,a=12e4,l={PRICE_UPDATE:"./assets/time-is-money.svg",PRICE_NOT_FOUND:"./assets/time.svg",PRICE_FIX:"./assets/coin.svg"},u={PRICE:/((?:\d+[.,])?\d+(?:[.,]\d+)?)/,HOSTNAME:/https?:\/\/([\w.]+)\/*/,DOMAIN:/^([\w-]+\.)+[\w-]+\w$/,URL:/^https?:\/\/([\w-]+\.)+[\w-]+\w(\/[\w-=.]+)+\/?(\?([\w]+=?[\w-%!@()\\["#\]]+&?)*)?/,CAPTURE:{DOMAIN_IN_URL:/https?:\/\/([\w.]+)\/*/,HOSTNAME_AND_PATH:/^https?:\/\/((?:[\w-]+\.)+[\w-]+\w(?:\/[\w-=.]+)+\/?)/,PROTOCOL_HOSTNAME_AND_PATH:/^(https?:\/\/(?:[\w-]+\.)+[\w-]+\w(?:\/[\w-=.]+)+\/?)/}},f={WATCHED:"WATCHED",NOT_FOUND:"NOT_FOUND",INCREASED:"INCREASED",DECREASED:"DECREASED",ACK_DECREASE:"ACK_DECREASE",ACK_INCREASE:"ACK_INCREASE",FIXED:"FIXED"},E=Object.values(f);function g(e,n){return d(t({},e,{previousPrice:e.currentPrice,currentPrice:n}))}function d(e){const t=100*Math.abs(e.currentPrice-e.price)/e.price,n=parseFloat(t.toFixed(2));let o=null;return n&&((o=e.currentPrice>e.price?+n:-n)>0&&o<1?o=Math.ceil(o):o>-1&&o<0&&(o=Math.floor(o))),e.diffPercentage=o,e}function h(e,n,o,r,i=!1){o||(o=[]),r||(r=[]);const s=(c=[...function(e,t=[]){return t.length>0&&e.statuses.length>0?e.statuses.filter(e=>!t.includes(e)):e.statuses}(e,r),...o],Array.from(new Set(c)));var c;const a=t({},e,{statuses:s,lastUpdateTimestamp:(new Date).getTime()});return i&&(a.startingPrice=e.price),n&&(a.price=n),a}function m(e){return e.statuses.includes(f.WATCHED)}function A(e){return e.statuses.includes(f.NOT_FOUND)}function p(e){return e.statuses.includes(f.ACK_DECREASE)}function R(e){return e.statuses.includes(f.ACK_INCREASE)}function T(e,t,o,r,i,s,c,a){chrome.tabs.sendMessage(e,{type:"CONFIRMATION_DISPLAY.CREATE",payload:{elementId:"price-tag--url-confirmation"}},({status:o})=>{if(1===o){const o=function(e,t,n){return{title:"This website recommends to follow this item through a different URL",message:`<u>${n}</u> says that a more accurate URL for this item would be:<br>`+`<i><a href="${e}" target="_blank">${e}</a></i><br>`+"If this is correct, we recommend you to follow it.<br><br><b>However</b> you can still opt to choose following the current browser URL:<br>"+`<i><a href="${t}" target="_blank">${t}</a></i><br><br>`+"Since your choice will affect the way items are tracked in this site futurely,<br>please help us helping you by choosing carefully one of the following options:",buttons:["Use recommended URL. Remember this option for this site","Use recommended URL but just this time","It's not correct, use the current browser URL. Remember this option","Don't use recommended URL. Use the current browser URL instead but just this time"]}}(n.canonicalURL,n.browserURL,t);chrome.tabs.sendMessage(e,{type:"CONFIRMATION_DISPLAY.LOAD",payload:o},({status:o,index:r})=>{if(chrome.tabs.sendMessage(e,{type:"CONFIRMATION_DISPLAY.REMOVE",payload:{elementId:"price-tag--url-confirmation"}}),1===o)switch(r){case 0:chrome.storage.local.get([t],e=>{const o=e&&e[t]&&JSON.parse(e[t])||{};o._canUseCanonical=!0,chrome.storage.local.set({[t]:JSON.stringify(o)}),n=I(n,n.canonicalURL),a(!0,!0)});break;case 1:n=I(n,n.canonicalURL),a(!0,!0);break;case 2:chrome.storage.local.get([t],e=>{const o=e&&e[t]&&JSON.parse(e[t])||{};o._canUseCanonical=!1,chrome.storage.local.set({[t]:JSON.stringify(o)}),n=I(n,n.browserURL),a(!0,!1)});break;case 3:n=I(n,n.browserURL),a(!0,!1);break;default:a(!1)}})}})}function C(){n=U(n)}function S(e,{status:t,url:o,domain:r,selection:i,price:s,faviconURL:c,faviconAlt:a}={}){t>=0?(n=M(n=y(n,n.faviconURL||c),i,s,n.faviconURL,a),e(!0)):e(!1)}function O({status:e,isHighlighted:o,originalBackgroundColor:r=null}){e>=0&&(n=function(e,n,o){return t({},e,{isSimilarElementHighlighted:n,originalBackgroundColor:o})}(n,o,r))}function b(e,t,o,r,i,s,c,a){chrome.storage.local.get([e],l=>{const u=l&&l[e]?JSON.parse(l[e]):{};u[t]=function(e,t,n,o,r,i){n||(n=null);const s=K(t);return{selection:e,price:s,currentPrice:s,startingPrice:s,previousPrice:n,faviconURL:o,faviconAlt:r,timestamp:(new Date).getTime(),statuses:i}}(o,r,void 0,i,s,c),chrome.storage.local.set({[e]:JSON.stringify(u)},()=>{n=H(n),a&&a()})})}function U(e){return t({},e,{recordActive:!1})}function N(e){return t({},e,{isCurrentPageTracked:!1})}function P(e){return t({},e,{isCurrentPageTracked:!0})}function I(e,n){return t({},e,{currentURL:n})}function D(e,n){return t({},e,{canonicalURL:n})}function _(e,n){return t({},e,{browserURL:n})}function y(e,n){return t({},e,{faviconURL:n})}function L(e,t,n){chrome.storage.local.get([t],o=>{const r=o&&o[t]&&JSON.parse(o[t])||null,i=!r||void 0===r._canUseCanonical;n(i&&!!e.canonicalURL&&e.canonicalURL!==e.browserURL)})}function v(){chrome.browserAction.setTitle({title:i}),chrome.browserAction.setIcon({path:o})}function w(){chrome.browserAction.setTitle({title:s}),chrome.browserAction.setIcon({path:r})}function H(e){return t({},e,{autoSaveEnabled:!1})}function k(e){return t({},e,{isPriceUpdateEnabled:!1})}function M(e,n,o,r,i){return t({},e,{selection:n,price:o,faviconURL:r,faviconAlt:i})}function J(){chrome.storage.local.get(null,e=>{for(let t in e)if(e.hasOwnProperty(t)&&x(t)){const o=JSON.parse(e[t]);for(let e in o)if(o.hasOwnProperty(e)&&X(e)&&m(o[e])){const r=new XMLHttpRequest,{price:i,currentPrice:s}=o[e];r.onload=function(){const r=j(this.response);try{let c=null;const a=r.querySelector(o[e].selection).textContent;if(a){const r=a.match(u.PRICE);if(r)if([,c]=r,c=K(c),i)if(c<s){const r=g(o[e],c);o[e]=h(r,null,[f.DECREASED],[f.INCREASED,f.NOT_FOUND,f.ACK_DECREASE]),chrome.storage.local.set({[t]:JSON.stringify(o)},()=>{if(c<i&&!p(o[e])){$(`TRACK.PRICE_UPDATE-${n.notificationsCounter}`,l.PRICE_UPDATE,"Lower price!!",`${c} (previous ${i})`,e,e,t,f.DECREASED,{buttons:[{title:`Keep tracking but w/ new price (${c})`},{title:"Stop watching"}]})}})}else if(c>s){const r=g(o[e],c);o[e]=h(r,null,[f.INCREASED],[f.DECREASED,f.NOT_FOUND,f.ACK_INCREASE]),chrome.storage.local.set({[t]:JSON.stringify(o)},()=>{if(!R(o[e])){const r=`TRACK.PRICE_UPDATE-${n.notificationsCounter}`,i=o[e].price!==o[e].previousPrice?{buttons:[{title:`Increase interest price to the previous (${o[e].previousPrice})`}]}:{buttons:[]};i.buttons.push({title:"Stop watching"}),$(r,l.PRICE_UPDATE,"Price increase",`${c} (previous ${o[e].previousPrice})`,e,e,t,f.INCREASED,i)}})}else A(o[e])?(o[e]=h(o[e],null,null,[f.NOT_FOUND]),chrome.storage.local.set({[t]:JSON.stringify(o)})):(o[e]=h(o[e],null,null,[f.NOT_FOUND]),chrome.storage.local.set({[t]:JSON.stringify(o)},()=>{}));else o[e]=h(o[e],c,[f.FIXED],[f.NOT_FOUND]),chrome.storage.local.set({[t]:JSON.stringify(o)},()=>{$(`TRACK.PRICE_FIXED-${n.notificationsCounter}`,l.PRICE_FIX,"Fixed price",`Ermm.. We've just fixed a wrongly set price to ${c}`,e,e,t)})}o[e].price&&!c&&(A(o[e])||(o[e]=h(o[e],null,[f.NOT_FOUND],[f.DECREASED,f.INCREASED,f.FIXED,f.ACK_DECREASE]),chrome.storage.local.set({[t]:JSON.stringify(o)},()=>{const o=`TRACK.PRICE_NOT_FOUND-${n.notificationsCounter}`,r=i?` (previous ${i})`:"";$(o,l.PRICE_NOT_FOUND,"Price gone",`Price tag no longer found${r}`,e,e,t)})))}catch(r){A(o[e])||(console.warn(`Invalid price selection element in\n${e}:\t"${o[e].selection}"`),o[e]=h(o[e],null,[f.NOT_FOUND],[f.DECREASED,f.INCREASED,f.FIXED,f.ACK_DECREASE]),chrome.storage.local.set({[t]:JSON.stringify(o)},()=>{const o=`TRACK.PRICE_NOT_FOUND-${n.notificationsCounter}`,r=i?` (previous ${i})`:"";$(o,l.PRICE_NOT_FOUND,"Price gone",`Price tag no longer found${r}`,e,e,t)}))}},r.open("GET",e),r.send()}}})}function F(e){chrome.storage.local.get(null,n=>{let o=[];Object.keys(n).forEach(e=>{if(x(e)){const r=n[e],i=JSON.parse(r)||null;if(i){let e=[];Object.keys(i).forEach(n=>{if(function(e){return u.HOSTNAME.test(e)}(n)&&m(i[n])){const o=t({},i[n],{url:n});e.push(o)}}),o=[...o,...e]}}}),o.sort(B),e(o)})}function G(e,o){chrome.notifications.clear(e,r=>{if(r||o){const{domain:t,url:o,type:r}=n.notifications[e];chrome.storage.local.get([t],e=>{const n=e&&e[t]?JSON.parse(e[t]):null;switch(r){case f.DECREASED:n[o]=h(n[o],null,[f.ACK_DECREASE]);break;case f.INCREASED:n[o]=h(n[o],null,[f.ACK_INCREASE])}chrome.storage.local.set({[t]:JSON.stringify(n)})})}n=function(e,n){const o=t({},e);return delete o.notifications[n],o}(n,e)})}function $(e,o,r,i,s="",c,a,l,u={}){const f=t({type:"basic",title:r,message:i,iconUrl:o,contextMessage:s,requireInteraction:!0},u);var E;chrome.notifications.create(e,f,e=>{n=function(e,n,o){return t({},e,{notifications:t({},e.notifications,{[n]:o})})}(n,e,{url:c,domain:a,type:l})}),n=t({},E=n,{notificationsCounter:E.notificationsCounter+1})}function K(e){const t=parseFloat(e.replace(",",".")).toFixed(2);return parseFloat(t)}function j(e){var t=document.createElement("template");return e=e.trim(),t.innerHTML=e,t.content}function W(e){return e&&(t=e,u.CAPTURE.HOSTNAME_AND_PATH.test(t));var t}function B({timestamp:e},{timestamp:t}){return e-t}function x(e){return u.DOMAIN.test(e)}function X(e){return u.URL.test(e)}function q(e,o){chrome.storage.local.get([o],r=>{const i=r&&r[o]?JSON.parse(r[o]):{},s=!i[e]||!m(i[e]);if(i&&s){const e=Object.keys(i)[0];i[e]&&i[e].selection&&(n=function(e,n){return t({},e,{autoSaveEnabled:!0,selection:n=n||e.selection})}(n,i[e].selection))}else n=H(n)})}function V(e,o){chrome.storage.local.get([o],r=>{const i=(r&&r[o]?JSON.parse(r[o]):{})[e],s=i&&i.price!==i.currentPrice;n=s?function(e,n){return t({},e,{isPriceUpdateEnabled:!0,selection:n})}(n,i.selection):k(n)})}function Y(e,t,o){!0===o?(w(),n=P(n)):!1===o?(v(),n=N(n)):o||chrome.storage.local.get([e],o=>{const r=function(e,t){return e&&e[t]&&JSON.parse(e[t])||null}(o,e);if(r){const e=r[t];e&&m(e)?(w(),n=P(n)):(v(),n=N(n))}else v(),n=N(n)})}function z(e){const t=e.match(u.CAPTURE.HOSTNAME_AND_PATH);let n=null;return t&&([,n]=t),n}function Q(e){const t=e.match(u.CAPTURE.PROTOCOL_HOSTNAME_AND_PATH);let n=null;return t&&([,n]=t),n}function Z(e,t,n){const o=z(t);for(let r in e)if(e.hasOwnProperty(r)&&X(r)&&m(e[r])){if(t===r)return void n(null);if(z(r)===o)return void n(r)}n(null)}function ee(e,t,n,o){chrome.storage.local.get([t],r=>{const i=r&&r[t]&&JSON.parse(r[t])||null;i?!0===i._isPathEnoughToTrack?Z(i,n,e=>{e?o(!1,!1):o(!0)}):!1===i._isPathEnoughToTrack?o(!0):Z(i,n,r=>{if(r){const s="price-tag--save-confirmation";chrome.tabs.sendMessage(e,{type:"CONFIRMATION_DISPLAY.CREATE",payload:{elementId:s}},({status:c})=>{if(1===c){const c=function(e,t){return{title:"Item with similar URL to existing one",message:"It appears that the item URL you're trying to save:<br>"+`<i><a href="${e}" target="_blank">${e}</a></i><br>`+"is pretty similar to<br>"+`<i><a href="${t}" target="_blank">${t}</a></i><br><br>`+"Since your choice will affect the way items are tracked in this site futurely,<br>please help us helping you by choosing carefully one of the following options:",buttons:["It's not, save it! Remember this option for this site.","Don't save. Ask me again for items of this site!","Indeed the same item. Don't save! Remember this option for this site. (Use just URL path for accessing items)","For now save this item. Ask me again next time!"]}}(n,r);chrome.tabs.sendMessage(e,{type:"CONFIRMATION_DISPLAY.LOAD",payload:c},({status:n,index:r})=>{if(chrome.tabs.sendMessage(e,{type:"CONFIRMATION_DISPLAY.REMOVE",payload:{elementId:s}}),1===n)switch(r){case 0:i._isPathEnoughToTrack=!1,chrome.storage.local.set({[t]:JSON.stringify(i)}),o(!0);break;case 1:o(!1,!0);break;case 2:i._isPathEnoughToTrack=!0,chrome.storage.local.set({[t]:JSON.stringify(i)}),o(!1,!1);break;case 3:o(!0);break;default:o(!1,!0)}else o(!1,!0)})}else o(!1,!0)})}else o(!0)}):o(!0)})}function te(e,o){const r=o.match(u.CAPTURE.DOMAIN_IN_URL);if(r){const[,e]=r;n=function(e,n){return t({},e,{domain:n})}(n,e),chrome.storage.local.get([e],t=>{const r=t&&t[e]&&JSON.parse(t[e])||null;if(r&&!1===r._canUseCanonical){if(n=_(n=I(n=D(n,null),o),o),!0===r._isPathEnoughToTrack){const e=Q(o);e&&(n=_(n=I(n,e),e))}q(n.currentURL,n.domain),V(n.currentURL,n.domain),Y(n.domain,n.currentURL)}else n=_(n,o),function(e,t){const n=new XMLHttpRequest;n.onload=function(){const e=j(this.response);t(e)},n.open("GET",e),n.send()}(o,e=>{const t=function(e){const t=e.querySelector('link[rel="canonical"]');return t&&t.getAttribute("href")}(e);if(W(t))n=D(n=I(n,t),t);else if(n=I(n=D(n,null),o),r&&!0===r._isPathEnoughToTrack){const e=Q(o);e&&(n=_(n=I(n,e),e))}q(n.currentURL,n.domain),V(n.currentURL,n.domain),Y(n.domain,n.currentURL)})})}}function ne(){chrome.runtime.onInstalled.addListener(()=>{console.log("Price tag installed.")}),chrome.tabs.onActivated.addListener(()=>{chrome.tabs.query({active:!0,currentWindow:!0},([{id:e,url:t}])=>{t.startsWith("http")?(te(0,t),n=y(n,n._faviconURLMap[e]||null)):v()})}),chrome.tabs.onUpdated.addListener((e,{status:o,favIconUrl:r},{active:i,url:s})=>{s.startsWith("http")?i&&r&&(n=y(n=function(e,n,o){return t({},e,{_faviconURLMap:t({},e._faviconURLMap,{[n]:o})})}(n,e,r),r)):v()}),chrome.webNavigation.onCompleted.addListener(({frameId:e})=>{0===e&&chrome.tabs.query({active:!0,currentWindow:!0},e=>{if(e.length>0){const[{id:t,url:n}]=e;te(0,n)}})}),chrome.webNavigation.onHistoryStateUpdated.addListener(()=>{chrome.tabs.query({active:!0,currentWindow:!0},e=>{if(e.length>0){const[{id:t,url:o}]=e;void 0!==o&&o!==n.browserURL&&te(0,o)}})}),chrome.runtime.onMessage.addListener(({type:e,payload:o={}},r,i)=>{const{id:s}=o;switch(e){case"POPUP.STATUS":const{recordActive:r,autoSaveEnabled:c,isPriceUpdateEnabled:a}=n;i({status:1,state:{recordActive:r,autoSaveEnabled:c,isPriceUpdateEnabled:a}});break;case"RECORD.ATTEMPT":if((n=function(e){return t({},e,{recordActive:!e.recordActive})}(n)).recordActive){const{url:e}=o;chrome.tabs.sendMessage(s,{type:"RECORD.START",payload:{url:e}},function(e,t){const{status:o,selection:r,price:i,faviconURL:s,faviconAlt:c}=t,{currentURL:a,domain:l}=n;o>0&&(L(n=y(n,n.faviconURL||s),l,t=>{t?T(e,l,0,0,0,0,0,(t,o)=>{if(t){const t=o?n.canonicalURL:n.browserURL;ee(e,l,t,e=>{e&&(b(l,t,r,i,n.faviconURL,c,[f.WATCHED]),Y(l,t,!0))})}}):ee(e,l,a,e=>{e&&(b(l,a,r,i,n.faviconURL,c,[f.WATCHED]),Y(l,a,!0))})}),n=U(n))}.bind(null,s))}else chrome.tabs.sendMessage(s,{type:"RECORD.CANCEL"},C);i({status:1,state:{recordActive:n.recordActive}});break;case"AUTO_SAVE.STATUS":const{currentURL:l,domain:u}=n;return chrome.storage.local.get([u],e=>{const t=e&&e[u]&&JSON.parse(e[u])||null;t&&!0===t._isPathEnoughToTrack?Z(t,l,e=>{e?i({status:-1}):chrome.tabs.sendMessage(s,{type:"AUTO_SAVE.CHECK_STATUS",payload:{url:l,selection:n.selection}},S.bind(null,i))}):chrome.tabs.sendMessage(s,{type:"AUTO_SAVE.CHECK_STATUS",payload:{url:l,selection:n.selection}},S.bind(null,i))}),!0;case"AUTO_SAVE.ATTEMPT":if(n.autoSaveEnabled){const{domain:e,currentURL:t,selection:o,price:r,faviconURL:c,faviconAlt:a,originalBackgroundColor:l}=n;return L(n,e,u=>{u?T(s,e,0,0,0,0,0,(t,u)=>{if(t){const t=u?n.canonicalURL:n.browserURL;ee(s,e,t,(u,E)=>{u?b(e,t,o,r,c,a,[f.WATCHED],()=>{chrome.tabs.sendMessage(s,{type:"PRICE_TAG.HIGHLIGHT.STOP",payload:{selection:o,originalBackgroundColor:l}},O),Y(e,t,!0),n=H(n),i(!1)}):E||(n=H(n))})}}):ee(s,e,t,u=>{u&&b(e,t,o,r,c,a,[f.WATCHED],()=>{chrome.tabs.sendMessage(s,{type:"PRICE_TAG.HIGHLIGHT.STOP",payload:{selection:o,originalBackgroundColor:l}},O),Y(e,t,!0),n=H(n),i(!1)})})}),!0}i(!1);break;case"AUTO_SAVE.HIGHLIGHT.PRE_START":if(n.autoSaveEnabled){const{selection:e}=n;chrome.tabs.sendMessage(s,{type:"PRICE_TAG.HIGHLIGHT.START",payload:{selection:e}},O)}break;case"AUTO_SAVE.HIGHLIGHT.PRE_STOP":if(n.autoSaveEnabled){const{selection:e,originalBackgroundColor:t}=n;chrome.tabs.sendMessage(s,{type:"PRICE_TAG.HIGHLIGHT.STOP",payload:{selection:e,originalBackgroundColor:t}},O)}break;case"PRICE_UPDATE.STATUS":return chrome.storage.local.get([n.domain],e=>{const t=(e&&e[n.domain]?JSON.parse(e[n.domain]):{})[n.currentURL];t?chrome.tabs.sendMessage(s,{type:"PRICE_UPDATE.CHECK_STATUS",payload:{selection:n.selection}},function(e,t,{status:o,selection:r,price:i,faviconURL:s,faviconAlt:c}={}){o>=0&&(n=M(n=y(n,n.faviconURL||s),r,i,n.faviconURL,c),K(i)!==t)?e(!0):e(!1)}.bind(null,i,t.price)):i(!1)}),!0;case"PRICE_UPDATE.ATTEMPT":if(n.isPriceUpdateEnabled){const{domain:e,currentURL:t,selection:o,price:r,originalBackgroundColor:c}=n,a=r&&K(r);chrome.storage.local.get([e],r=>{const l=r&&r[e]?JSON.parse(r[e]):{};l[t]=h(l[t],a,null,[f.INCREASED,f.ACK_INCREASE,f.DECREASED,f.INCREASED,f.DECREASED,f.ACK_DECREASE,f.DECREASED,f.DECREASED,f.NOT_FOUND]),l[t]=d(l[t]),chrome.storage.local.set({[e]:JSON.stringify(l)}),chrome.tabs.sendMessage(s,{type:"PRICE_TAG.HIGHLIGHT.STOP",payload:{selection:o,originalBackgroundColor:c}},O),n=k(n),i(!1)})}return!0;case"PRICE_UPDATE.HIGHLIGHT.PRE_START":if(n.isPriceUpdateEnabled){const{selection:e}=n;chrome.tabs.sendMessage(s,{type:"PRICE_TAG.HIGHLIGHT.START",payload:{selection:e}},O)}break;case"PRICE_UPDATE.HIGHLIGHT.PRE_STOP":if(n.isPriceUpdateEnabled){const{selection:e,originalBackgroundColor:t}=n;chrome.tabs.sendMessage(s,{type:"PRICE_TAG.HIGHLIGHT.STOP",payload:{selection:e,originalBackgroundColor:t}},O)}break;case"TRACKED_ITEMS.GET":return F(i),!0;case"TRACKED_ITEMS.UNFOLLOW":const{url:g}=o;return function(e,t,n){let o=!1;chrome.storage.local.get(null,r=>{Object.keys(r).forEach(i=>{if(x(i)){const s=r[i],c=JSON.parse(s)||null;c[e]&&(o=!0,c[e]=h(c[e],null,null,E),chrome.storage.local.set({[i]:JSON.stringify(c)},()=>{t===e&&(q(e,i),V(e,i),Y(i,e,!1)),n(!0)}))}}),o||n(!1)})}(g,n.currentURL,i),!0}}),chrome.notifications.onClicked.addListener(e=>{chrome.tabs.create({url:n.notifications[e].url}),G(e)}),chrome.notifications.onButtonClicked.addListener((e,t)=>{const{domain:o,url:r,type:i}=n.notifications[e];switch(t){case 0:switch(i){case f.DECREASED:chrome.storage.local.get([o],e=>{const t=e&&e[o]?JSON.parse(e[o]):{};if(t[r]){const{price:e}=t[r];t[r]=h(t[r],e,null,[f.DECREASED,f.ACK_DECREASE],!0),chrome.storage.local.set({[o]:JSON.stringify(t)})}});break;case f.INCREASED:chrome.storage.local.get([o],e=>{const t=e&&e[o]?JSON.parse(e[o]):{};if(t[r]){const{previousPrice:e}=t[r];t[r]=h(t[r],e,null,[f.INCREASED,f.ACK_INCREASE],!0),chrome.storage.local.set({[o]:JSON.stringify(t)})}})}break;case 1:switch(i){case f.INCREASED:chrome.storage.local.get([o],e=>{const t=e&&e[o]?JSON.parse(e[o]):{};t[r]&&(t[r]=h(t[r],null,null,E),chrome.storage.local.set({[o]:JSON.stringify(t)}))})}}}),chrome.notifications.onClosed.addListener(G)}function oe(e){let n={};for(let o in e)if(e.hasOwnProperty(o)&&x(o)&&e[o]){n=t({},n,{[o]:JSON.parse(e[o])})}return n}function re(e){return Object.keys(e).reduce((n,o)=>t({},n,{[o]:JSON.stringify(e[o])}),{})}function ie(){chrome.storage.local.get(null,e=>{const t=oe(e);chrome.storage.sync.get(null,e=>{const n=oe(e),o=JSON.parse(JSON.stringify(t));for(let e in n)if(n.hasOwnProperty(e)&&x(e)){const t=n[e];if(o[e]){for(let n in t)if(t.hasOwnProperty(n)){const r=t[n];o[e][n]?r.lastUpdateTimestamp>o[e][n].lastUpdateTimestamp&&(o[e][n]=JSON.parse(JSON.stringify(r))):o[e][n]=Object.assign({},r)}}else o[e]=JSON.parse(JSON.stringify(t))}chrome.storage.local.set(re(o)),chrome.storage.sync.set(re(o))})})}ie(),setInterval(ie,a),J(),setInterval(J,c),ne()}();
